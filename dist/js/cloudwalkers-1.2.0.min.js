function css(a){if($("head").find('link[href="'+a+'"]').size())return null;var b=$("<link />",{type:"text/css",rel:"stylesheet",href:a});$("head").append(b)}function AuthorizationError(a){this.name="Not Authorized",this.message=a||"Not authorized for the current user (no matching authorization token)",this.stack=(new Error).stack}define(["backbone","mustache","Session","Router","config","Views/Root","Utilities/UrlShortener"],function(a,b,c,d,e,f,g){var h={version:1,langs:[{id:"en_EN",name:"International English"},{id:"fr_FR",name:"Français"},{id:"nl_NL",name:"Nederlands"},{id:"pt_PT",name:"Português"}],init:function(){this.Session=c;var b=window.localStorage.getItem("token");return b&&b.length>9?this.Session.authenticationtoken=b:(console.log("token error",b),window.location="/login.html"),this.Session.api=e.apiurl+h.version,this.Session.loadEssentialData(function(){h.RootView=new f,h.Session.UrlShortener=new g,h.Router=new d,a.history.start()}),this}};return a.ajax=function(){return h.Session.authenticationtoken&&(arguments[0].headers={Authorization:"Bearer "+h.Session.authenticationtoken,Accept:"application/json"}),a.$.ajax.apply(a.$,arguments)},b.render=function(a,c,d){h.Polyglot.trans&&(c=$.extend(c,{trans:h.Polyglot.trans}));var e=new b.Writer;return e.render(a,c,d)},h}),define(["Collections/BaseCollection","Models/Account"],function(a,b){var c=a.extend({model:b,fetch:function(){return Cloudwalkers.Session.user.get("accounts")},updates:function(a){for(var b in a){var c=this.get(a[b]);c&&(Store.set(this.typestring,{id:a[b],outdated:!0}),c.fetch())}},outdated:function(a){if(!a)return this.filter(function(a){return a.outdated});this.updates([a])}});return c}),define(["Collections/BaseCollection","Models/Action"],function(a,b){var c=a.extend({model:b,typestring:"actions",modelstring:"action",token:"",templates:{share:{name:"Share",icon:"share",token:"share",type:"write",maxsize:{twitter:140},clone:!0,redirect:!1,valuetag:"shares"},"delete":{name:"Delete",icon:"remove",token:"delete",type:"confirm"},edit:{name:"Edit",icon:"edit",token:"edit",type:"edit",redirect:!1},note_view:{name:"Note",icon:"edit",token:"note",type:"note",compound:"note",valuetag:"notes",hidemetoken:"hidden"},note_manage:{name:"Add note",icon:"edit",token:"note",type:"note",compound:"note"},tag:{name:"tag",icon:"edit",token:"tag",type:"tag"},resend:{name:"Resend",icon:"arrow-up",token:"resend",type:"write"},reply:{name:"Reply",icon:"comments-o",token:"reply",type:"write",clone:!0,parameters:[{token:"message",name:"Message",type:"string",required:!1,value:"@{{from.name}} "}]},dm:{name:"DM",icon:"comments-o",token:"dm",type:"dialog",clone:!0,parameters:[{token:"message",name:"Message",type:"string",required:!1,value:""}]},comment:{name:"Comment",icon:"comment",token:"comment",type:"dialog",clone:!0,compound:"comment",valuetag:"comments",tokenview:"comment-list",maxsize:{twitter:140},parameters:[{token:"message",name:"Message",type:"string",required:!1,value:""}]},retweet:{name:"Retweet",icon:"retweet",token:"retweet",type:"options",valuetag:"retweets"},like:{name:"Like",icon:"thumbs-up",token:"like",type:"options",toggle:"unlike",valuetag:"likes"},unlike:{name:"Unlike",icon:"thumbs-down",token:"unlike",type:"growl",toggle:"like",actiontype:"like"},favorite:{name:"Favorite",icon:"star",token:"favorite",type:"options",toggle:"unfavorite",valuetag:"favourites"},unfavorite:{name:"Unfavorite",icon:"star-o",token:"unfavorite",type:"growl",toggle:"favorite",actiontype:"favorite"},plusone:{name:"Unfavorite",icon:"google-plus-sign",token:"plusone",type:"options",toggle:"unplusone"},unplusone:{name:"Unfavorite",icon:"google-plus-sign",token:"unplusone",type:"growl",toggle:"plusone",actiontype:"plusone"}},initialize:function(a,b){b&&$.extend(this,b),this.listenTo(this.parent,"action",this.startaction)},parse:function(a){return a},url:function(){var a=this.parameters?"?"+$.param(this.parameters):"",b=this.parent?this.parent.get("objectType")+"s/"+this.parent.id:"";return Cloudwalkers.Session.api+"/"+b+"/actions"+a},rendertokens:function(a){var b,c=[],d=this.parent.get("stats");a||(a=this.parent.get("actiontokens"));for(var e in a)token=a[e],b=this.templates[token],b&&(d&&(b=this.appendstat(token)),c.push(b));return c},appendstat:function(a){if(this.templates[a]){var b={},c=this.templates[a].valuetag||null;return $.extend(b,this.templates[a]),c&&this.parent.get("stats").hasOwnProperty(c)&&(b.value=this.parent.get("stats")[c]),b}},startaction:function(a){var c,d=this.templates[a];if(this.listenTo(Cloudwalkers.RootView,a.concat(":success"),this.toggleAction),"confirm"==d.type)return void this[a](this.parent);if("growl"==d.type)return Cloudwalkers.RootView.growl(d.name,trans("The")+" "+d.token+" "+trans("is planed with success")),d.id=1,d.parent=this.parent,new b(d).destroy();"note"==d.type?Cloudwalkers.RootView.writeNote(this.parent):c="edit"==d.type?{model:this.parent}:{reference:this.parent,action:new b(d)};Cloudwalkers.RootView.compose(c)},"delete":function(a){a.deleteMessage()},like:function(){},toggleAction:function(a){var b=this.templates[a];b.toggle&&this.parent.trigger("action:toggle",a,this.templates[b.toggle])}});return c}),define(["backbone"],function(a){var b=a.Collection.extend({distantAdd:function(a){this.get(a.id)||this.add(a)},url:function(){this.parentmodel&&!this.parenttype&&(this.parenttype=this.parentmodel.get("objectType"));var a=this.parentmodel?Cloudwalkers.Session.api+"/"+this.parenttype+"/"+this.parentmodel.id:Cloudwalkers.Session.api+"/"+this.typestring;return this.endpoint&&(a+="/"+this.endpoint),this.parameters?a+"?"+$.param(this.parameters):a},parse:function(a){return this.parentmodel&&!this.parenttype&&(this.parenttype=this.parentmodel.get("objectType")),this.parentmodel&&(a=a[this.parenttype]),a&&this.setcursor(a.paging),a.paging||this.ready(),a[this.typestring]},sync:function(b,c,d){return a.sync(b,c,d)},setcursor:function(a){return a?void(this.cursor=a.cursors?a.cursors.after:!1):!1},updates:function(a){for(var b in a){var c=this.get(a[b]);c&&c.get("objectType")&&(Store.set(this.typestring,{id:a[b],outdated:!0}),c.outdated=!0,c.trigger("outdated"))}},outdated:function(a){if(!a)return this.filter(function(a){return a.outdated});this.updates([a])},touch:function(a,b,c){this.parentmodel=a,this.endpoint=this.modelstring+"ids",this.parameters=b,this.seedparameters=c,this.fetch({success:this.touchresponse.bind(this,this.url())})},touchlocal:function(a){a&&a.modelids.length?(this.cursor=a.cursor,this.seed(a.modelids),this.ready()):this.fetch({success:this.touchresponse.bind(this,this.url())})},touchresponse:function(a,b,c){var d=c[this.parenttype][this.typestring];Store.set("touches",{id:a,modelids:d,cursor:this.cursor}),this.seed(d)},seed:function(a){a||(a=[]);var b=[],c=_.compact(a.map(function(a){var c=this.models.filter(function(b){return b.id==a});return c=c.length?c[0]:Cloudwalkers.Session.user.account[this.typestring].get(a),c?this.add(c):c=this.create({id:a}),b.push(c),a},this));return c.length&&(this.endpoint=this.parentmodel?this.typestring:null,this.parameters={ids:c.join(",")},this.seedparameters&&$.extend(this.parameters,this.seedparameters),this.fetch({remove:!1})),this.trigger("seed",b),b},more:function(a,b){return this.cursor?(b.after=this.cursor,this.touch(a,b),this):!1},ready:function(){var a=this;setTimeout(function(){a.trigger("ready",a)},1,this)}});return b}),define(["Collections/BaseCollection","Models/Campaign"],function(a,b){var c=a.extend({model:b,initialize:function(){this.on("destroy",this.store.bind(this,"delete"))},url:function(){return Cloudwalkers.Session.api+"/account/"+Cloudwalkers.Session.getAccount().id+"/campaigns"},parse:function(a){return a.campaigns},store:function(a,b){"delete"==a&&Store.remove("campaigns",{id:b.id})}});return c}),define(["Collections/BaseCollection","Models/CannedResponse"],function(a,b){var c=a.extend({model:b,touched:!1,initialize:function(){Cloudwalkers.Session.user.account&&Cloudwalkers.Session.getCannedResponses().listenTo(this,"add",Cloudwalkers.Session.getCannedResponses().distantAdd)},url:function(){var a=Cloudwalkers.Session.api+"/streams/"+Cloudwalkers.Session.getAccount().id+":canned/messages";return this.parameters?a+"?"+$.param(this.parameters):a},parse:function(a){return a.stream.messages},store:function(a,b){"delete"==a&&Store.remove("campaigns",{id:b.id})},removecanned:function(a){var b;return $.each(this.models,function(c,d){return d.id==a?(b=this.models.splice(c,1),!1):void 0}.bind(this)),b?b:void 0}});return c}),define(["Collections/BaseCollection","Models/Channel"],function(a,b){var c=a.extend({model:b,initialize:function(){Cloudwalkers.Session.user.account&&(Cloudwalkers.Session.getChannels().listenTo(this,"add",Cloudwalkers.Session.getChannels().distantAdd),this.on("destroy",this.cleanModel))},url:function(){var a=this.parameters?"?"+$.param(this.parameters):"";return Cloudwalkers.Session.api+"/account/"+Cloudwalkers.Session.getAccount().id+"/channels"+a},parse:function(a){return this.parameters=!1,a.channels},distantAdd:function(a){this.get(a.id)||this.add(a)},seed:function(a){if(!a||!a.length)return[];var b=[],c=_.compact(a.map(function(a){return channel=Cloudwalkers.Session.getChannel(a),this.add(channel?channel:{id:a}),b.push(channel?channel:this.get(a)),!channel||channel.outdated?a:void 0},this));return c.length&&(this.parameters={ids:c.join(",")},this.fetch()),b},cleanModel:function(a){a.get("parent")&&Cloudwalkers.Session.getChannel(a.get("parent")).set({channels:this.pluck("id")}),Store.remove("channels",{id:a.id})},updated:function(a){for(var b in a){var c=this.get(a[b]);c&&c.get("objectType")&&(Store.set(this.typestring,{id:a[b],outdated:!0}),c.outdated=!0,c.trigger("outdated"))}},outdated:function(a){if(!a)return this.filter(function(a){return a.outdated});this.updates([a])}});return c}),define(["backbone","Collections/Users","Models/Contact"],function(a,b,c){var d=b.extend({model:c,typestring:"contacts",modelstring:"contact",parenttype:"account",comparator:"displayname",processing:!1,initialize:function(){Cloudwalkers.Session.user.account&&Cloudwalkers.Session.getContacts().listenTo(this,"add",Cloudwalkers.Session.getContacts().distantAdd)},url:function(){var a=[Cloudwalkers.Session.api,"accounts",Cloudwalkers.Session.getAccount().id];return this.endpoint&&a.push(this.typestring,this.endpoint),this.following&&a.push(this.modelstring+"ids",this.following),this.parameters&&a.push(this.typestring+"?"+$.param(this.parameters)),a.join("/")},parse:function(a){return this.parameters="",this.processing=!1,a[this.typestring]?a[this.typestring]:a.account[this.typestring]},sync:function(b,c,d){return"read"==b&&(this.processing=!0),d.parameters&&(this.parameters=d.parameters),d.following||(this.following=!1),a.sync(b,c,d)},touch:function(a,b){a?(this.parentmodel=a,this.endpoint=this.modelstring+"ids",this.parameters=b):this.following="following?"+$.param(b),this.fetch({following:!a,success:this.touchresponse.bind(this,this.url())})},updates:function(a){for(var b in a){var c=this.get(a[b]);c&&c.get("objectType")&&(Store.set(this.typestring,{id:a[b],outdated:!0}),c.outdated=!0,c.trigger("outdated"))}},outdated:function(a){if(!a)return this.filter(function(a){return a.outdated});this.updates([a])}});return d}),define(["Collections/BaseCollection","backbone","Models/Group"],function(a,b,c){var d=a.extend({model:c,typestring:"groups",modelstring:"group",parenttype:"account",processing:!1,initialize:function(a){a&&$.extend(this,a)},parse:function(a){return"user"==this.modelstring?a.group.users:a.account.groups},url:function(){var a=[CONFIG_BASE_URL+"json"];return"user"==this.modelstring?a.push(this.parenttype+"/"+this.parentmodel.groupid):(a.push(this.parenttype+"/"+Cloudwalkers.Session.getAccount().id),this.typestring&&a.push(this.typestring)),this.endpoint&&a.push(this.endpoint),this.parameters&&a.push(this.parameters),a=a.join("/")},sync:function(a,c,d){return"read"==a&&(this.processing=!0,this.parameters=this.parameters?"?"+$.param(this.parameters):""),b.sync(a,c,d)},updates:function(a){for(var b in a){var c=this.get(a[b]);c&&(Store.set(this.typestring,{id:a[b],outdated:!0}),c.outdated=!0,c.trigger("outdated"))}},outdated:function(a){if(!a)return this.filter(function(a){return a.outdated});this.updates([a])},hook:function(a){a.records&&(this.parameters.records=a.records),this.processing?this.length&&a.success(this):this.fetch({error:a.error}),this.on("sync",a.success)}});return d}),define(["Collections/BaseCollection","Models/Message"],function(a,b){var c=a.extend({model:b,typestring:"messages",modelstring:"message",parameters:{},paging:{},cursor:!1,events:{remove:"destroy"},initialize:function(a){a&&$.extend(this,a),Cloudwalkers.Session.user.account&&Cloudwalkers.Session.getMessages().listenTo(this,"add",Cloudwalkers.Session.getMessages().distantAdd),this.on("sync",function(){setTimeout(function(){this.isempty()}.bind(this),1)})},destroy:function(){this.reset()},isempty:function(){0===this.length&&this.trigger("ready:empty")}});return c}),define(["Collections/BaseCollection","Models/Note"],function(a,b){var c=a.extend({model:b,typestring:"notes",modelstring:"note",parameters:{},paging:{},cursor:!1,events:{remove:"destroy"},initialize:function(a,b){b&&$.extend(this,b),this.on("sync",function(){setTimeout(function(){this.isempty()}.bind(this),1)})},destroy:function(){console.log("collection destroyed"),this.reset()},isempty:function(){0===this.length&&this.trigger("ready:empty")},url:function(){var a=[Cloudwalkers.Session.api];return this.id?a.push(this.typestring,this.id):this.parentmodel?"contacts"!=this.parentmodel.typestring?a.push(this.parentmodel.typestring,this.parentmodel.id,this.endpoint):"contacts"==this.parent.typestring&&(a.push("accounts/"+Cloudwalkers.Session.getAccount().id+"/contacts"),a.push(this.parent.id),a.push(this.typestring)):a.push(this.typestring),a=a.join("/"),this.parameters?a+"?"+$.param(this.parameters):a}});return c}),define(["Collections/Messages","Models/Notification"],function(a,b){var c=a.extend({model:b,typestring:"notifications",modelstring:"notification",initialize:function(){Cloudwalkers.Session.user.account&&Cloudwalkers.Session.getNotifications().listenTo(this,"add",Cloudwalkers.Session.getNotifications().distantAdd),this.on("destroy",this.destroy),this.on("sync",function(){setTimeout(function(){this.isempty()}.bind(this),1)})}});return c}),define(["Collections/Messages"],function(a){var b=a.extend({typestring:"related",modelstring:"related",parenttype:"message"});return b}),define(["Collections/Notes"],function(a){var b=a.extend({typestring:"related",modelstring:"related",parenttype:"note"});return b}),define(["backbone","Models/Report"],function(a,b){var c=a.Collection.extend({model:b,typestring:"statistics",modelstring:"report",processing:!1,parameters:{},paging:{},cursor:!1,initialize:function(a){a&&$.extend(this,a),Cloudwalkers.Session.user.account&&Cloudwalkers.Session.getReports().listenTo(this,"add",Cloudwalkers.Session.getReports().distantAdd)},distantAdd:function(a){this.get(a.id)||this.add(a)},url:function(){return Cloudwalkers.Session.api+"/streams/"+this.streamid+"/reports?complete=1"},parse:function(a){this.parentmodel&&(a=a[this.parenttype]);for(var b in a.reports)a.reports[b].streamid=this.streamid;return a.reports},sync:function(b,c,d){return d.headers={Authorization:"Bearer "+Cloudwalkers.Session.authenticationtoken,Accept:"application/json"},this.processing=!0,a.sync(b,c,d)},hook:function(a){this.processing?this.length&&a.success():this.fetch({error:a.error}),this.on("sync",a.success)},setcursor:function(a){return a?void(this.cursor=a.cursors?a.cursors.after:!1):!1},touch:function(a,b){this.parentmodel=a,this.endpoint=this.modelstring+"ids",this.parameters=b,Store.get("touches",{id:this.url(),ping:Cloudwalkers.Session.getPing().cursor},this.touchlocal.bind(this))},touchlocal:function(a){a&&a.modelids.length?(this.seed(a.modelids),this.cursor=a.cursor):this.fetch({success:this.touchresponse.bind(this,this.url())})},touchresponse:function(a,b,c){var d=c[this.parenttype][this.typestring];Store.set("touches",{id:a,modelids:d,cursor:this.cursor,ping:Cloudwalkers.Session.getPing().cursor}),this.seed(d)},seed:function(a){a||(a=[]);var b=[],c=_.compact(a.map(function(a){return model=Cloudwalkers.Session.getReport(a),this.add(model?model:{id:a}),model||(model=this.get(a)),b.push(model.stamp()),model&&model.get("objectType")&&!model.outdated?void 0:a},this));return c.length&&(this.endpoint=this.parentmodel?this.typestring:null,this.parameters={ids:c.join(",")},this.fetch()),this.trigger("seed",b),b}});return c}),define(["Collections/BaseCollection","backbone","Models/Service"],function(a,b,c){var d=a.extend({model:c,endpoint:"",initialize:function(){this.on("add",this.model.updateStreams)},url:function(){return Cloudwalkers.Session.api+"/accounts/"+Cloudwalkers.Session.getAccount().id+"/services"+this.endpoint},parse:function(a){return a.services?(this.available=a.services.available,void this.trigger("available:ready",this,a.services.available)):(this.ready(),a.account.services)},sync:function(a,c,d){return this.endpoint=d.endpoint?"/"+d.endpoint:"",b.sync(a,c,d)},fetchAvailable:function(){this.fetch({endpoint:"available"})}});return d}),define(["Collections/BaseCollection","Models/Statistic","Models/Stream"],function(a,b,c){var d=a.extend({model:b,typestring:"statistics",modelstring:"statistic",parenttype:"account",networkcolors:{facebook:"#3B5998",twitter:"#01a9da",linkedin:"#1783BC",tumblr:"#385775","google-plus":"#DD4C39",youtube:"#CC181E",web:"#f39501",blog:"#f39501","mobile-phone":"#E2EAE9",others:"#E5E5E5"},colors:["#D97041","#C7604C","#21323D","#9D9B7F","#7D4F6D","#584A5E"],processing:!1,parameters:{},paging:{},cursor:!1,initialize:function(a){a&&$.extend(this,a),Cloudwalkers.Session.user.account&&Cloudwalkers.Session.getReports().listenTo(this,"add",Cloudwalkers.Session.getReports().distantAdd)},url:function(){this.parentmodel&&!this.parenttype&&(this.parenttype=this.parentmodel.get("objectType"));var a=Cloudwalkers.Session.api+"/accounts/"+this.parentmodel.id;return this.endpoint&&(a+="/"+this.endpoint),a},touch:function(a){this.parentmodel=Cloudwalkers.Session.getAccount(),this.endpoint=this.modelstring+"ids",this.fetch({data:a,success:this.touchresponse.bind(this)})},touchresponse:function(a,b){var c=b.account.statistics;this.endpoint=this.modelstring+"s",c.length?(this.fetch({reset:!0,data:{ids:c.join(",")},success:this.trigger.bind(this,"sync:data")}),this.trigger("seed",c)):this.trigger("sync:noresults")},latest:function(){return this.at(this.length-1)},first:function(){return this.at(0)},place:function(a){return this.at(a)},parse:function(a){return"string"==typeof a&&console.log("is string"),this.parentmodel&&(a=a[this.parenttype]),this.setcursor(a.paging),a.paging||this.ready(),a[this.typestring]},contacts:function(a){var b=this.latest(),c=[];return b.get("streams")?(a||$.each(b.get("streams"),function(a,b){var d=Cloudwalkers.Session.getStream(b.id);if(d){var e=d.get("network").token,f=logcontacts;f&&c.push({color:this.networkcolors[e],value:Number(f)})}}.bind(this)),c):c},age:function(){var a=[];return{counter:a}},gender:function(){var a=[];return{counter:a}},regional:function(){var a=[];return{counter:a}},countries:function(){var a=[];return{counter:a}},cities:function(){var a=[];return{counter:a}},besttime:function(){var a=[];return{counter:a}},activity:function(){var a=[];return{counter:a}},parsebesttime:function(a){var b,d,e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],f=[],g=0,h=0,i=this.models;return this.length>7&&(i=i.splice(7,i.length-1)),$.each(e,function(j){var k=i[j],l=[];if(k&&k.get("streams")){var m=k.get("streams");$.each(m,function(d,e){if(a&&a!=e.id)return!0;if(e=new c(e),b=e.getbesttime()){0===l.length&&(l=_.values(b));for(var f in b)l[f]+=b[f],l[f]>g&&(g=l[f]),l[f]>h&&(h=l[f])}})}d=l.length>0?l.indexOf(Math.max.apply(Math,_.values(l))):-1,f.push({day:e.shift(),value:h,time:d}),h=0}),f.maxvalue=g,f}});return d}),define(["Collections/BaseCollection","Models/Stream"],function(a,b){var c=a.extend({model:b,initialize:function(){Cloudwalkers.Session.user.account&&Cloudwalkers.Session.getStreams().listenTo(this,"add",Cloudwalkers.Session.getStreams().distantAdd)},url:function(){var a=this.parameters?"?"+$.param(this.parameters):"";return Cloudwalkers.Session.api+"/account/"+Cloudwalkers.Session.getAccount().id+"/streams"+a},parse:function(a){return this.parameters=!1,a.streams},updates:function(a){for(var b in a){var c=this.get(a[b]);c&&c.get("objectType")&&(Store.set(this.typestring,{id:c.id,outdated:!0}),c.outdated=!0,c.trigger("outdated",c))}},outdated:function(a){if(!a)return this.filter(function(a){return a.outdated});this.updates([a])},seed:function(a){if(!a||!a.length)return[];var b=[],c=_.compact(a.map(function(a){return stream=Cloudwalkers.Session.getStream(a),this.add(stream?stream:{id:a}),b.push(stream?stream:this.get(a)),stream?void 0:a},this));return c.length&&(this.parameters={ids:c.join(",")},this.fetch()),b},parsecontacts:function(){console.log(this)},filterNetworks:function(a,b){a||(a=this.models);var c={};if($.each(a,function(a,b){var d=b.attributes?b.get("network"):b.network;c[d.token]||(c[d.token]={ids:[],icon:d.icon,token:d.token}),c[d.token].ids.push(b.id)}),!b)return c;var d=[];return $.each(c,function(a,b){b.ids=b.ids.join(" "),d.push(b)}),d},filterReportStreams:function(){var a={};return a}});return c}),define(["Collections/BaseCollection","Models/Trigger"],function(a,b){var c=a.extend({model:b,typestring:"triggers",parse:function(a){return a.account.triggers},url:function(){var a=[Cloudwalkers.Session.api];return this.parent?a.push(this.parent.typestring,this.parent.id,this.typestring):this.typestring&&a.push(this.typestring),a.join("/")}});return c}),define(["Collections/BaseCollection","backbone","Models/User"],function(a,b,c){var d=a.extend({model:c,typestring:"users",modelstring:"user",parenttype:"account",processing:!1,initialize:function(a){a&&$.extend(this,a),Cloudwalkers.Session.user.account&&Cloudwalkers.Session.getUsers().listenTo(this,"add",Cloudwalkers.Session.getUsers().distantAdd)},parse:function(a){return this.parentmodel&&(a=a[this.parenttype]),a&&this.setcursor(a.paging),a.paging||this.ready(),this.processing=!1,a[this.typestring]},url:function(){return Cloudwalkers.Session.api+"/account/"+Cloudwalkers.Session.getAccount().id+"/"+this.typestring+this.parameters},sync:function(a,c,d){return"read"==a&&(this.processing=!0,this.parameters=this.parameters?"?"+$.param(this.parameters):"",d.parameters&&(this.parameters="?"+$.param(d.parameters))),b.sync(a,c,d)},updates:function(a){for(var b in a){var c=this.get(a[b]);c&&(Store.set(this.typestring,{id:a[b],outdated:!0}),c.outdated=!0,c.trigger("outdated"))}},outdated:function(a){if(!a)return this.filter(function(a){return a.outdated});this.updates([a])},hook:function(a){a.records&&(this.parameters.records=a.records),this.processing?this.length&&a.success(this):this.fetch({error:a.error}),this.on("sync",a.success)}});return d}),define(["backbone","Collections/Channels","Collections/Streams","Collections/Campaigns","Collections/Users","Collections/Contacts","Collections/Messages","Collections/CannedResponses","Collections/Notes","Collections/Notifications","Collections/Statistics","Collections/Reports"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=a.Model.extend({typestring:"accounts",endpoint:"",limits:{users:50,networks:15,keywords:10},initialize:function(){this.channels=new b,this.streams=new c,this.campaigns=new d,this.users=new e,this.contacts=new f,this.messages=new g,this.cannedresponses=new h,this.notes=new i,this.notifications=new j,this.statistics=new k,this.reports=new l},parse:function(a){return this.endpoint="",Store.set("accounts",a.account),a.account},url:function(){return Cloudwalkers.Session.api+"/account/"+this.id+this.endpoint},sync:function(b,c,d){return this.endpoint=d.endpoint?"/"+d.endpoint:"",a.sync(b,c,d)},firstload:function(){$.each(this.get("channels"),function(a,b){Cloudwalkers.Session.storeChannel(b)})},activate:function(){Store.exists("channels")||this.firstload(),this.cannedresponses.fetch({parameters:{records:50}}),Store.filter("streams",null,function(a){this.streams.add(a)}.bind(this)),Store.filter("channels",null,function(a){this.channels.add(a)}.bind(this)),Store.filter("campaigns",null,function(a){this.campaigns.add(a)}.bind(this)),Store.filter("users",null,function(a){this.users.add(a)}.bind(this)),Store.filter("messages",null,function(a){this.messages.add(a)}.bind(this)),Store.filter("statistics",null,function(a){this.statistics.add(a)}.bind(this)),this.get("plan")&&(this.limits=this.get("plan").limits)},loaded:function(a){return void 0!==this.get(a?a:"objectType")},monitorlimit:function(a,b,c,d){if(b>=this.limits[a]){var e="Upgrade?",f="You're fresh out of "+a+" slots, maybe you should upgrade.";return $(".alert-info").remove(),d?Cloudwalkers.RootView.alert(e+" "+f):Cloudwalkers.RootView.information(e,f),c&&("string"==typeof c&&(c=$(c)),c.addClass("limited").attr("disabled",!0)),!0}return $("[disabled].limited").size()&&($("[disabled].limited").removeClass("limited").attr("disabled",!1),$("[data-dismiss=alert]").click()),!1},usersbyrole:function(a){var b=this.get("roles"),c=b?_.findWhere(b,{name:a}):null,d=this.users.models;return c?d.filter(function(a){return a.get("rolegroup")==c.id}):[]},addcampaign:function(a,b){var c=this.get("campaigns");c.map(function(a){return a.name}).indexOf(a)<0&&(c.push({name:a}),this.save({campaigns:c},{patch:!0,wait:!0,success:b}))},removecampaign:function(b,c){this.endpoint="/campaigns/"+b;var d=a.Model.extend({}),e=new d({id:b});e.destroy({url:this.url(),success:function(){var a=this.get("campaigns");a.forEach(function(c,d){c.id==b&&a.splice(d,1)}),Cloudwalkers.RootView.growl(trans("User Profile"),trans("Campaign successfully removed.")),$(c).closest("li").remove()}.bind(this)})}});return m}),define(["backbone"],function(a){var b=a.Model.extend({typestring:"actions",initialize:function(a,b){a&&$.extend(this,a),b&&(this.parent=b.collection.parent)},url:function(){var a=[Cloudwalkers.Session.api];return this.parent&&a.push(this.parent.typestring,this.parent.id),this.typestring&&a.push(this.typestring),this.get("actiontype")&&a.push(this.get("actiontype")),a=a.join("/"),this.parameters?a+"?"+$.param(this.parameters):a},parse:function(a){return this.parent&&a[this.parent.get("objectType")]?a=a[this.parent.get("objectType")]:this.parent&&"comment"==this.parent.get("objectType")&&(a=a.message),a},sync:function(b,c,d){return this.endpoint=d.endpoint?"/"+d.endpoint:!1,"update"==b?!1:a.sync(b,c,d)},loaded:function(a){return void 0!==this.get(a?a:"objectType")}});return b}),define(["backbone"],function(a){var b=a.Model.extend({url:function(){return this.endpoint?Cloudwalkers.Session.api+"/"+this.typestring+"/"+this.id+this.endpoint:Cloudwalkers.Session.api+"/"+this.typestring+"/"+this.id},parse:function(a){return"number"==typeof a?a={id:a}:this.stamp(a),a},sync:function(b,c,d){return this.endpoint=d.endpoint?"/"+d.endpoint:!1,"update"==b?!1:a.sync(b,c,d)},stamp:function(a){return a||(a={id:this.id}),a.stamp=Math.round(.001*(new Date).getTime()),Store.set(this.typestring,a),this},loaded:function(a){return void 0!==this.get(a?a:"objectType")}});return b}),define(["backbone"],function(a){var b=a.Model.extend({initialize:function(){}});return b}),define(["backbone"],function(a){var b=a.Model.extend({typestring:"messages",initialize:function(){this.streams=Cloudwalkers.Session.getStreams("canned")},url:function(){var a=[Cloudwalkers.Session.api];return this.id?a.push(this.typestring+"/"+this.id):this.id||a.push("accounts/"+Cloudwalkers.Session.getAccount().id+"/"+this.typestring),a.join("/")},parse:function(a){return a.message?a.message:a},sync:function(b,c,d){return this.endpoint=d.endpoint?"/"+d.endpoint:!1,"update"==b?!1:a.sync(b,c,d)},loaded:function(a){return void 0!==this.get(a?a:"objectType")},deletecanned:function(){var a=this;Cloudwalkers.RootView.confirm(trans("Are you sure you want to remove this template?"),function(){a.destroy({success:function(){a.trigger("destroyed")}})})}});return b}),define(["backbone","Collections/Contacts","Collections/Messages","Collections/Channels","Collections/Notifications","Collections/Streams"],function(a,b,c,d,e,f){var g=a.Model.extend({endpoint:"",parameters:"",initialize:function(){d||(d=require("Collections/Channels")),this.channels=new d,this.channels.seed(this.get("channels")),this.streams=new f,this.streams.seed(this.get("streams")),this.messages=new c,this.notifications=new e,this.contacts=new b,this.on("change",function(a){Store.set("channels",a.attributes)}),this.listenTo(this.messages,"change:from",this.seedcontacts),this.listenTo(this.notifications,"change:from",this.seedcontacts)},url:function(){var a=this.id?this.id:"";return Cloudwalkers.Session.api+"/channel/"+a+this.endpoint+this.parameters},parse:function(a){return a.error?[]:(Store.set("channels",a.channel),a.channel)},sync:function(b,c,d){return"read"==b?(this.endpoint=d.endpoint?"/"+d.endpoint:"",this.parameters=d.parameters?"?"+$.param(d.parameters):""):"create"==b?this.endpoint=d.parent?d.parent+"/channels":"":"delete"==b&&(this.endpoint=""),a.sync(b,c,d)},loaded:function(a){return void 0!==this.get(a?a:"objectType")},getStream:function(a){var b={};return b["string"==typeof a?"token":"id"]=a,this.streams.findWhere(b)},seedcontacts:function(a){var b=a.get("from");b&&b.length&&this.contacts.add(b)}});return g}),define(["Models/User"],function(a){var b=a.extend({typestring:"contacts",modelstring:"contact",url:function(){var a=[Cloudwalkers.Session.api];return this.parent?a.push(this.parent.typestring,this.parent.id,this.typestring,this.id):this.id?a.push("accounts",Cloudwalkers.Session.getAccount().id,this.typestring,this.id):a.push("accounts",Cloudwalkers.Session.getAccount().id,this.typestring),this.endpoint&&a.push(this.endpoint),this.urlparams&&(a=a.concat(this.urlparams)),a=a.join("/"),this.parameters?a+"?"+$.param(this.parameters):a},sync:function(a,b,c){return"read"==a&&c.endpoint&&(this.endpoint=c.endpoint),Backbone.sync(a,b,c)},parse:function(a){return a[this.modelstring]&&(a=a[this.modelstring]),this.endpoint&&a[this.endpoint]&&(a=a[this.endpoint]),"number"==typeof a?a={id:a}:this.stamp(a),a},initialize:function(){this.gender=this.get("gender")},getMales:function(){return this.gender?this.gender.male:0},getFemales:function(){return this.gender?this.gender.female:0},getOthers:function(){return this.gender?this.gender.other:0},getGender:function(){return this.gender?this.gender:!1},getAge:function(){return this.age?this.age:!1}});return b}),define(["backbone"],function(a){var b=a.Model.extend({url:function(){return this.parent?CONFIG_BASE_URL+"json/"+this.parent.typestring+"/"+this.parent.id+"/"+this.typestring+"/"+this.id:CONFIG_BASE_URL+"json/group/"+this.id},parse:function(a){return"number"==typeof a?a={id:a}:this.stamp(a),a},sync:function(b,c,d){return this.endpoint=d.endpoint?"/"+d.endpoint:!1,"update"==b?!1:a.sync(b,c,d)},loaded:function(a){return void 0!==this.get(a?a:"objectType")},filterData:function(a){var b=this.attributes;return"listitem"==a?b.arrow=!0:b.role=this.getRole().name,b},getRole:function(){return 10==this.get("level")?"Administrator":"Co-worker"}});return b}),define(["Models/User","Collections/Accounts"],function(a,b){var c=a.extend({unreadMessages:null,initialize:function(){this.once("change",this.activate),this.on("change:id",function(){this.previous("id")&&Cloudwalkers.Session.home()})},url:function(){var a=this.endpoint?this.endpoint:Store.exists("me")?"?include_accounts=ids":"";return Cloudwalkers.Session.api+"/user/me"+a},parse:function(a){return Store.exists("me")||(a.user=this.firstload(a.user)),Store.write("me",[a.user]),this.reload&&(this.reload=!1),a.user},sync:function(a,b,c){return this.endpoint=c.endpoint?"/"+c.endpoint:!1,"read"==a&&Store.get("me",null,function(a){a&&this.set(a)
}.bind(this)),Backbone.sync(a,b,c)},firstload:function(a){return $.each(a.accounts,function(a,b){Store.set("accounts",b)}.bind(this)),a.settings.currentAccount||(a.settings={currentAccount:a.accounts[0].id}),a},activate:function(){return this.get("accounts").length?void Store.filter("accounts",null,function(a){this.accounts=new b(a),this.account=this.getCurrentAccount(),this.account.activate(),this.set("level",Number(this.account.get("currentuser").level)),this.set("rolegroup",Number(this.account.get("currentuser").rolegroup)),this.authorized=this.account.get("currentuser").authorized,this.removerole("ACCOUNT_TAGS_VIEW"),this.removerole("ACCOUNT_TAGS_MANAGE"),this.parseauthorized(),this.censuretokens=this.censure(this.authorized),this.trigger("activated")}.bind(this)):Cloudwalkers.Router.exception(401)},isauthorized:function(a){return _.isArray(a)?0!==_.intersection(this.authorized,a).length:_.contains(this.authorized,a)},removerole:function(a){var b=this.authorized.indexOf(a);b>=0&&this.authorized.splice(b,b+1)},censure:function(a){var b={};for(var c in a)b[a[c]]=!0;return b},parseauthorized:function(){this.isauthorized(["MESSAGE_OUT_EDIT_OWN","MESSAGE_ACTIONS"])&&this.authorized.push("_CW_COWORKERS_VIEW"),this.isauthorized(["MESSAGE_READ_INBOX_MESSAGES","MESSAGE_READ_INBOX_NOTIFICATIONS","MESSAGE_READ_SCHEDULE","MESSAGE_READ_DRAFTS","ACCOUNT_NOTES_VIEW"])&&this.authorized.push("_CW_INBOX_VIEW")},offline:function(){Cloudwalkers.Session.reset(),window.location="/login.html"},getCurrentAccount:function(){var a=Cloudwalkers.Session.get("currentAccount");a||(a=this.accounts.at(0).id,this.save({settings:{currentAccount:a}}));var b=this.accounts.get(Number(a));return b&&b.id?b:(this.save({settings:{currentAccount:this.accounts.at(0).id}}),Cloudwalkers.Session.home())}});return c}),define(["backbone","Collections/Actions","Collections/Notes",,"Utilities/Utils"],function(a,b,c,d,e){var f=a.Model.extend({typestring:"messages",limits:{twitter:140,linkedin:700},initialize:function(){var a=require("Collections/Notifications");"undefined"!=typeof this.attributes.parent&&(this.set("parentmodel",new f(this.attributes.parent)),this.get("parentmodel").trigger("change")),this.actions=new b(!1,{parent:this}),this.notes=new c(!1,{parent:this}),this.listenToOnce(this.notes,"add",this.updatecollection.bind(this,this.notes)),this.notifications=new a(!1,{parent:this})},url:function(a){return this.id?this.endpoint?Cloudwalkers.Session.api+"/"+this.typestring+"/"+this.id+this.endpoint:Cloudwalkers.Session.api+"/"+this.typestring+"/"+this.id:(a=this.parameters,this.endpoint?Cloudwalkers.Session.api+"/accounts/"+Cloudwalkers.Session.getAccount().id+"/"+this.typestring+this.endpoint+a:Cloudwalkers.Session.api+"/accounts/"+Cloudwalkers.Session.getAccount().id+"/"+this.typestring)},parse:function(a){return"number"==typeof a?{id:a}:(a.message&&(a=a.message),a=this.filterData(a),this.stamp(a),this.checkloaded(a),a)},stamp:function(a){return a||(a={id:this.id}),a.stamp=Math.round(.001*(new Date).getTime()),Store.set(this.typestring,a),this},sync:function(b,c,d){return this.endpoint=d.endpoint?"/"+d.endpoint:!1,"update"==b?!1:a.sync(b,c,d)},loaded:function(a){return void 0!==this.get(a?a:"objectType")},updatecollection:function(a){a.updated=!0},updateactions:function(a){var b=a.get("actionresult")?a.get("actionresult").models.update[0]:null;b&&$.extend(this.attributes,b)},validateCustom:function(a){var b;return!this.hascontent()&&$.inArray("content",a)<0?trans("You need a bit of content."):this.validatecontent()?!this.get("streams").length&&$.inArray("streams",a)<0?trans("Please select a network first."):(b=this.validateschedules())&&$.inArray("schedule",a)<0?b:void 0:trans("One or more networks exceed the character limit.")},validateschedules:function(){var a;return(a=this.validateschedule(this.get("schedule")))?a:($.each(this.get("variations"),function(b,c){return a=this.validateschedule(c.schedule),a?!1:!0}.bind(this)),a)},validateschedule:function(a){if(!a)return!1;var b=a.date||null,c=a.repeat?a.repeat.until:null;return b&&b<moment().unix()?"One or more streams are scheduled into the past.":b&&c&&b>c?"One or more streams have the repeat date happening before the scheduled date.":!b&&c&&c<moment().unix()?"One or more streams have the repeat date set to the past.":!1},hascontent:function(){var a;return this.get("attachments")&&this.get("attachments").length?this.get("attachments").length:this.get("body").plaintext?this.get("body").plaintext.length:this.get("variations")&&this.get("variations").length?($.each(this.get("variations"),function(b,c){return c.attachments&&c.attachments.length?(a=c.attachments.length,!1):c.body&&c.body.plaintext?(a=c.body.plaintext.length,!1):void 0}.bind(this)),a):void 0},validatecontent:function(){var a,b=1;return this.get("streams")&&this.get("streams").length&&$.each(this.get("streams"),function(c,d){var e=Cloudwalkers.Session.getStream(d).get("network"),f=e.limitations["max-length"]?e.limitations["max-length"].limit:null;if(!f)return!0;if(a=this.getvariation(d)){if(a.body&&a.body.plaintext)return b=f-a.body.plaintext.length,0>b?!1:!0}else if(this.get("body")&&this.get("body").plaintext&&(b=f-this.get("body").plaintext.length,0>b))return!1}.bind(this)),b>0},sanitizepost:function(){this.attributes.body.html&&delete this.attributes.body.html,this.attributes.variations&&this.attributes.variations.forEach(function(a,b){a.body&&(a.body.plaintext?a.body.html&&delete a.body.html:delete a.body),this.attributes.streams.indexOf(a.stream)<0&&this.attributes.variations.splice(b,1)}.bind(this))},cloneSanitized:function(a){var b=new f;return $.extend(!0,b,this),b.attributes.date&&delete b.attributes.date,b.attributes.from&&delete b.attributes.from,b.attributes.stream&&!a&&delete b.attributes.stream,a||(b.attributes.streams=[]),b.id&&(delete b.id,delete b.attributes.id),b},checkloaded:function(a){var b=this;a.objectType&&setTimeout(function(){b.trigger("loaded")},1,this)},filterData:function(a){a.message&&a.message.body&&(a=a.message);var b={},c=["id","objectType","actiontokens","subject","body","date","engagement","from","read","stream","streams","attachments","parent","statistics","stats","status","canHaveChildren","children_count","schedule","variations","url"];$.each(c,function(c,d){void 0!==a[d]&&(b[d]=a[d])});var d=Cloudwalkers.Session.getStream(a.stream);return d&&(b.icon=d.get("network").icon,b.networktoken=d.get("network").token,b.networkdescription=d.get("name")),a.attachments?(a.attachments.length&&(b.media=a.attachments[a.attachments.length-1],b.media="image"==b.media.type?"picture":b.media.type),b.attached={},$.each(a.attachments,function(a,c){b.attached[c.type]=c})):b.media="reorder",a.engagement&&(b.trending=a.engagement<1e3?a.engagement:"+999"),b.schedule&&(b.scheduledate=moment(b.schedule.date).format("DD MMM YYYY HH:mm")),b.body.intro=a.body.plaintext?a.body.plaintext.substr(0,72):" ",a.date&&(b.fulldate=moment(a.date).format("DD MMM YYYY HH:mm"),b.dateonly=moment(a.date).format("DD MMM YYYY"),b.time=moment(a.date).format("HH:mm")),b},generateintro:function(){this.get("body")&&!this.get("body").intro&&(this.attributes.body.intro=this.get("body").plaintext.substr(0,72))},filterActions:function(){if(!this.get("actiontokens"))return[];var a=this.actions.rendertokens();return a.map(function(a){return"note"==a.token&&this.notes.updated&&(a.value=this.notes.length),a}.bind(this)),a},filterCalReadable:function(){var a=this.get("objectType"),b=a&&"reorder"!=this.get("media");return this.calNode||(this.calNode={id:this.id}),this.calNode.start=this.get("schedule")?a?$.fullCalendar.moment(this.get("scheduledate")):$.fullCalendar.moment():a?$.fullCalendar.moment(this.get("date")):$.fullCalendar.moment(),this.calNode.title=a?(this.get("title")?this.get("title"):this.get("body").plaintext).substring(0,b?12:16):"...",this.calNode.className=a?this.get("networktoken")+"-color":"hidden",this.calNode.networkdescription=a?this.get("networkdescription"):null,this.calNode.intro=a?this.get("body").intro:null,this.calNode.icon=a?this.get("icon"):null,this.calNode.media=b?this.get("media"):null,a&&this.calNode.intro.length>=72&&(this.calNode.intro+="..."),this},attach:function(a,b){var c=this.get("attachments")||[],d=b&&c[b]?$.extend(c[b],a):c.push(a);return this.set({attachments:c}),d},unattach:function(a){var b=this.get("attachments")||[];b.splice(a,1)},addcampaign:function(){},setvariation:function(a,b,c){var d,e=this.get("variations")||[],f=e.filter(function(b){return b.stream==a?b:void 0});if(0===f.length)f={stream:a},"image"==b||"link"==b?(d=[c],f.attachments=d):b&&(f[b]=c),e.push(f);else if(f=f[0],"image"==b||"link"==b)if(d=f.attachments||[],0===d.length&&"image"==b)d.push(c),f.attachments=d;else if("image"==b)d.push(c);else{var g=d.filter(function(a){return"link"==a.type?a:void 0});g.length>0?g[0].url=c.url:0!==d.length?f.attachments.push(c):f.attachments=[c]}else f[b]=c;return f},getvariation:function(a,b){var c=this.get("variations")||[],d=_.findWhere(c,{stream:a});return"image"!=b&&"link"!=b?d&&d[b]?d[b]:d&&!b?d:void 0:d&&d.attachments?d.attachments.filter(function(a){return a.type==b?a:void 0}):void 0},original:function(a,b,c){var d=this.get("variations")?this.get("variations").filter(function(b){return a&&b.stream==a.id}):[],e=a?d.length?d[0]:{stream:a.id}:this.attributes;return void 0!==c&&(e[b]=c,a&&!d.length&&this.get("variations").push(e)),e[b]},removevariation:function(a){var b=this.get("variations");b&&$.each(b,function(c,d){return d.stream==a?(b.splice(c,1),!1):void 0})},removevarimg:function(a,b){var c=this.getvariation(a),d=c?c.attachments:[];if(_.isNumber(b))this.addexclude(a,b);else for(var e in d)"image"==d[e].type&&d[e].name==b&&d.splice(e,1)},addexclude:function(a,b){{var c=this.getvariation(a)||this.setvariation(a);c.excludes}c.excludes?c.excludes.attachments.push(b):c.excludes={attachments:[b]}},checkexclude:function(a,b){var c,d=this.getvariation(a);if(!d)return!1;if(c=d.excludes)for(var e in c.attachments)if(c.attachments[e]==b)return!0;return!1},location:function(){return"#"},getActionIcon:function(a){return"internal-share"==a.token?"share":"internal-edit"==a.token?"edit":"internal-delete"==a.token?"remove":"delete"==a.token?"remove":"like"==a.token?"thumbs-up":"unlike"==a.token?"thumbs-down":"comment"==a.token?"comment-alt":"reply"==a.token?"comment":"retweet"==a.token?"retweet":"dm"==a.token?"envelope":"internal-reply"==a.token?"comment":"favorite"==a.token?"star":"unfavorite"==a.token?"star-o":a.token},deleteMessage:function(){this.repeat().repeat?Cloudwalkers.RootView.dialog(trans("Are you sure you want to remove this message?"),[{label:trans("Skip once"),description:trans("Message will be skipped once"),token:"skip"},{label:trans("Delete forever"),description:trans("Message will never be repeated"),token:"remove"}],this.deletetype.bind(this)):Cloudwalkers.RootView.confirm(trans("Are you sure you want to remove this message?"),function(){this.destroy({success:this.destroysuccess.bind(this)})}.bind(this))},deletetype:function(a){"skip"==a.token&&this.save({trigger:Math.random()},{patch:!0,endpoint:"skip",success:this.skipwatcher.bind(this)}),"remove"==a.token&&this.destroy({wait:!0,success:this.destroysuccess.bind(this)})},destroysuccess:function(){this.trigger("destroyed",this,this.collection),this.trigger("destroy",this,this.collection)},skipwatcher:function(a){"REMOVED"==a.get("status")&&this.destroysuccess()},humandate:function(a){var b=new Date(a?a:this.get("date"));return e.longdate(b)},shortdate:function(){var a=this.date();return e.shortdate(a)},time:function(){var a=this.date();return e.time(a)},date:function(){return new Date(this.get("date"))},getAction:function(a){for(var b=this.get("actions"),c=0;c<b.length;c++)if(b[c].token==a)return b[c];return null},act:function(a,b,c){Cloudwalkers.RootView.growl(a.name,trans("The")+" "+a.token+" "+trans("is planed with success"));var d=this;"undefined"==typeof b&&(b={});var e={actions:[{token:a.token,parameters:b}]},f=CONFIG_BASE_URL+"json/message/"+this.get("id")+"?account="+Cloudwalkers.Session.getAccount().get("id");jQuery.ajax({data:JSON.stringify(e),dataType:"json",type:"put",url:f,processData:!1,cache:!1,success:function(a){a.removed?(d.trigger("destroy",d,d.collection),d.trigger("destroyed",d,d.collection)):d.set(a.message),c()}})},scheduledate:function(a){"undefined"==typeof a&&(a=!0);var b=this.get("schedule");return b?a?"ASAP"==b.date?b.date:this.humandate(b.date):"ASAP"==b.date?!1:new Date(b.date):!1},calculateIntervalFromSeconds:function(a){for(var b={},c=[{unit:"minutes",value:60},{unit:"hours",value:3600},{unit:"days",value:86400},{unit:"weeks",value:604800},{unit:"months",value:2678400}],d=c.length-1;d>=0;d--)if(a%c[d].value===0)return b.interval=Math.round(a/c[d].value),b.unit=c[d].unit,b;for(var e=0;e<c.length;e++)if(a/c[e].value<72)return b.interval=Math.round(a/c[e].value),b.unit=c[e].unit,b;return!1},repeat:function(){var a=this.get("schedule"),b={};if(b.repeat=!1,b.weekdays={},"undefined"!=typeof a&&"undefined"!=typeof a.repeat){b.repeat=!0;var c=this.calculateIntervalFromSeconds(a.repeat.interval);if(c&&(b.interval=c.interval,b.unit=c.unit),b.end=null,a.repeat.end&&(b.end=new Date(a.repeat.end)),a.repeat.weekdays)for(var d=0;d<a.repeat.weekdays.length;d++)b.weekdays[a.repeat.weekdays[d]]=!0}return b},getStream:function(){return this.get("stream")?Cloudwalkers.Session.getAccount().streams.get(this.get("stream")):null},getProcessedAttachments:function(){var a,b=[];if("undefined"!=typeof this.attributes.attachments)for(var c=0;c<this.attributes.attachments.length;c++)a=this.attributes.attachments[c],"link"==a.type?(null==this.attributes.body.plaintext||-1===this.attributes.body.plaintext.indexOf(a.url))&&b.push(a):b.push(a);return b},hasAttachement:function(a){if("undefined"!=typeof this.attributes.attachments){for(var b=0;b<this.attributes.attachments.length;b++)if(attachment=this.attributes.attachments[b],attachment.type==a)return this.attributes.attachments[b];return!1}},setRead:function(){if(!this.get("read")){var a=CONFIG_BASE_URL+"json/message/"+this.get("id")+"/read/";jQuery.ajax({type:"get",url:a,success:function(){}})}},shortBody:function(){var a=this.get("body");if(!a.plaintext)return{html:"",plaintext:""};var b={html:a.plaintext.substring(0,100),plaintext:a.plaintext.substring(0,100)};return b},messageAction:function(a){if(null==a)return void console.log("Action not found: "+actiontoken);var b=this;if("undefined"!=typeof a.target&&(b=a.target,"undefined"!=typeof a.originalaction&&(a=a.originalaction)),"undefined"!=typeof a.callback)a.callback(b);else if(a)if("dialog"==a.type){var c=new d({message:b,action:a});Cloudwalkers.RootView.popup(c)}else"simple"==a.type?b.act(a,{},function(){}):"write"==a.type&&Cloudwalkers.RootView.writeDialog(b,a)},hasattachements:function(){return this.get("attachments")?this.get("attachments").length>0:void 0},hasschedule:function(){return this.get("schedule")?Object.getOwnPropertyNames(this.get("schedule")).length>0:void 0},hasnotes:function(){var a=this.get("stats");return a?a.notes:void 0}});return f}),define(["backbone"],function(a){var b=a.Model.extend({parameters:{},networkcolors:{facebook:"#3B5998",twitter:"#01a9da",linkedin:"#1783BC",tumblr:"#385775","google-plus":"#DD4C39",youtube:"#CC181E",web:"#f39501",blog:"#f39501","mobile-phone":"#E2EAE9",others:"#E5E5E5",group:"#CCCCCC"},initialize:function(){this.set("color",this.networkcolors[this.get("token")])},gettoken:function(){return this.get("token")?this.get("token"):!1},getcolor:function(){return this.get("color")?this.get("color"):!1},gettitle:function(){return this.get("name")?this.get("name"):!1},geticon:function(){return this.get("icon")?this.get("icon"):!1},getcontacts:function(){return this.get("contacts")?this.get("contacts"):0},addcontacts:function(a){return this.set("contacts",this.getcontacts()+a),this}});return b}),define(["backbone","Models/Contact","Models/Account"],function(a,b,c){var d=a.Model.extend({typestring:"notes",type_settings:{CONTACT:{icon:"user",model:"Contact",typestring:"contacts"},MESSAGE:{icon:"inbox",model:"Message",typestring:"messages"},ACCOUNT:{icon:"edit",model:"Account",typestring:"accounts"}},initialize:function(){this.on("action",this.action)},parse:function(a){return"number"==typeof a?{id:a}:(a=a.note?a.note:a,a.date&&(a.fulldate=moment(a.date).format("DD MMM YYYY HH:mm"),a.dateonly=moment(a.date).format("DD MMM YYYY"),a.time=moment(a.date).format("HH:mm"),a.type_icon=this.type_settings[a.model.objectType].icon,a[a.model.objectType]=!0,a.model&&(a.objectType="note")),a.intro=a.text?a.text.substr(0,72):" ",a)},sync:function(b,c,d){return this.endpoint=d.endpoint?"/"+d.endpoint:!1,"update"==b?!1:a.sync(b,c,d)},loaded:function(a){return void 0!==this.get(a?a:"objectType")},attachParent:function(a,d){var e,f=require("Models/Message");return a=this.type_settings[a].model,e=Cloudwalkers.Session["get"+a](d),e&&e.get("objectType")||("Message"==a&&(e=new f({id:d})),"Contact"==a&&(e=new b({id:d})),"Account"==a&&(e=new c({id:d})),e.fetch()),e},url:function(){var a=[Cloudwalkers.Session.api];return this.id?a.push(this.typestring,this.id):this.parent?"contacts"!=this.parent.typestring?a.push(this.parent.typestring,this.parent.id,this.typestring):"contacts"==this.parent.typestring&&(a.push("accounts/"+Cloudwalkers.Session.getAccount().id+"/contacts"),a.push(this.parent.id),a.push(this.typestring)):a.push(this.typestring),a=a.join("/"),this.parameters?a+"?"+$.param(this.parameters):a},action:function(a){"delete"==a&&this.deletenote()},deletenote:function(){var a=this;Cloudwalkers.RootView.confirm("Are you sure you want to remove this note?",function(){a.destroy({success:function(){a.trigger("destroy"),a.trigger("destroyed")}})})}});return d}),define(["Models/Message","Collections/Actions","Collections/Notes"],function(a,b,c){var d=a.extend({initialize:function(){"undefined"!=typeof this.attributes.parent&&(this.set("parentmodel",new a(this.attributes.parent)),this.get("parentmodel").trigger("change")),this.actions=new b(!1,{parent:this}),this.notes=new c(!1,{parent:this}),this.once("destroy",function(){this.get("parentmodel").fetch()})},parse:function(a){return"number"==typeof a?{id:a}:(a=this.filterData(a),this.stamp(a),a)}});return d}),define(["backbone"],function(a){var b=a.Model.extend({initialize:function(a){a&&$.extend(this,a)},url:function(){var a=Cloudwalkers.Session.user.attributes.locale||"en_EN";return"/locales/"+a+".json"},parse:function(a){return a}});return b}),define(["backbone","Views/Charts/Barchart","Views/Charts/Comparison","Views/Charts/Intervalchart","Views/Charts/Numberstat","Views/Charts/Piechart","Views/Charts/Table","Views/Charts/Textstat"],function(a,b,c,d,e,f,g,h){var i=a.Model.extend({initialize:function(a){this.entity="undefined"!=typeof a.entity?a.entity:"report",this.type="undefined"!=typeof a.type?a.type:"time",this.isFetched=!1,this.daterange=null,this.display=null,this.interval=null,this.intervalinput=null,this.evolution=null},parse:function(a){return"number"==typeof a?{id:a}:(a.report&&(a=a.report),this.stamp(a),a)},stamp:function(a){return a||(a={id:this.id}),a.stamp=Math.round(.001*(new Date).getTime()),Store.set("reports",a),this},getDetails:function(){var a=this.attributes.series[0],b=this[this.attributes.type+"Details"](a);return b},textDetails:function(a){var b=Cloudwalkers.Session.getStream(this.get("streamid"));return{content:a.values[0].value,title:a.name,description:b.get("customname")}},comparisonDetails:function(a){var b=a.values[0].value-a.values[1].value;b>0&&(b="+ "+b);var c=a.values[1].value?" ("+(Math.round(a.values[0].value/a.values[1].value*100)-100)+"%)":"";return{content:a.values[0].value,title:"<strong>"+b+"</strong>"+c+" in last "+a.interval,description:a.name}},refresh:function(){var a=this,b=this.getDataURL();$.ajax(Cloudwalkers.Session.api+"/"+b,{success:function(b){if("undefined"==typeof b[a.entity])return console.log("Information not expected:"),void console.log(b);a.setInternalParameters(b[a.entity].series[0]);for(var c=[],d=0;d<b[a.entity].series.length;d++)c.push({values:a.processValues(b[a.entity].series[d].values)});a.trigger("dataset:change",c)},beforeSend:function(a){a.setRequestHeader("Accept","application/json"),a.setRequestHeader("Authorization","Bearer "+Cloudwalkers.Session.authenticationtoken)}})},getDataset:function(){console.log("DEPRECATION ALERT")},getDataURL:function(){var a=this.get("url")+"?";return this.daterange&&(a+="start="+Math.floor(this.daterange[0].getTime()/1e3)+"&end="+Math.floor(this.daterange[1].getTime()/1e3)+"&"),this.intervalinput&&(a+="interval="+this.intervalinput),a},getDatasetType:function(){return"bars"==this.get("type")?"category":"table"==this.get("type")?"table":"time"==this.get("type")?"time":"text"==this.get("type")?"text":"category"},getWidget:function(){var a,i=this,j=i.get("type");return"bars"==j?a=new b({model:i,title:(i.stream?i.stream.name:"")+" "+i.get("name"),stream:this.get("stream"),report:this}):"pie"==j?a=new f({model:i,title:(i.stream?i.stream.name:"")+" "+i.get("name"),stream:this.get("stream"),report:this}):"table"==j?a=new g({model:i,title:(i.stream?i.stream.name:"")+" "+i.get("name"),stream:this.get("stream"),report:this}):"time"==j?a=new d({model:i,title:(i.stream?i.stream.name:"")+" "+i.get("name"),stream:this.get("stream"),report:this}):"comparison"==j?a=new c({model:i,title:(i.stream?i.stream.name:"")+" "+i.get("name"),stream:this.get("stream"),report:this}):"number"==j?a=new e({model:i,title:(i.stream?i.stream.name:"")+" "+i.get("name"),stream:this.get("stream"),report:this}):"text"==j?a=new h({model:i,title:(i.stream?i.stream.name:"")+" "+i.get("name"),stream:this.get("stream"),report:this}):alert("Report type not found: "+j),a},setDateRange:function(a,b){this.daterange=[a,b],this.refresh()},setInterval:function(a){this.intervalinput=a},getDisplay:function(){return this.display},getInterval:function(){return this.interval},getEvolution:function(){return this.evolution},getValues:function(a){this.getSeries(function(b){a(b.length>0?b[0].values:null)})},getSeries:function(a){var b=this,c=this.getDataURL();this.isFetched=!0,$.ajax(Cloudwalkers.Session.api+"/"+c,{success:function(c){if("undefined"==typeof c[b.entity])return void a(!1);for(var d=[],e=0;e<c[b.entity].series.length;e++)d.push({values:b.processValues(c[b.entity].series[e].values)});b.setInternalParameters(c[b.entity].series[0]),a(d)},beforeSend:function(a){a.setRequestHeader("Accept","application/json"),a.setRequestHeader("Authorization","Bearer "+Cloudwalkers.Session.authenticationtoken)}})},setInternalParameters:function(a){var b=this;"undefined"!=typeof a.display&&(b.display=a.display),"undefined"!=typeof a.evolution&&(b.evolution=a.evolution),"undefined"!=typeof a.interval&&(b.interval=a.interval)},processValues:function(a){var b,c=[];if(!a)return[];if("table"==this.type)return a;for(var d=0;d<a.length;d++)b="time"==this.type?new Date(a[d].date).getTime():"category"==this.type||"text"==this.type||"pie"==this.type?a[d].category:d,c.push([b,"text"!=this.type?parseInt(a[d].value):a[d].value]);return c}});return i}),define(["backbone"],function(a){var b=a.Model.extend({typestring:"services",channels:[],initialize:function(){this.on("destroy",this.remove)},url:function(){var a=[Cloudwalkers.Session.api];return this.parentpoint&&a.push("accounts",Cloudwalkers.Session.getAccount().id),this.typestring&&a.push(this.typestring),this.id&&a.push(this.id),this.endpoint&&a.push(this.endpoint),a.join("/")},parse:function(a){return"number"==typeof a?a={id:a}:a.service&&(a=a.service),a},sync:function(b,c,d){return this.endpoint=d.endpoint?d.endpoint:!1,this.parentpoint=d.hasOwnProperty("parentpoint")?c.parentpoint:"delete"!=b,a.sync(b,c,d)},loaded:function(a){return void 0!==this.get(a?a:"objectType")},updateStreams:function(a,b){a||(this.backupstreams=this.get("streams").filter(function(a){return a.profile?a.profile.id==b.id:void 0})),this.once("sync",this.parseStreamChanges.bind(this,b,a)).fetch({parentpoint:!1})},parseStreamChanges:function(a,b){var c;if(b?this.get("streams")&&(c=this.get("streams").filter(function(b){return b.profile?b.profile.id==a.id:void 0})):c=this.backupstreams,c&&c.length)for(var d in c)this.parsestream(c[d],a.get("activated")?"add":"remove");Cloudwalkers.RootView.navigation.renderHeader(),Cloudwalkers.RootView.navigation.render()},addservice:function(){this.once("sync",this.updatechannels.bind(this,"add")).fetch({parentpoint:!1})},updatechannels:function(a){var b=this.get("streams");b||Cloudwalkers.Router.navigate("#settings/services",!0);for(var c in b)this.parsestream(b[c],a);Cloudwalkers.RootView.navigation.renderHeader(),Cloudwalkers.RootView.navigation.render(),"add"==a&&Cloudwalkers.Router.navigate("#settings/services",!0)},parsestream:function(a,b){var c,d=a.channels;if(d.length)for(var e in d)c=Cloudwalkers.Session.getChannel(parseInt(d[e])),c&&c.streams[b](a)},remove:function(){this.updatechannels("remove",this)}});return b}),define(["Models/BaseModel"],function(a){var b=a.extend({typestring:"statistics",parameters:{},pluck:function(a,b,c){var d,e=0;return this.get("streams")?(c?(key=a[0],subkey=a[1],c>2&&(subsubkey=a[2])):(key=a,subkey="total"),$.each(this.get("streams"),function(a,f){b?_.isNumber(b)&&b==f.id&&(2>=c||!c)?_.isNumber(f[key][subkey])?e+=Number(f[key][subkey]):_.isNumber(f[key])&&!c&&(e+=Number(f[key])):_.isNumber(b)&&b==f.id&&c>2?_.isObject(f[key])&&_.isObject(f[key][subkey])&&_.isNumber(f[key][subkey][subsubkey])&&(e+=Number(f[key][subkey][subsubkey])):_.isString(b)&&(2>=c||!c)?(d=Cloudwalkers.Session.getStream(f.id).get("network").token,d==b&&(_.isNumber(f[key][subkey])?e+=Number(f[key][subkey]):_.isNumber(f[key])&&!c&&(e+=Number(f[key])))):_.isString(b)&&c>2&&(d=Cloudwalkers.Session.getStream(f.id).get("network").token,d==b&&_.isObject(f[key])&&_.isObject(f[key][subkey])&&_.isNumber(f[key][subkey][subsubkey])&&(e+=Number(f[key][subkey][subsubkey]))):_.isNumber(f[key][subkey])?e+=Number(f[key][subkey]):_.isNumber(f[key])&&!c&&(e+=Number(f[key]))}),e):void 0},contacts:function(a){var b=[];return this.get("streams")?(a||$.each(this.get("streams"),function(a,c){var d=Cloudwalkers.Session.getStream(c.id);if(d){var e=d.get("network").token,f=c.contacts;f&&b.push({color:this.networkcolors[e],value:Number(f)})}}.bind(this)),b):b}});return b}),define(["backbone","Collections/Contacts","Collections/Messages"],function(a,b,c){var d=a.Model.extend({parameters:{},initialize:function(){this.messages=new c,this.contacts=new b,this.get("statistics")},outdated:function(){this.fetch()},update:function(){this.fetch()},url:function(){var a=this.id?this.id:"";return Cloudwalkers.Session.api+"/streams/"+a+this.endpoint+this.parameters},parse:function(a){return a.stream&&(a=a.stream),this.outdated=a.outdated=!1,Store.set("streams",a),a},sync:function(b,c,d){return"read"==b?(this.endpoint=d.endpoint?"/"+d.endpoint:"",this.parameters=d.parameters?"?"+$.param(d.parameters):""):"create"==b&&(this.endpoint=d.parent?d.parent+"/streams":""),a.sync(b,c,d)},loaded:function(a){return void 0!==this.get(a?a:"objectType")},seedusers:function(a){var b=a.get("from");b&&b.length&&this.users.add(b)},getcontacts:function(){return _.isObject(this.get("contacts"))?this.get("contacts").total:this.get("contacts")},getnotifications:function(){return _.isObject(this.get("notifications"))?this.get("notifications").total:this.get("notifications")},getmessages:function(){return _.isObject(this.get("messages"))?this.get("messages").total:this.get("messages")},getactivities:function(){return _.isObject(this.get("activities"))?this.get("activities").total:this.get("activities")},getimpressions:function(){if(this.impressions)return this.impressions;var a=_.isObject(this.get("messages"))?this.get("messages"):null;return a&&a.impressions?a.impressions:0},getfollowers:function(){return _.isObject(this.get("contacts"))&&_.isObject(this.get("contacts").types)?this.get("contacts").types.followers:0},getfollowing:function(){return _.isObject(this.get("contacts"))&&_.isObject(this.get("contacts").types)?this.get("contacts").types.following:0},getbesttime:function(){return _.isObject(this.get("messages").besttimetopost)?this.get("messages").besttimetopost:void 0},getnetwork:function(){return this.get("network")},getattribute:function(a){var b="get"+a;return this[b]()},incrementattr:function(a,b){var c=this.get(a);return _.isObject(c)?c.total+=b:c+=b,this.set(a,c),this},getlimitations:function(){var a=this.get("network");return a?a.limitations:null}});return d}),define(["backbone"],function(a){var b=a.Model.extend({typestring:"triggers",initialize:function(){this.get("actions")||this.set("actions",[])},parse:function(a){return"number"==typeof a?a={id:a}:this.stamp(a),a},sync:function(b,c,d){return this.endpoint=d.endpoint?"/"+d.endpoint:!1,"update"==b?!1:a.sync(b,c,d)},loaded:function(a){return void 0!==this.get(a?a:"objectType")},getaction:function(a){var b=this.get("actions"),c=b?b.filter(function(b){return b.action==a?b:void 0}):null;return c?c.length?c[0]:null:void 0},getmessage:function(a){var b=this.getaction(a);return b&&b.message?b.message.body?b.message.body.html:b.message:null},setaction:function(a,b){var c=this.getaction(a);c?$.extend(c,b):this.attributes.actions.push($.extend({action:a},b))},url:function(){var a=[Cloudwalkers.Session.api];return this.id?a.push(this.typestring,this.id):this.parent?a.push(this.parent.typestring,this.parent.id,this.typestring):this.typestring&&a.push(this.typestring),a.join("/")}});return b}),define(["Models/BaseModel"],function(a){var b=a.extend({typestring:"users",initialize:function(){},url:function(){return this.parent?Cloudwalkers.Session.api+"/"+this.parent.typestring+"/"+this.parent.id+"/"+this.typestring+"/"+this.id:"create"==this.method?Cloudwalkers.Session.api+"/accounts/"+Cloudwalkers.Session.getAccount().get("id")+"/users":"delete"==this.method?Cloudwalkers.Session.api+"/accounts/"+Cloudwalkers.Session.getAccount().get("id")+"/users/"+this.id:Cloudwalkers.Session.api+"/users/"+this.id},parse:function(a){return"number"==typeof a?a={id:a}:this.stamp(a),a},sync:function(a,b,c){return this.method=a,"update"==a?!1:Backbone.sync(a,b,c)},loaded:function(a){return void 0!==this.get(a?a:"objectType")},filterData:function(a){var b=this.attributes;return"listitem"==a?b.arrow=!0:b.role=this.getRole(),b},getRole:function(){var a=Cloudwalkers.Session.getAccount().get("roles"),b=this.get("rolegroup"),c=a.filter(function(a){return a.id==b});return c.length?c[0]:null}});return b}),define(["backbone","config","Views/Pages/Dashboard","Views/Pages/Coworkers","Views/Pages/Inbox","Views/Pages/Drafts","Views/Pages/Sent","Views/Pages/Notes/Notes","Views/Pages/Scheduled","Views/Pages/Timeline","Views/Pages/ManageAccounts","Views/Pages/KeywordMonitoring","Views/Pages/ManageKeywords","Views/Pages/StatStream","Views/Pages/Statistics","Views/Pages/Settings","Views/Pages/Firsttime","Views/Pages/Coworkdashboard"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=a.Router.extend({routes:{"dashboard/:accountid":"changeaccount",compose:"compose",write:"compose",share:"share","inbox(/:type)(/:streamid)":"inbox",drafts:"drafts","outbox(/:type)":"outbox",notes:"notes",scheduled:"scheduled",coworkers:"coworkers","channel/:channel(/:subchannel)(/:stream)(/:messageid)":"channel","timeline/:channel(/:stream)":"timeline","trending/:channel(/:subchannel)(/:stream)(/:messageid)":"trending","monitoring/accounts":"manageaccounts","monitoring/:channel(/:subchannel)(/:messageid)":"monitoring","monitoring/:channel(/:subchannel)/":"monitoring",keywords:"managekeywords","reports/:streamid":"reports",statistics:"statistics","statistics/:streamid":"statistics","settings(/:sub)(/:service)":"settings",firsttime:"firsttime",work:"coworkdashboard",home:"home",logout:"home","*path":"dashboard"},dashboard:function(){return Cloudwalkers.Session.getAccount().get("firstTime")?this.navigate("#firsttime",!0):Cloudwalkers.Session.isAuthorized("_CW_INBOX_VIEW")?void Cloudwalkers.RootView.setView(new c):this.navigate("#work",!0)
},changeaccount:function(a){a!=Cloudwalkers.Session.get("currentAccount")&&Cloudwalkers.Session.updateSetting("currentAccount",a,{success:this.home.bind(this,!0)})},compose:function(){Cloudwalkers.RootView.compose()},coworkers:function(){var a=new d,b="_CW_COWORKERS_VIEW";this.validate(a,b)},inbox:function(a,b){var c={MESSAGE_READ_INBOX_NOTIFICATIONS:"#messages/notifications",MESSAGE_READ_INBOX_SCHEDULE:"#scheduled",MESSAGE_READ_DRAFTS:"#drafts",ACCOUNT_NOTES_VIEW:"#notes"},d=_.intersection(_.keys(c),Cloudwalkers.Session.getUser().authorized),f=Cloudwalkers.Session.getChannel("inbox");if(!f)return this.home();if(!d||!d.length)return this.home();if(a||(a="messages"),!Cloudwalkers.Session.isAuthorized("MESSAGE_READ_INBOX_"+a.toUpperCase())){if(Cloudwalkers.Session.getUser().authorized&&d.length)return this.navigate(c[d[0]],{trigger:!0});window.location="/"}Cloudwalkers.RootView.setView(new e({channel:f,type:a,streamid:b}))},drafts:function(){var a=new f,b="MESSAGE_READ_DRAFTS";this.validate(a,b)},outbox:function(a){a||(a="sent");var b=new g,c="MESSAGE_READ_DRAFTS";this.validate(b,c)},notes:function(){var a=new h,b="ACCOUNT_NOTES_VIEW";this.validate(a,b)},scheduled:function(){var a=new i,b="MESSAGE_READ_SCHEDULE";this.validate(a,b)},timeline:function(a,b){var c=b?Cloudwalkers.Session.getStream(Number(b)):Cloudwalkers.Session.getChannel(Number(a)),d=Cloudwalkers.Session.getAccount(),e=(d.channels.findWhere({type:"news"})?d.channels.findWhere({type:"news"}).id:null,d.channels.findWhere({type:"profiles"})?d.channels.findWhere({type:"profiles"}).id:null),f=a==e?"company":"thirdparty",g="thirdparty"==f,h=new j({model:c,showcontact:g,parameters:{records:40,markasread:!0}}),i=f=="MESSAGE_READ_"+f.toUpperCase();this.validate(h,i)},trending:function(a,b){var c=Cloudwalkers.Session.getChannel(Number(a)),d=b?Cloudwalkers.Session.getStream(Number(b)):c,e="news"==c.get("type")?1:7,f={since:3600*Math.round(Date.now()/36e5)-86400*e,sort:"engagement",records:40,markasread:!0},g=new j({model:d,trending:!0,parameters:f}),h="MESSAGE_READ_THIRDPARTY";this.validate(g,h)},manageaccounts:function(){var a=Cloudwalkers.Session.getChannel("news"),b=new k({channel:a});Cloudwalkers.RootView.setView(b)},monitoring:function(a,b){if(!b)return this.navigate("#keywords",!0);var c=new l({category:Cloudwalkers.Session.getChannel(Number(b))}),d="MESSAGE_READ_MONITORING";this.validate(c,d)},managekeywords:function(){var a=new m,b="CHANNEL_MANAGE_EDIT_MONITORING";this.validate(a,b)},reports:function(a){require(["Views/Pages/Reports"],function(b){var c=new b({stream:Cloudwalkers.Session.getStream(Number(a))}),d="STATISTICS_VIEW";a&&(c.subnavclass="reports_"+a),this.validate(c,d)}.bind(this))},statistics:function(a){var b=Cloudwalkers.Session.getAccount(),c=a?new n({model:b,streamid:a}):new o({model:b}),d="STATISTICS_VIEW";this.validate(c,d)},settings:function(a,b){var c;"users"==a&&(c="USER_INVITE"),"services"==a&&(c="SERVICE_CONNECT"),"account"==a&&(c="CAMPAIGN_DELETE");var d=new p({endpoint:a,serviceid:b});this.validate(d,c)},firsttime:function(){Cloudwalkers.RootView.setView(new q)},coworkdashboard:function(){Cloudwalkers.RootView.setView(new r)},manageusergroups:function(){Cloudwalkers.RootView.setView(new ManageUserGroupsView)},home:function(a){return a?window.location="/":$.ajax({url:b.authurl+"revoke",headers:{Authorization:"Bearer "+Cloudwalkers.Session.authenticationtoken,Accept:"application/json"},success:function(){window.location="/"}}),Cloudwalkers.RootView.view.remove(),Cloudwalkers.RootView.navigation.remove(),Cloudwalkers.Session.reset(a),!1},validate:function(a,b){Cloudwalkers.Session.isAuthorized&&Cloudwalkers.Session.isAuthorized(b)?Cloudwalkers.RootView.setView(a):this.home()},exception:function(a){var b="/";switch(a){case 401:b="/401.html";break;case 503:b="/503.html";break;default:window.location=b}}});return s}),define(["backbone","Models/Me","moment","Utilities/Polyglot"],function(a,b,c,d){var e={user:null,isLoaded:function(){return null!=this.user},loadEssentialData:function(a){this.user=new b,this.user.once("activated",function(){this.lang=this.user.attributes.locale,Cloudwalkers.Polyglot=d.init({lang:this.lang}),trans=Cloudwalkers.Polyglot.trans,this.listenTo(Cloudwalkers.Polyglot,"translations:done",a)}.bind(this)),this.user.fetch({error:this.user.offline.bind(this.user)})},reset:function(a){var b;a&&(b=window.localStorage.getItem("token")),window.localStorage.clear(),a&&b&&window.localStorage.setItem("token",b)},home:function(){Cloudwalkers.Router.home()},updateSetting:function(a,b,c){Cloudwalkers.Session.user.attributes.settings[a]!=b&&(Cloudwalkers.Session.user.attributes.settings[a]=b,c=$.extend(c,{patch:!0})||{patch:!0},Cloudwalkers.Session.user.save({settings:Cloudwalkers.Session.user.attributes.settings},c))},get:function(a){return this.user.get("settings")[a]},clone:function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)b[c]=this.clone(a[c]);return b},viewsettings:function(a,b){var c="account_"+this.getAccount().id;Cloudwalkers.Session.user.attributes.settings.viewsettings||(Cloudwalkers.Session.user.attributes.settings.viewsettings={}),Cloudwalkers.Session.user.attributes.settings.viewsettings[c]||(Cloudwalkers.Session.user.attributes.settings.viewsettings[c]=Cloudwalkers.RootView.navigation.mapViews()),"sent"!=a||Cloudwalkers.Session.user.attributes.settings.viewsettings[c].sent||(Cloudwalkers.Session.user.attributes.settings.viewsettings[c].sent={streams:[]}),"profiles"!=a||Cloudwalkers.Session.user.attributes.settings.viewsettings[c].profiles||(Cloudwalkers.Session.user.attributes.settings.viewsettings[c].profiles={streams:[]}),"news"!=a||Cloudwalkers.Session.user.attributes.settings.viewsettings[c].news||(Cloudwalkers.Session.user.attributes.settings.viewsettings[c].news={streams:[]});var d=this.clone(this.get("viewsettings"));if(b){if(a&&b)return d[c][a]=$.extend(d[c][a],b),this.updateSetting("viewsettings",d),d[c][a];throw TypeError("Not the right parameters were met for function viewsettings")}return d[c][a]},manage:function(){var a=(Store.count("messages"),Store.count("reports"));a>25&&Store.filter("reports",null,function(a){a.sort(function(a,b){return a.stamp>b.stamp?1:a.stamp<b.stamp?-1:0}),a=a.slice(0,10),Store.write("messages",a)})},isAuthorized:function(a){return this.user?a?this.user.isauthorized(a):this.user.authorized:!1},censuretemplate:function(a){if(a||(a={}),!this.user)return a;var b=this.user.censuretokens;a.authorized=b},getPing:function(){return this.user.account.ping},ping:function(){this.user.account.ping.forceping()},getAccount:function(a){return a?this.user.accounts.get(a):this.user.account},getAccounts:function(){return this.user.accounts},getChannel:function(a){return"number"==typeof a?this.user.account.channels.get(a):this.user.account.channels.findWhere({type:a})},getChannels:function(){return this.user.account.channels},storeChannel:function(a){a.channels&&a.channels.length&&(a.channels=a.channels.map(function(a){return Cloudwalkers.Session.storeChannel(a),a.id})),a.streams&&a.streams.length&&(a.streams=a.streams.map(function(a){return Store.post("streams",a),a.id})),Store.post("channels",a)},getStream:function(a){return"number"==typeof a?this.user.account.streams.get(a):this.user.account.streams.findWhere({token:a})},getStreams:function(){return this.user.account.streams},addStream:function(a){return this.user.account.streams.add(a)},getUser:function(a){return a?this.user.account.users.get(a):this.user},getUsers:function(){return this.user.account.users},getContact:function(a){return this.user.account.contacts.get(a)},getContacts:function(){return this.user.account.contacts},getMessage:function(a){return this.user.account.messages.get(a)},getMessages:function(){return this.user.account.messages},getCannedResponse:function(a){return this.user.account.cannedresponses.get(a)},getCannedResponses:function(){return this.user.account.cannedresponses},getNotification:function(a){return this.user.account.notifications.get(a)},getNotifications:function(){return this.user.account.notifications},getStatistic:function(a){return this.user.account.statistics.get(a)},getStatistics:function(){return this.user.account.statistics},getReport:function(a){return this.user.account.reports.get(a)},getReports:function(){return this.user.account.reports},getComment:function(a){return this.user.account.comments.get(a)},getComments:function(){return this.user.account.comments}};return _.extend(e,a.Events),e}),define([],function(){var a={parseFromMessage:function(a,b){return a=a.replace("{{from.name}}",b.get("from")?b.get("from")[0].username:null),a=a.replace("{{body.plaintext}}",b.get("body")?b.get("body").plaintext:null)}};return a}),define(["backbone"],function(a){var b=a.Model.extend({interval:3e4,min:1e4,max:9e4,timeout:0,cursor:!1,parameters:{},initialize:function(){Store.exists("ping",{id:this.id})||Store.post("ping",{id:this.id}),this.setCursor(!1),this.fetch({success:this.schedule.bind(this),error:this.toing.bind(this)}),this.on("change:paging",this.setCursor,this),this.on("change:updates",this.updateModels,this),this.on("change:add",this.addModels,this),this.on("change:remove",this.removeModels,this),this.listenTo("ping",this.forceping)},ping:function(){this.fetch({success:this.schedule.bind(this),error:this.toing.bind(this)})},setCursor:function(a,b){a?(this.interval+=Math.round(.2*(this.min-this.interval)),this.cursor=b.cursors.after,Store.set("ping",{id:this.id,cursor:this.cursor})):Store.get("ping",{id:this.id},function(a){a&&(this.cursor=a.cursor)}.bind(this))},url:function(){return this.cursor&&(this.parameters.after=this.cursor),Cloudwalkers.Session.api+"/account/"+this.id+"/ping?"+$.param(this.parameters)},parse:function(a){return a.pong},sync:function(b,c,d){return a.sync(b,c,d)},updateModels:function(a,b){b.accounts&&Cloudwalkers.Session.getAccounts().updates(b.accounts),b.streams&&Cloudwalkers.Session.getStreams().updates(b.streams),b.messages&&Cloudwalkers.Session.getMessages().updates(b.messages),b.notifications&&Cloudwalkers.Session.getNotifications().updates(b.notifications),b.users&&Cloudwalkers.Session.getUsers().updates(b.users),b.contacts&&Cloudwalkers.Session.getContacts().updates(b.contacts)},addModels:function(a,b){return b.length?void console.log("ping add callback: ",b):null},removeModels:function(a,b){return b.length?void console.log("ping remove callback: ",b):null},request:function(){window.clearTimeout(this.timeout),this.fetch({success:this.schedule.bind(this),error:this.toing.bind(this)})},schedule:function(){this.timeout=setTimeout(this.ping.bind(this),this.timer())},forceping:function(){clearTimeout(this.timeout),this.schedule(),this.ping()},timer:function(){return this.interval+=Math.round(.05*(this.max-this.interval))},toing:function(){Cloudwalkers.RootView.growl(trans("Ping"),trans("There is no pong.")),this.interval=this.max,this.schedule()}});return b}),define(["backbone","polyglot","Models/Polyglot"],function(a,b,c){var d={init:function(a){$.extend(this,a);var b=new c;return this.locale=this.lang||"en_EN",moment.locale(this.locale),b.fetch({success:this.addtranslator.bind(this),error:this.notranslation.bind(this)}),this},addtranslator:function(a){phrases=a.get("translation"),this.translator=new Polyglot({phrases:phrases}),this.trigger("translations:done")},notranslation:function(){this.trigger("translations:done")},trans:function(a){return""===a||""===a?a:a?Cloudwalkers.Polyglot.translate(a):Cloudwalkers.Polyglot.translatetemplate()},translate:function(a){return"en_EN"==this.locale?a:this.translator?this.translator.t(a):a},translatetemplate:function(){return function(a,b){return Cloudwalkers.Polyglot.translate(b(a))}.bind(this)}};return _.extend(d,a.Events),d}),define(["backbone"],function(a){var b=a.Model.extend({initialize:function(a){a&&$.extend(this,a)},parse:function(a){return a},sync:function(b,c,d){return this.longurl=d.q,this.campaign=d.campaign,this.parameters={url:this.longurl},this.campaign&&(this.parameters.campaign=this.campaign),a.sync(b,c,d)},url:function(){var a=[Cloudwalkers.Session.api+"/accounts"],b=Cloudwalkers.Session.getAccount();return b&&(a.push(b.id),a.push("urlshortener/shorten?")),a.join("/")+$.param(this.parameters)}});return b}),define([],function(){var a={months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],longdate:function(a){return a.getDate()+" "+this.month(a.getMonth()+1)+" "+a.getFullYear()+" "+this.zeroIt(a.getHours(),2)+":"+this.zeroIt(a.getMinutes(),2)},shortdate:function(a){return a.getDate()+" "+this.month(a.getMonth()+1)+" "+a.getFullYear()},time:function(a){return this.zeroIt(a.getHours(),2)+":"+this.zeroIt(a.getMinutes(),2)},zeroIt:function(a,b){var c="0";for(a=String(a);a.length<b;)a=c+a;return a},month:function(a){return"undefined"!=typeof this.months[a-1]?this.months[a-1]:"Month out of range"}};return a}),function($){this.init=function(options){function fillcountries(){for(n in options.countries){var a='<option value="'+options.countries[n].token+'">'+options.countries[n].name+"</option>";$("#keyword_filter #countries").append(a)}$("#keyword_filter #countries").chosen({width:"100%"})}function filllanguages(){for(n in options.languages){var a='<option value="'+options.languages[n].token+'">'+options.languages[n].name+"</option>";$("#keyword_filter #languages").append(a)}$("#keyword_filter #languages").chosen({width:"100%"})}function getRandomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}function addPlus(size,id){var open_groups=$("#keyword_filter .demo_group").length-$("#keyword_filter .demo_end_group").length;$("#keyword_filter").append(open_groups>0?eval("bot_plus_"+size+"_end_group"):eval("bot_plus_"+size)),$(".demo_options").hide("fast")}function addWarning(a){var b='<div class="alert alert-info" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button>'+a+"</div>";removeWarning(),$("#keyword_warning").append(b)}function removeWarning(){$("#keyword_warning .alert").remove()}this.translations={},options&&$.extend(this.translations,options),$("html").mouseup(function(a){if(a.stopPropagation(),"no-js"!=a.target.className){var b=$(a.target).closest(".demo_bubble"),c=b.attr("id");if(b.attr("class")){var d=b.attr("class").split(" ");d=d[1]}var e=a.target.classList,f=e[0],g=e[2],h=a.target.parentElement.classList;if(h=h[0],"submit"==$(a.target).attr("data-option")||"update"==$(a.target).attr("data-option")){var i=!1,j=$("#keyword_filter .demo_group").length-$("#keyword_filter .demo_end_group").length,k="";if($("#keyword_filter").children().length>1){if(1==$("#keyword_filter").children().eq(-2).is(".demo_drop")&&($("#keyword_filter").children().eq(-2).remove(),$("#keyword_filter #demo_plus").remove(),addPlus("small")),i=!0,j>1){addWarning(this.translations.there_are+" "+j+" "+this.translations.groups_left_open_please_close_them_and_resubmit);var i=!1}else if(1==j){var l=!1;if(1==$("#keyword_filter").children().eq(-2).is(".demo_group")&&(l=$("#keyword_filter").children().eq(-2).attr("id")),1==$("#keyword_filter").children().eq(-3).is(".demo_group")&&(l=$("#keyword_filter").children().eq(-3).attr("id")),1==$("#keyword_filter").children().eq(-4).is(".demo_group")&&(l=$("#keyword_filter").children().eq(-4).attr("id")),0!=l)$("#"+l).prev().remove(),$("#"+l).nextAll().remove(),$("#"+l).remove(),$("#keyword_filter #demo_plus").remove(),addPlus("small");else{var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span  id="'+m+'" class="demo_bubble  demo_end_group" data-option=")"><span class="sel_value">'+this.translations.end_group+'</span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("small")}}}else addWarning(this.translations.formula_is_not_valid_add_more_parameters),i=!1;if($("#keyword_filter").children().each(function(){$("#"+this.id).hasClass("demo_end_group")&&$("#"+this.id).prev().hasClass("demo_drop")&&$("#"+this.id).prev().remove()}),$("#keyword_filter").children().length>1||$("#keyword_filter").children().length<2?1==$("#keyword_filter").children().eq(-2).is(".demo_drop")&&($("#keyword_filter").children().eq(-2).remove(),$("#keyword_filter #demo_plus").remove(),addPlus("small")):(addWarning(this.translations.formula_is_not_valid_add_more_parameters),i=!1),1==i){var n=$("#keyword_filter").children();n.each(function(){if("demo_plus"!=this.id){var a="",b="";$("#"+$(this).attr("id")).attr("data-option")&&(b=$("#"+$(this).attr("id")).attr("data-option")),a="and "==$("#"+$(this).attr("id")).attr("data-value")||"or "==$("#"+$(this).attr("id")).attr("data-value")?$("#"+$(this).attr("id")).attr("data-value"):""!=$("#"+$(this).attr("id")+" .sel_value").text()?"("==b||")"==b?b+" ":"and "==b||"or "==b?b+" ":b+"'"+$("#"+$(this).attr("id")+" .sel_value").text()+"' ":"country = "==b||"country != "==b?b+"'"+$("#"+$(this).attr("id")+" #countries").val()+"' ":"language = "==b||"language != "==b?b+"'"+$("#"+$(this).attr("id")+" #languages").val()+"' ":b+"'"+$("#"+$(this).attr("id")+" .text").text()+"' ",k+=a}}),removeWarning(),options.success(k)}else k="",options.success(k)}if("demo_contains"==d||"demo_drop"==d||"demo_plus"==d){if("demo_options"==h||"demo_options"==f)return!1;$("#"+c+" .demo_options").is(":visible")?$(a.target).is("input")||$(".demo_options").hide("fast"):("demo_hit_me"==f||"text"==f||"demo_hit_me"==g)&&($(".demo_options").hide("fast"),$("#"+c+" .demo_options").toggle("fast"))}else 0!=$(".demo_options:visible").length&&$(".demo_options").hide("fast");if("demo_contains"==d)if("btn"!=f);else if("save"==$(a.target).attr("data-option")){var o=$("#"+c+" .demo_options input").val();$("#"+c+" .text ").html(o),$(".demo_options").hide("fast")}else"cancel"==$(a.target).attr("data-option")&&$(".demo_options").hide("fast");if("demo_change_val"==e){var o=$(a.target).attr("data-value"),p=$(a.target).html(),q=$("#"+c).attr("data-option");if("and"==o||"or"==o?($("#"+c).hasClass("demo_and")&&$("#"+c).removeClass("demo_and"),$("#"+c).hasClass("demo_or")&&$("#"+c).removeClass("demo_or"),$("#"+c).addClass("demo_"+o)):("language = "==q||"country = "==q||"language != "==q||"country != "==q)&&($("#"+c).attr("data-value",o),$("#"+c+" .sel_value").html(p)),$("#"+c).hasClass("demo_drop")){var r=$(a.target).attr("data-value"),o=$(a.target).attr("data-text");$("#"+c).attr("data-value",r+" ")}"language = "!=q&&"country = "!=q&&"language != "!=q&&"country != "!=q&&$("#"+c+" .sel_value ").html(o)}if("add_message_contains"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span id="'+m+'" class="demo_bubble demo_contains" data-option="message contains ">'+this.translations.message_contains+'<span class="demo_hit_me demo_input_text demo_bubble_text"><span class="text">'+this.translations.insert_text+'</span><span class="demo_options"><input type="text" name="lname" value=""><br><div class="modal-footer toload"><button data-option="save" class="btn" onclick="return false;">'+this.translations.save+'</button><button data-option="cancel" class="btn btn-primary" onclick="return false;">'+this.translations.cancel+'</button></div></span></span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("small",m)}if("add_message_no_contains"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span id="'+m+'" class="demo_bubble demo_contains" data-option="message !contains ">'+this.translations.message_doesnt_contain+'<span class="demo_hit_me demo_input_text demo_bubble_text"><span class="text">'+this.translations.insert_text+'</span><span class="demo_options"><input type="text" name="lname" value=""><br><div class="modal-footer toload"><button data-option="save" class="btn" onclick="return false;">'+this.translations.save+'</button><button data-option="cancel" class="btn btn-primary" onclick="return false;">'+this.translations.cancel+'</button></div></span></span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("small",m)}if("add_author_is"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span id="'+m+'" class="demo_bubble demo_contains" data-option="author = ">'+this.translations.author_is+'<span class="demo_hit_me demo_input_text demo_bubble_text"><span class="text">'+this.translations.insert_author+'</span><span class="demo_options"><input type="text" name="lname" value=""><br><div class="modal-footer toload"><button data-option="save" class="btn" onclick="return false;">'+this.translations.save+'</button><button data-option="cancel" class="btn btn-primary" onclick="return false;">'+this.translations.cancel+'</button></div></span></span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("small",m)}if("add_author_is_not"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span id="'+m+'" class="demo_bubble demo_contains" data-option="author != ">'+this.translations.author_is_not+'<span class="demo_hit_me demo_input_text demo_bubble_text"><span class="text">'+this.translations.insert_author+'</span><span class="demo_options"><input type="text" name="lname" value=""><br><div class="modal-footer toload"><button data-option="save" class="btn" onclick="return false;">'+this.translations.save+'</button><button data-option="cancel" class="btn btn-primary" onclick="return false;">'+this.translations.cancel+'</button></div></span></span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("small",m)}if("add_country_is"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span id="'+m+'" class="demo_bubble demo_contains" data-option="country = ">'+this.translations.country_is+'<span class="demo_drop demo_bubble_text"><select class="demo_options" id="countries"></select></span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("small",m),fillcountries()}if("add_country_is_not"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span id="'+m+'" class="demo_bubble demo_contains" data-option="country != ">'+this.translations.country_is_not+'<span class="demo_drop demo_bubble_text"><select class="demo_options" id="countries"></select></span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("small",m),fillcountries()}if("add_language_is"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span id="'+m+'" class="demo_bubble demo_contains" data-option="language = ">'+this.translations.language_is+'<span class="demo_drop demo_bubble_text"><select class="demo_options" id="languages"></select></span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("small",m),filllanguages()}if("add_language_is_not"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span id="'+m+'" class="demo_bubble demo_contains" data-option="language != ">'+this.translations.language_is_not+'<span class="demo_drop demo_bubble_text"><select class="demo_options" id="languages"></select></span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("small",m),filllanguages()}if("add_and"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span  id="'+m+'" data-string="sel_value" class="demo_bubble demo_drop demo_and" data-value="and " ><span class="sel_value">'+this.translations.and+'</span><i class="demo_hit_me icon-sort-down"></i><span class="demo_options"><ul><li class="demo_change_val" data-value="and" data-text="'+this.translations.and+'">'+this.translations.and+'</li><li class="demo_change_val" data-value="or" data-text="'+this.translations.or+'">'+this.translations.or+'</li></ul></span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("large",m)}if("add_or"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span  id="'+m+'" class="demo_bubble demo_drop demo_or" data-value="or " ><span class="sel_value">'+this.translations.or+'</span><i class="demo_hit_me icon-sort-down"></i><span class="demo_options"><ul><li class="demo_change_val" data-value="or" data-text="'+this.translations.or+'">'+this.translations.or+'</li><li class="demo_change_val" data-value="and" data-text="'+this.translations.and+'">'+this.translations.and+'</li></ul></span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("large",m)}if("add_group"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span  id="'+m+'" class="demo_bubble  demo_group" data-option="("><span class="sel_value">'+this.translations.group+'</span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("large",m),$(".demo_options").hide("fast")}if("add_end_group"==f){var m="filter_"+getRandomInt(1,999);$("#keyword_filter #demo_plus").remove(),$("#keyword_filter").append('<span  id="'+m+'" class="demo_bubble  demo_end_group" data-option=")"><span class="sel_value">'+this.translations.end_group+'</span><i class="demo_remove_filter icon-remove"></i></span>'),addPlus("small",m),$(".demo_options").hide("fast")}"demo_remove_filter"==f&&($("#"+c).hasClass("demo_drop")?($("#"+c).next().hasClass("demo_group")?($("#"+c).nextUntil(".demo_end_group").remove(),$("#"+c).nextAll(".demo_end_group").remove()):$("#"+c).next().remove(),$("#"+c).remove()):$("#"+c).hasClass("demo_group")?($("#"+c).nextAll(".demo_end_group").next().remove(),$("#"+c).nextUntil(".demo_end_group").remove(),$("#"+c).nextAll(".demo_end_group").remove(),$("#"+c).remove()):$("#"+c).hasClass("demo_end_group")?$("#"+c).remove():($("#"+c).prev().hasClass("demo_group")&&$("#"+c).next().hasClass("demo_end_group")?($("#"+c).prev().remove(),$("#"+c).next().remove(),$("#"+c).prev().hasClass("demo_drop")&&$("#"+c).prev().remove()):"demo_plus"!=$("#"+c).next().attr("id")&&($("#"+c).prev().hasClass("demo_drop")&&$("#"+c).next().next().hasClass("demo_drop")&&$("#"+c).nextAll(".demo_end_group").next().remove(),$("#"+c).next().remove()),$("#"+c).remove()),$("#keyword_filter #demo_plus").remove(),plus_size=1==$("#keyword_filter span:last-child").hasClass("demo_drop")?"large":0==$("#keyword_filter").children().length?"large":"small",addPlus(plus_size))}}.bind(this));var bot_plus_large='<span id="demo_plus" class="demo_bubble demo_drop demo_hit_me"><span class="demo_hit_me">+</spam><span class="demo_options"><ul><li class="add_message_contains">'+this.translations.message_contains+'</li><li class="add_message_no_contains">'+this.translations.message_doesnt_contain+'</li><li class="add_author_is hidden">'+this.translations.author_is+'</li><li class="add_author_is_not hidden">'+this.translations.author_is_not+'</li><li class="add_country_is">'+this.translations.country_is+'</li><li class="add_country_is_not">'+this.translations.country_is_not+'</li><li class="add_language_is">'+this.translations.language_is+'</li><li class="add_language_is_not">'+this.translations.language_is_not+'</li><li class="add_group">'+this.translations.group+"</li></ul></span></span>",bot_plus_large_end_group='<span id="demo_plus" class="demo_bubble demo_drop demo_hit_me"><span class="demo_hit_me">+</spam><span class="demo_options"><ul><li class="add_message_contains">'+this.translations.message_contains+'</li><li class="add_message_no_contains">'+this.translations.message_doesnt_contain+'</li><li class="add_author_is hidden">'+this.translations.author_is+'</li><li class="add_author_is_not hidden">'+this.translations.author_is_not+'</li><li class="add_country_is">'+this.translations.country_is+'</li><li class="add_country_is_not">'+this.translations.country_is_not+'</li><li class="add_language_is">'+this.translations.language_is+'</li><li class="add_language_is_not">'+this.translations.language_is_not+'</li><li class="add_group">'+this.translations.group+'</li><li class="add_end_group">'+this.translations.end_group+"</li></ul></span></span>",bot_plus_small='<span id="demo_plus" class="demo_bubble demo_drop demo_hit_me"><span class="demo_hit_me">+</spam><span class="demo_options"><ul><li class="add_and">'+this.translations.and+'</li><li class="add_or">'+this.translations.or+"</li></ul></span></span>",bot_plus_small_end_group='<span id="demo_plus" class="demo_bubble demo_drop demo_hit_me"><span class="demo_hit_me">+</spam><span class="demo_options"><ul><li class="add_and">'+this.translations.and+'</li><li class="add_or">'+this.translations.or+'</li><li class="add_end_group">'+this.translations.end_group+"</li></ul></span></span>"},$.fn.keywordfilterscript=function(){return init.apply(this,arguments)},$.fn.keywordfilterdestroy=function(){$("html").unbind("mouseup")}}(jQuery),define(["backbone"],function(a){var b=a.View.extend({loadListeners:function(a,b,c){var d=b.length,e="listenTo";c&&(e="listenToOnce");for(var f in b)if(_.isArray(b[f]))for(var g in b[f])this[e](a,b[f][g],this.loadRender.bind(this,Number(f)+1,d));else this[e](a,b[f],this.loadRender.bind(this,Number(f)+1,d));this.listenTo(a,"ready:empty",this.emptylist.bind(this)),this.on("rendered",this.addLoader)},addLoader:function(){this.container=this.$loadercontainer?this.$loadercontainer:this.$container,this.loader=$(Templates.progressbar).appendTo(this.container)},loadRender:function(a,b){if(this.loader){this.container.hasClass("empty-list")&&this.container.removeClass("empty-list"),this.loader&&this.loader.hasClass("loaded")&&this.restart(),this.loader&&this.loader.hasClass("loading")&&1==a&&this.restart(),b==a&&this.finishLoading();var c=this;setTimeout(function(){var d=105*a/b;!c.loadingstate||c.loadingstate<=d?(c.loadingstate=d,c.loader&&c.loader.css("width",d+"%")):c.restart()},1)}},restart:function(){this.loadingstate=0,this.loader.remove(),this.addLoader(),this.container.removeClass("loaded").addClass("toload")},finishLoading:function(){this.loader.css("width","100%"),this.loader.addClass("loaded"),this.container.removeClass("toload").addClass("loaded")},emptylist:function(){this.loadRender(99,99),this.container.addClass("empty-list")},counter:0,updateable:function(a,b){this.$countertarget=b?b:this.$container,this.listenTo(a?a:this.model,"outdated",this.showupdate)},showupdate:function(){this.$counter||(this.$counter=$("<counter></counter>").appendTo(this.$countertarget).on("click",function(){this.resetupdate(),this.render()}.bind(this))),$(this.$loadercontainer?this.$loadercontainer:this.$container).addClass("outdated"),this.$counter.html(++this.counter)},clearupdate:function(){this.$el.find(".outdated").removeClass("outdated"),this.resetupdate()},resetupdate:function(){this.counter=0,this.$counter.remove()}});return b}),define(["Views/Panels/Panel"],function(a){var b=a.extend({title:"Bar chart",placeholder:null,icon:"reorder",size:6,getDataset:function(){return this.options.model},innerRender:function(a){var b=this;this.placeholder=$('<div class="chart" style="position: relative;"></div>'),a.html(""),a.append(this.placeholder),this.options.model.getValues(function(a){b.plot(a)}),this.options.model.on("dataset:change",function(a){b.plot(a[0].values)})},plot:function(a){if(a){for(var b=[],c=0;c<a.length;c++)b.push([c,a[c][0]]),a[c][0]=c;$.plot(this.placeholder,[a],{xaxis:{ticks:b},yaxis:{tickDecimals:0},bars:{show:!0,align:"center",fill:.78,lineWidth:1},colors:["#2bbedc","#ffb848","#852b99","#e02222","#ffe399"]})}}});return b}),define(["Views/Charts/Numberstat"],function(a){var b=a.extend({template:"dashboardstat"});return b}),define(["Views/Panels/Panel"],function(a){var b=a.extend({title:"Bar chart",placeholder:null,icon:"reorder",size:6,getDataset:function(){return this.options.model},innerRender:function(a){var b=this;this.placeholder=$('<div class="chart" style="position: relative;"></div>'),a.html(""),a.append(this.placeholder),this.options.model.getValues(function(a){b.plot(a)
}),this.options.model.on("dataset:change",function(a){b.plot(a[0].values)})},numberOutput:function(a){return a>=0?"+ "+a:"- "+Math.abs(a)},plot:function(a){if(a){var b,c,d=[],e=[],f=[],g=0;for(a.length>10&&(g=1);a.length<10;)a.unshift([null,0]);for(var h=g;h<a.length;h++)null!=a[h][0]?(b=new Date(a[h][0]),c=b.getDate()+"/"+(b.getMonth()+1)+"/"+b.getFullYear()):c="",d.push([h,c]),a[h][0]=h,0===h?(e.push([h,a[h][1]]),f.push([h,0])):a[h-1][1]<=a[h][1]?(e.push([h,a[h-1][1]]),f.push([h,a[h][1]-a[h-1][1]])):(e.push([h,a[h][1]]),f.push([h,0]));for(var i,j,k=$.plot(this.placeholder,[e,f],{xaxis:{ticks:d},yaxis:{tickDecimals:0,min:0},series:{stack:!0,shadowSize:2,bars:{show:!0,align:"center",barWidth:.8,fill:.78,lineWidth:1}},grid:{borderWidth:0},colors:["#2bbedc","#ffb848","#852b99","#e02222","#ffe399"]}),l=0;l<a.length;l++)l>0&&(a[l][1]=parseInt(a[l][1]),a[l][1]>0&&a[l-1][1]>0&&(j=(a[l][1]-a[l-1][1])/Math.max(1,a[l-1][1]),j*=100,j=Math.floor(j),j=this.numberOutput(j)+"%",i=k.pointOffset({x:a[l][0],y:a[l][1]}),this.placeholder.append('<div style="background: white; position: absolute; left: '+(i.left-30)+"px; top: "+(i.top-25)+'px; width: 60px; text-align: center;">'+j+"</div>")))}}});return b}),define(["Views/Panels/Panel"],function(a){var b=a.extend({title:"Line chart",placeholder:null,icon:"reorder",size:6,element:null,getDataset:function(){return this.options.model},initialize:function(){var a=this;this.options.model.on("dataset:change",function(b){a.plot(b[0].values)})},innerRender:function(a){this.element=a;var b=this;this.placeholder=$('<div class="chart" style="position: relative;"></div>'),a.html(""),a.append(this.placeholder),this.options.model.getValues(function(a){b.plot(a)})},showTooltip:function(a,b,c){$('<div id="tooltip">'+c+"</div>").css({position:"absolute",display:"none",top:b+5,left:a+15,border:"1px solid #333",padding:"4px",color:"#fff","border-radius":"3px","background-color":"#333",opacity:.8}).appendTo(this.element).fadeIn(200)},plot:function(a){var b=this;$.plot(this.placeholder,[a],{xaxis:{mode:"time"},yaxis:{tickDecimals:0},series:{lines:{show:!0,lineWidth:2,fill:!0,fillColor:{colors:[{opacity:.05},{opacity:.01}]}},points:{show:!0},shadowSize:2},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderWidth:0},colors:["#d12610","#37b7f3","#52e136"]});var c=null;this.placeholder.bind("plothover",function(a,d,e){if($("#x").text(d.x.toFixed(2)),$("#y").text(d.y.toFixed(2)),e){if(c!=e.dataIndex){c=e.dataIndex,$("#tooltip").remove();var f=e.datapoint[0],g=e.datapoint[1];f=new Date(f).toLocaleDateString(),b.showTooltip(e.pageX,e.pageY,f+": "+g)}}else $("#tooltip").remove(),c=null})}});return b}),define(["Views/Panels/Panel","mustache"],function(a,b){var c=a.extend({title:"Number stat",icon:"reorder",color:null,network:null,template:"dashboardstat",size:3,showLink:!0,showStreamName:!0,getDataset:function(){return this.options.model},render:function(){var a=this.$el,c=this;return this.color&&(this.options.color=this.color),this.network&&(this.options.network=this.network),this.dashboard&&(this.options.dashboard=this.dashboard),this.showLink&&(this.options.showLink=this.showLink),this.showStreamName&&(this.options.showStreamName=this.showStreamName),a.html(b.render(Templates[this.template])),this.options.model.getValues(function(a){c.setValue(a)}),this.options.model.on("dataset:change",function(a){c.setValue(a[0].values)}),this},numberOutput:function(a,b){return"undefined"==typeof b&&(b=!1),0>a?"- "+Math.abs(a):b?"+ "+Math.abs(a):a},setValue:function(a){var c=this.$el,d=this.options.model.getDisplay(),e={};$.extend(!0,e,this.options);var f=this.options.model.getInterval();e.details=[],e.footer="&nbsp;",e.report=this.options.report.attributes;var g;if(a&&a.length>0)if("comparison"==d){var h=this.numberOutput(a[0][1]);a.length>1?(e.footer="<strong>"+this.numberOutput(a[0][1]-a[1][1],!0)+"</strong> (",e.footer+=this.numberOutput(Math.round(100*this.options.model.getEvolution()),!0)+"%) Since last "+f):e.footer="Last "+f,g=this.options.showStreamName?"Foo "+e.title:e.title,e.details.push({content:h,descr:g})}else this.$el.find(".number").html(this.numberOutput(a[a.length-1][1]));else e.details.push({content:"☹",descr:"No info"});this.trigger("content:change"),c.html(b.render(Templates[this.template],e)),c.find(".portlet-loading").toggleClass("portlet-loading")}});return c}),define(["Views/Panels/Panel"],function(a){var b=a.extend({title:"Pie chart",placeholder:null,icon:"reorder",size:6,maxSlices:10,getDataset:function(){return this.options.model},innerRender:function(a){var b=this;this.placeholder=$('<div class="chart" style="position: relative;"></div>'),a.html(""),a.append(this.placeholder),this.options.model.getValues(function(a){b.plot(a)}),this.options.model.on("dataset:change",function(a){b.plot(a[0].values)})},plot:function(a){if(0===a.length)return void this.placeholder.html("<p>At this time there is no information available.</p>");a.sort(function(a,b){return b[1]-a[1]});var b=0;if(a.length>this.maxSlices){for(;a.length>this.maxSlices-1;)b+=a.pop()[1];a.push(["Other",b])}for(var c=[],d=0;d<a.length;d++)c.push({label:a[d][0],data:a[d][1]});$.plot(this.placeholder,c,{series:{pie:{show:!0}},colors:["#2bbedc","#ffb848","#852b99","#e02222","#ffe399","#AFD8F8","#A23C3C","#4DA74D","#BD9B33","#8CACC6"]})}});return b}),define(["Views/Panels/Panel","mustache"],function(a,b){var c=a.extend({title:"Line chart",placeholder:null,size:"full",icon:"reorder",getDataset:function(){return this.options.model},innerRender:function(a){var b=this;this.placeholder=$('<div class="table-container"></div>'),a.html(""),a.append(this.placeholder),this.options.model.getValues(function(a){b.plot(a)}),this.options.model.on("dataset:change",function(a){b.plot(a[0].values)})},plot:function(a){var c={};c.header=[];for(var d=[],e=0;e<a.header.length;e++)c.header.push({name:a.header[e],"class":"undefined"!=typeof a.classes[e]?a.classes[e]:null}),d.push({sSortDataType:"dom-text"});c.rows=[];for(var f=0;f<a.rows.length;f++){for(var g=[],h=0;h<a.rows[f].length;h++)g.push({value:a.rows[f][h],"class":"undefined"!=typeof a.classes[h]?a.classes[h]:null});c.rows.push({columns:g})}this.placeholder.html(b.render(Templates.charttable,c))}});return c}),define(["Views/Panels/Panel","mustache"],function(a,b){var c=a.extend({title:"Line chart",icon:"reorder",color:null,network:null,template:"dashboardstat",size:3,getDataset:function(){return this.options.model},render:function(){var a=this.$el,c=this;return this.color&&(this.options.color=this.color),this.network&&(this.options.network=this.network),this.options.footer="&nbsp;",a.html(b.render(Templates[this.template],this.options)),this.options.model.getValues(function(a){c.setValue(a)}),this.options.model.on("dataset:change",function(a){c.setValue(a[0].values)}),this},setValue:function(a){var c=this.$el,d={};$.extend(!0,d,this.options),d.footer="<strong>"+this.options.stream.customname+"</strong> "+this.options.title,d.details=[],d.details.push(a&&a.length>0?{content:a[0][1],descr:a[0][0]}:{content:"☹",descr:"No info"}),c.html(b.render(Templates[this.template],d)),c.find(".portlet-loading").toggleClass("portlet-loading")}});return c}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({template:"action",position:"left",className:"action",options:{},initialize:function(a){$.extend(this,a),_.isArray(this.action)&&(this.template="compoundaction",this.rendercompound()),this.positionaction()},render:function(){return this.action.inactive=this.inactive,this.action.noresults=0===this.action.value?"noresults":!1,this.$el.html(b.render(Templates[this.template],this.action)),this},rendercompound:function(){this.action.length>=2?this.rendercomplexcompound():this.action=this.action[0]},rendercomplexcompound:function(){{var a=this.action[0].hasOwnProperty("value")?this.action[0]:this.action[1];this.action[0].hasOwnProperty("value")?this.action[1]:this.action[0]}this.action=a},positionaction:function(){_.isArray(this.action)&&"note"==this.action[0].type?this.position="right":"note"==this.action.type?this.position="right":"delete"==this.action.token&&(this.position="right")}});return c}),define(["backbone","mustache","Views/Entries/Actions/Action"],function(a,b,c){var d=a.View.extend({actionsright:[],actionsleft:[],compounds:[],initialize:function(a){$.extend(this,a),this.listenTo(this.message.notes,"ready",this.updateactions.bind(this,"notes")),this.listenTo(this.message.notes,"destroy",this.updateactions.bind(this,"notes")),this.listenTo(this.message.actions,"sync",this.updateactions),this.listenTo(this.message.actions,"destroy",this.updateactions)},render:function(a){return this.selected=this.$el.find(".inactive").data("token"),this.actionsleft=[],this.actionsright=[],this.compounds=[],this.fillactions(a),this.$el.html(b.render(Templates.actions)),this.renderactions("left",this.actionsleft),this.renderactions("right",this.actionsright),this},fillactions:function(a){var b,d,e,f;if(this.message){b=this.message.filterActions(a),this.reorderactions(b);for(var g in b){if(d=b[g].compound?this.getcompoundactions(b,b[g]):null,d&&d.length){if(this.compounds.indexOf(d[0].compound)>=0)continue;this.compounds.push(d[0].compound)}this.selected&&(f=d&&d[0].token==this.selected?"inactive":d||b[g].token!=this.selected?!1:"inactive"),e=new c({action:d||b[g],inactive:f}),this["actions"+e.position].push(e)}}},getcompoundactions:function(a,b){var c=a.filter(function(a){return a.compound==b.compound});return c},reorderactions:function(a){var b;for(var c in a)"delete"==a[c].token&&(b=a.splice(c,1));b&&a.push(b[0])},updateactions:function(a){this.render(a),this.trigger("actions:update")},renderactions:function(a,b){var c=this.$el.find(".actions-"+a);for(var d in b)c.append(b[d].render().el)}});return d}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({tagName:"li",template:"messageentry",tokenmap:{favorite:"favourites",retweet:"retweets",like:"likes"},events:{remove:"destroy","click [data-notifications]":"loadNotifications","click *[data-action]":"action",click:"toggle"},options:{},initialize:function(a){this.parameters={},a&&$.extend(this,a),a&&$.extend(this.options,a),this.loadmylisteners()},loadmylisteners:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"action:toggle",this.toggleaction),this.listenTo(this.model,"destroyed",this.remove)},render:function(){return $.extend(this.parameters,this.model.attributes),"fullentry"!=this.template&&"keywordentry"!=this.template||!this.model.get("objectType")||(this.parameters.actions=this.model.filterActions()),Cloudwalkers.Session.censuretemplate(this.parameters),this.$el.html(b.render(Templates[this.template],this.parameters)),this.$el.find("[data-date]")&&this.time(),this.checkunread&&this.model.get("objectType")&&this.checkUnread(),this.model.get("status")&&"FAILED"==this.model.get("status")&&(this.$el.addClass("failed"),this.model.attributes.failed="failed"),this},action:function(a){var b=$(a.currentTarget).data("action");if("note"==b||"action-list"==b){var c=$(a.currentTarget).data("token");this.toggleactions(b,c,a)}else if("note-edit"==b)this.editnote();else if("viewcontact"==b){if(this.parent)return;var d=this.model.attributes.from?this.model.attributes.from[0]:null;d&&Cloudwalkers.RootView.viewContact({model:d})}else this.model.trigger("action",b)},toggle:function(){this.trigger("toggle",this)},checkUnread:function(){this.model.get("read")?this.$el.removeClass("unread"):this.$el.addClass("unread")},time:function(){var a,b=new Date,c=new Date(this.$el.find("[data-date]").attr("data-date")),d=Math.round(.001*(b.getTime()-c.getTime()));a=60>d?"now":3600>d?Math.round(d/60)+"m":86400>d?Math.round(d/3600)+"h":2592e3>d?Math.round(d/86400)+"d":Math.round(d/2592e3)+"mo",this.$el.find("[data-date]").html(a),this.tm=setTimeout(this.time.bind(this),6e4)},destroy:function(){window.clearTimeout(this.tm)}});return c}),define(["Views/Entries/BaseEntry","mustache"],function(a,b){var c=a.extend({tagName:"a",initialize:function(a){$.extend(this,a),this.listenTo(this.model,"change",this.render)},render:function(){var a;a=this.data.typelink?this.data.typelink+"/"+(this.model.get("hasMessages")?"messages":"notifications"):this.data.link?this.data.link:"#"+this.data.type+"/"+this.data.channel.id+"/"+this.model.id,this.$el.attr("href",a),this.$el.attr("data-stream",this.model.id),this.count="outgoing"==this.data.channel.get("type")?this.model.get("counters").total.scheduled.messages.total:"inbox"==this.data.channel.get("type")?this.model.get("counters").total.incoming.any.unread:this.model.get("counters").recent.incoming.any.unread;var c={name:this.model.get("name"),url:a,count:this.count,icon:this.model.get("network")?this.model.get("network").icon:this.data.icon};return this.$el.html(b.render(Templates.counterentry,c)),this}});return c}),define(["Views/Entries/MessageEntry","mustache","Collections/Related","Views/Entries/Actions/Actions","Views/Entries/SubNotificationEntry"],function(a,b,c){var d=a.extend({tagName:"div",className:"message",template:"inboxmessage",related:[],messageview:[],notifications:[],events:{remove:"destroy","click *[data-youtube]":"loadYoutube","click *[data-action]":"action","keyup #tags":"entertag"},loading:function(a){a?$(".inbox").addClass("loading"):$(".inbox").removeClass("loading")},showrelated:function(){this.loading(!0),this.$related=$("<ul></ul>"),this.$prelated=$("<ul></ul>"),this.$el.before(this.$prelated.addClass("related-messagess")),this.$el.after(this.$related.addClass("related-messages")),this.model.related||(this.model.related=new c),this.listenTo(this.model.related,"seed",this.updateCounters),this.listenTo(this.model.related,"seed",this.fillrelated),this.listenTo(this.model.related,"all",this.sendtriggers);var a=!1;"1"!=this.model.get("read")&&(a=!0),this.model.related.touch(this.model,{records:20,markasread:a})},fillrelated:function(b){this.incremental?this.incremental=!1:($.each(this.related,function(a,b){b.remove()}),this.related=[]);var c=!1;b=b.filter(function(a){return a.id==this.model.id&&(c=!0),a.append=c,a.id!=this.model.id}.bind(this));for(var d in b){var e=new a({model:b[d],template:"inboxrelatedmessage",type:"full",parameters:{notes:this.notes}});this.related.push(e),this[b[d].append?"$related":"$prelated"].append(e.render().el)}this.loading(!1)},sendtriggers:function(a){this.trigger(a)},markasread:function(){this.model.save({read:1},{patch:!0,wait:!0}),Cloudwalkers.Session.getStreams().outdated(this.model.get("stream"))},destroy:function(){$.each(this.modelview,function(a,b){b.remove()}),$.each(this.notifications,function(a,b){b.remove()}),$.each(this.related,function(a,b){b.remove()})}});return d}),define(["Views/Entries/InboxMessage","Collections/RelatedNotes","mustache","Views/Entries/NoteEntry","Models/Notification"],function(a,b,c,d){var e=a.extend({tagName:"div",className:"note",template:"note",related:[],messageview:[],notifications:[],events:{remove:"destroy","click *[data-action]":"action"},render:function(){this.loading(!this.model.loaded());var a={};return $.extend(a,this.model.attributes),this.model.loaded("model")&&this.model.parent.loaded()&&(a[this.model.parent.get("objectType")]=this.model.parent.attributes),this.model.filterActions&&$.extend(a,{actions:this.model.filterActions()}),this.notes&&(a.notes=!0),Cloudwalkers.Session.censuretemplate(a),this.$el.html(c.render(Templates[this.template],a)),this.time(),this.model.attributes.ACCOUNT&&this.$el.addClass("nocontext"),this},getcontext:function(){return this.model.parent.attributes},showrelated:function(){this.loading(!0),this.$related=$("<ul></ul>"),this.$prelated=$("<ul></ul>"),this.$el.before(this.$prelated.addClass("related-messages")),this.$el.after(this.$related.addClass("related-messages")),this.model.related||(this.model.related=new b),this.listenTo(this.model.related,"seed",this.fillrelated),this.listenTo(this.model.related,"all",this.sendtriggers),this.model.related.touch(this.model,{records:20,markasread:!0})},fillrelated:function(a){this.incremental?this.incremental=!1:($.each(this.related,function(a,b){b.remove()}),this.related=[]);var b=!1;a=a.filter(function(a){return a.id==this.model.id&&(b=!0),a.append=b,a.id!=this.model.id}.bind(this));for(var c in a){var e=new d({model:a[c],template:"inboxnote",parameters:{notes:this.notes}});this.related.push(e),this[a[c].append?"$related":"$prelated"].append(e.render().el)}this.loading(!1)}});return e}),define(["Views/Entries/BaseEntry","mustache","Views/Entries/Actions/Actions","Views/Modals/SimpleCompose","Views/Entries/SubNoteEntry","Views/Entries/SubNotificationEntry","colorbox"],function(a,b,c,d,e,f){var g=a.extend({render:function(){return $.extend(this.parameters,this.model.attributes),Cloudwalkers.Session.censuretemplate(this.parameters),this.$el.html(b.render(Templates[this.template],this.parameters)),this.renderactions(),this.options.notification&&this.model.get("objectType")&&this.togglecomments(),Cloudwalkers.Session.isAuthorized("ACCOUNT_NOTES_VIEW")&&this.loadnoteui(),this.$el.find(".youtube-video").colorbox({iframe:!0,innerWidth:640,innerHeight:390,opacity:.7}),this.$el.find(".message-img").colorbox({maxWidth:"80%",maxHeight:"80%",opacity:.7}),this},renderactions:function(){this.actions=new c({message:this.model}),this.$el.find(".message-actions").html(this.actions.render().el),this.loadedlists=[]},action:function(a){var b=$(a.currentTarget).data("action");if("note"==b||"action-list"==b){var c=$(a.currentTarget).data("token");this.toggleactions(b,c,a)}else if("note-edit"==b)this.editnote();else if("tag-showedit"==b)this.showtagedit();else if("tag-add"==b){var d=$(a.currentTarget).siblings("input").val();d&&(this.submittag(d),$(a.currentTarget).siblings("input").val(""))}else if("viewcontact"==b){if(this.parent)return;var e=this.model.attributes.from?this.model.attributes.from[0]:null;e&&Cloudwalkers.RootView.viewContact({model:e})}else this.model.trigger("action",b)},togglecomments:function(){this.$el.find("[data-token=comment][data-action=action-list]").click()},editnote:function(){var a=new d({model:this.model});this.stopListening(this.model),this.listenTo(a,"edit:cancel",this.canceledit),this.listenTo(a,"save:success",this.saved),this.$el.find(".message-body").addClass("note-content").html(a.render().el),this.$el.find(".message-actions").addClass("hidden"),this.$el.find(".toggle-note-actions").toggle()},showtagedit:function(){this.$el.find(".message-tags").toggleClass("enabled"),this.$el.find(".message-tags .edit").toggleClass("inactive")},canceledit:function(a){this.loadmylisteners(),this.$el.find(".message-actions").removeClass("hidden"),a?(this.toggleactions("note","note"),this.$el.find(".note-content .modal-body textarea").val("")):(this.$el.find(".message-body").removeClass("note-content").html(this.model.get("text")),this.$el.find(".toggle-note-actions").toggle())},saved:function(){setTimeout(function(){this.canceledit(),this.loadmylisteners()}.bind(this),200)},toggleactions:function(a,b,c){if(!c||!$(c.currentTarget).hasClass("noresults")){var d=this.$el.find("[data-action="+a+"][data-token="+b+"]");d.hasClass("inactive")?d.hasClass("inactive")&&this.processaction("close"):this.processaction("open",a,b)}},processaction:function(a,b,c){var d=this.$el.find("[data-action="+b+"][data-token="+c+"]"),e=this.$el.find(".actionvalue.inactive"),f=this.$el.find(".actionname.inactive"),g=this.$el.find(".action-list"),h=this.$el.find(".note-content"),i=!1;(g.is(":visible")||h.is(":visible"))&&(i=!0),e.removeClass("inactive"),f.removeClass("inactive"),this.$el.find(".action-list").slideUp("fast"),this.$el.find(".note-content").slideUp("fast"),"close"!=a&&setTimeout(function(){d.addClass("inactive"),"action-list"==b?this.expandlist(c):"note"==b&&h.slideDown()}.bind(this),i?200:1)},expandlist:function(a){var b=a+"list";return this.loadedlists.indexOf(b)<0?this.fetchactions(a):void this.$el.find(".action-list."+a+"-list").slideDown()},fetchactions:function(a){var b="note"==a?this.model.notes:this.model.notifications,c={records:999};b.reset(),"notes"!=a&&(c.markasread=!0),b.parentmodel=this.model,b.parenttype="message",this.listenTo(b,"seed",this.fillactions.bind(this,a)),b.touch(this.model,c),this.loadedlists.push(a+"list")},fillactions:function(a,b){var c=a+"-list";if(!b.length)return this.$el.find(".action-list li").html("No actions found");this.$el.find("."+c).remove();this.$el.find(".action-lists").append('<ul class="action-list '+c+'"></ul>');for(var d in b)this.addaction(b[d],a)},addaction:function(a,b){var c={model:a,template:"note"==b?"subnote":"subcomment"},d=b+"-list";this.newaction&&(c.isnew=!0),a="note"==b?new e(c):new f(c),this.$el.find("."+d).append(a.render().el),this.newaction=!1},toggleaction:function(a,b){if(b){var c=this.$el.find('[data-action="'+a+'"]'),d=c.clone().attr("data-action",b.token);c.is("a")?d.html("<i class='icon-"+b.icon+"'></i> "+b.name):d.find("i").attr("class","").addClass("icon-"+b.icon),c.before(d).remove()}},toggle:function(){this.trigger("toggle",this)},checkUnread:function(){this.model.get("read")?this.$el.removeClass("unread"):this.$el.addClass("unread")},loadYoutube:function(){var a=this.$el.find(".timeline-video").eq(0),c=a.data("youtube");a.attr("data-youtube","").removeClass("inactive"),a.html(b.render(Templates.youtube,{url:c}))},loadnoteui:function(){var a=new d({parent:this.model,persistent:!0});this.composenote=a,this.listenTo(a,"save:success",this.noteadded),this.listenTo(a,"edit:cancel",this.canceledit.bind(this,!0)),this.$el.find(".note-content").append(a.render().el)},fetchnotes:function(){this.model.notes.parentmodel=this.model,this.model.notes.parenttype="message",this.listenTo(this.model.notes,"seed",this.fillnotes),this.model.notes.touch(this.model),this.loadednotes=!0},fillnotes:function(a){a.length?this.$el.find(".note-list").empty():this.$el.find(".note-list li").html(trans("No Notes found"));for(var b in a)this.addnote(a[b])},addnote:function(a){var b,c={model:a,template:"subnote"};this.newnote&&(c.isnew=!0),b=new e(c),this.$el.find(".note-list").append(b.render().el),this.newnote=!1},noteadded:function(){this.toggleactions("action-list","note"),this.newnote=!0,this.fetchactions("note"),this.trigger("note:added"),this.composenote.remove(),this.loadnoteui()}});return g}),define(["mustache","Views/Entries/BaseEntry"],function(a,b){var c=b.extend({className:"entry entrynote",events:{remove:"destroy","click [data-notifications]":"loadNotifications","click [data-youtube]":"loadYoutube","click *[data-action]":"action",click:"toggle"},initialize:function(a){this.parameters={},a&&$.extend(this,a),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"action:toggle",this.toggleaction),this.listenTo(this.model,"destroy",this.remove)},render:function(){return $.extend(this.parameters,this.model.attributes),this.model.loaded()&&(this.model.loaded("model")&&(this.model.parent?(this.parameters.parent=this.model.parent.attributes,Cloudwalkers.RootView.trigger("ready:notecontext")):(this.model.parent=this.model.attachParent(this.model.get("model").objectType,this.model.get("model").id),this.model.parent.loaded()?(this.parameters.parent=this.model.parent.attributes,Cloudwalkers.RootView.trigger("ready:notecontext")):this.listenTo(this.model.parent,"sync",this.render))),"full"==this.type&&(this.parameters.actions=this.model.filterActions())),Cloudwalkers.Session.censuretemplate(this.parameters),this.$el.html(a.render(Templates[this.template],this.parameters)),this.$el.find("[data-date]")&&this.time(),this}});return c}),define(["Views/Entries/BaseEntry","mustache","Collections/Actions"],function(a,b){var c=a.extend({tagName:"li",template:"message",className:"subentry",events:{mouseover:"toggleactions",mouseout:"toggleactions","click *[data-subentry-action]":"action","click .viewcommentcontact":"togglecommentcontact","click .note-header":"togglenote"},render:function(){return $.extend(this.parameters,this.model.attributes),this.model.get("objectType")&&(this.parameters.actions=this.model.filterActions()),this.$el.html(b.render(Templates[this.template],this.parameters)),this},action:function(a){var b=$(a.currentTarget).data("subentry-action");this.model.trigger("action",b)},toggleactions:function(a){var b="mouseout"==a.originalEvent.type;this.$el.find(".subentry-actions")[b?"addClass":"removeClass"]("hidden"),this.$el.find(".subentry-info")[b?"removeClass":"addClass"]("hidden")}});return c}),define(["Views/Entries/SubEntry","mustache","Views/Modals/SimpleCompose"],function(a,b,c){var d=a.extend({template:"subnote",className:"subentry subnote",initialize:function(a){this.parameters={},a&&$.extend(this,a),this.listenToOnce(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){return Cloudwalkers.Session.censuretemplate(this.model.attributes),this.model.attributes.date=moment(this.model.attributes.date).format("DD MMM YYYY"),this.$el.html(b.render(Templates[this.template],this.model.attributes)),this.isnew&&this.makenew(),this},makenew:function(){this.$el.addClass("new"),setTimeout(function(){this.$el.removeClass("new")}.bind(this),2e3)},togglenote:function(){this.$el.find(".note-body").slideToggle("fast")},action:function(a){a.stopPropagation();var b=$(a.currentTarget).data("subentry-action");this.model.trigger("action",b),"edit"==b&&(this.$el.find(".note-body").is(":visible")||this.togglenote(),this.isediting?this.canceledit():this.editnote())},editnote:function(){var a=new c({model:this.model});this.listenTo(a,"edit:cancel",this.canceledit),this.listenTo(a,"save:success",this.saved),this.$el.find(".note-body").html(a.render().el),this.isediting=!0},canceledit:function(){this.$el.find(".note-body").html(this.model.get("text")),this.isediting=!1},saved:function(){setTimeout(function(){this.canceledit()}.bind(this),200)},remove:function(){this.$el.slideUp(300),setTimeout(function(){this.remove()}.bind(this),300)}});return d}),define(["Views/Entries/SubEntry","mustache","Collections/Actions"],function(a){var b=a.extend({toggleaction:function(a,b){var c=this.$el.find('div[data-subentry-action="'+a+'"]'),d=c.clone();d.attr("data-subentry-action",b.token).find("i").attr("class","").addClass("icon-"+b.icon),c.before(d).remove()},markasread:function(){this.model.save({read:1},{patch:!0,wait:!0}),this.model.get("stream")&&Cloudwalkers.Session.getStreams().outdated(this.model.get("stream"))},togglecommentcontact:function(){var a=this.model.attributes.from?this.model.attributes.from[0]:null;a&&Cloudwalkers.RootView.viewContact({model:a})}});return b}),define(["Views/BaseView","mustache","chosen","datepicker","timepicker","Models/Message","Views/Modals/Compose/Editor","Views/Modals/Compose/Preview","Collections/CannedResponses"],function(a,b,c,d,e,f,g,h){var i=a.extend({id:"compose",className:"modal fade",type:"post",network:"default",actionstreams:[],actionview:!1,minutestep:5,maxfilesize:3e6,besttimes:{},titles:{post:"Write Post",edit:"Edit Post",share:"Share message",comment:"Write Comment",reply:"Write Reply",dm:"Write Message",retweet:"Retweet",like:"Like",favourite:"Favourite",plusone:"Plus one","default":"Compose"},limitations:{},options:{"false":["editor","images","campaign","schedule","repeat"],twitter:["editor","images","campaign","schedule","repeat"],facebook:["editor","fullbody","images","campaign","schedule","repeat"],linkedin:["editor","fullbody","images","campaign","schedule","repeat"],tumblr:["subject","editor","fullbody","images","campaign","schedule","repeat"],"google-plus":["editor","fullbody","images","campaign","schedule","repeat"],youtube:["subject","editor","fullbody","video","campaign","schedule","repeat"],blog:["subject","editor","fullbody","images","campaign","schedule","repeat"],group:["editor","images","campaign","schedule","repeat"],"mobile-phone":["editor","schedule","repeat"],comment:["editor","canned"],reply:["editor","canned"],dm:["editor","canned"],retweet:["icon"],like:["icon"],favorite:["icon"],plusone:["icon"]},icons:{retweet:"retweet",like:"thumbs-up",favorite:"star",plusone:"plus-square"},events:{"click li[data-streams]":"togglestreams","click .stream-tabs div":"togglestream","click [data-toggle]":"toggleoption","keyup [data-option] input":"monitor","change [data-option] #compose-content":"monitor","keyup [data-option] #compose-content":"monitor","paste [data-option] #compose-content":"triggerpaste","blur [data-option] #compose-content":"triggerblur","click .add-file":"addfile","click .add-snapshot":"addsnapshot","change [data-collapsable=images] input":"listentofiles","click .photo-booth":"listentobooth","click li.images-thumb":"removefile","blur [data-collapsable=link] input":"listentolink","change select.campaign-list":"listentocampaign","change select.canned-list":"listentocanned","blur .campaign-name":"listentoaddcampaign","click .add-campaign":"toggleaddcampaign","click .schedule-entry":"monitorschedule","blur [data-collapsable=schedule] input, [data-collapsable=repeat] input":"monitorschedule","change .schedule-group select":"monitorschedule","click .schedule-group input":"monitorschedule","click [data-set=on] .btn-white":"togglebesttime","click .end-preview":"endpreview","click #previewbtn":"preview","click #save":"save","click #post":"post","click #action, [data-type=icon] > i":"postaction"},initialize:function(a){if(a&&$.extend(this,a),this.streams=Cloudwalkers.Session.getChannel("outgoing").streams,this.action&&(this.type=this.action.get("token")),this.action&&"share"==this.type?(this.draft=this.reference.cloneSanitized(),this.draft.attributes.variations=[]):this.action&&this.reference?(this.action.parent=this.reference,this.actionstreams=[],this.actionview=!0,this.action.params={},$.extend(!0,this.action.params,this.action.parameters),delete this.action.parameters,this.listenTo(this.action,"change",this.editstreams),this.action.fetch()):this.model&&(this.type="edit",this.state="loading",this.draft=this.model.clone(),this.draft.get("streams").length&&(this.initstream=this.draft.get("streams")[0].id),this.draft.fetch({endpoint:"original",success:this.original.bind(this)})),this.draft||(this.draft=new f({variations:[],attachments:[],streams:[],body:{},schedule:{}}),this.listenTo(this.draft,"invalid",this.invalid)),this.loadmylisteners(),"reply"==this.type&&"twitter"==this.reference.get("networktoken")){var b=(this.action.params[0],"@"+this.reference.get("from")[0].username),c='<short contenteditable="false">'+b+"</short>&nbsp;";this.draft.set("body",{html:c})}this.censurecompose()},loadmylisteners:function(){this.loadListeners(this.draft,["request","sync"],!0)},censurecompose:function(){var a=[],b={MESSAGE_OUT_ATTACHMENTS:["images"],MESSAGE_OUT_SCHEDULE:["schedule"],MESSAGE_OUT_REPEAT:["repeat"],CAMPAIGN_CREATE:["campaign"]};$.each(b,function(b,c){Cloudwalkers.Session.isAuthorized(b)||(a=_.union(a,c))}),$.each(this.options,function(b,c){this.options[b]=_.difference(c,a)}.bind(this))},original:function(){var a=this.draft.get("variations"),b=this.draft.get("schedule");b&&b.date&&(b.date=moment(b.date).unix()),b&&b.repeat&&b.repeat.until&&(b.repeat.until=moment(b.repeat.until).unix()),a&&$.each(a,function(a,b){b.schedule&&b.schedule.date&&(b.schedule.date=moment(b.schedule.date).unix()),b.schedule&&!b.schedule.date&&(b.schedule.now=!0),b.schedule&&b.schedule.repeat&&b.schedule.repeat.until&&(b.schedule.repeat.until=moment(b.schedule.repeat.until).unix()),b.attachments&&b.attachments.length&&(b.attachments=[b.attachments.pop()])}),this.state="loaded",this.render(),this.$el.find("[data-stream="+this.initstream+"]").click()},render:function(){var a={streams:this.actionstreams.length?this.actionstreams:this.streams.models,title:this.titles[this.type],campaigns:Cloudwalkers.Session.getAccount().get("campaigns"),canned:this.option("canned")?Cloudwalkers.Session.getCannedResponses().models:null,actionview:this.actionview?this.type:!1};"edit"==this.type&&(a.type=this.type),Cloudwalkers.Session.censuretemplate(a);
var c=b.render(Templates.compose,a);return this.$el.html(c),this.$el.attr("tabindex","-1"),this.$el.attr("role","dialog"),this.$el.attr("aria-hidden","true"),"loading"==this.state&&this.disablefooter(),this.editor||(this.editor=new g({draft:this.draft,parent:this})),this.$el.find("[data-type=post]").append(this.editor.render().el),this.listenTo(this.editor,"imageadded",this.listentourlfiles),this.listenTo(this.editor,"change:content",this.monitor),this.$el.find(".campaign-list").chosen({width:"50%"}),this.$el.find(".canned-list").chosen({width:"100%"}),this.$el.find("#delay-date, #repeat-until").datepicker({format:"dd-mm-yyyy",weekStart:1}),this.datepicker=this.$el.find("#delay-date, #repeat-until").datepicker({format:"dd-mm-yyyy",orientation:"auto"}),this.timepicker=this.$el.find("#delay-time").timepicker({template:"dropdown",minuteStep:this.minutestep,showMeridian:!1}),this.timepicker.on("show.timepicker",function(a){this.monitorschedule(a)}.bind(this)),this.timepicker.on("hide.timepicker",function(a){this.monitorschedule(a)}.bind(this)),this.$loadercontainer=this.$el.find(".modal-footer"),"loaded"==this.state&&this.$el.find(".modal-body").addClass("loaded"),(void 0!==this.draft.get("variations")||"share"==this.type)&&(this.defaultstreams(),this.togglesubcontent(),this.trigger("rendered")),this},option:function(a){var b=this.options[this.type];return b?b.indexOf(a)>=0:!1},restarttime:function(){var a=this.minutestep*Math.ceil(moment().minute()/this.minutestep),b=moment().hour();this.$el.find("#delay-time").timepicker("setTime",b+":"+a)},restartdate:function(){$(this.datepicker.get(0)).datepicker("update",moment.unix().format("DD/MM/YYYY"))},editstreams:function(a){var b=a.get("actions").filter(function(b){return b.token==a.token?b.streams:void 0})[0];this.actionstreams=[];for(var c in b.streams)Cloudwalkers.Session.getStream(b.streams[c])&&this.actionstreams.push(Cloudwalkers.Session.getStream(b.streams[c]));this.render(),this.$el.find("aside li").eq(0).click()},monitor:function(a){var b;b=a?$(a.target):this.$el.find("#compose-content"),this.editor.trigger("change:editor",a);var c=this.activestream?this.activestream.id:!1,d=b.html()||b.val(),e=b.text(),f=b.attr("data-option");"body"==f&&(d={html:d,plaintext:e}),c?this.draft.setvariation(c,f,d):this.draft.set(f,d)},updatelimitations:function(a,b){if(!a)return void this.editor.trigger("update:limit",0);var c,d=Cloudwalkers.Session.getStream(a),e=d.getlimitations(),f=0;a&&this.draft.getvariation(a,"image")?(c=this.draft.getvariation(a,"image"),$.each(c,function(){f+=this.draft.getvariation(a,"image").length}.bind(this))):this.draft.get("attachments")&&(c=this.draft.get("attachments").filter(function(a){return"image"==a.type?a:void 0}),$.each(c,function(b){return a&&this.draft.checkexclude(a,b)?!0:void f++}.bind(this))),f&&e["picture-url-length"]?this.editor.trigger("update:limit",e["picture-url-length"].limit,b):this.editor.trigger("update:limit",0,b)},toggleoption:function(a){var b=$(a.currentTarget),c=b.data("toggle"),d=b.parent().toggleClass("collapsed");d.hasClass("collapsed")&&this["summarize"+c]&&this["summarize"+c](),this.$el.addClass("hidden"),this.$el.removeClass("hidden")},closealloptions:function(){this.$el.find("[data-collapsable]").not(".collapsed").addClass("collapsed").each(function(a,b){this["summarize"+$(b).data("collapsable")]()}.bind(this))},defaultstreams:function(){var a=this.draft.get("streams");a&&a.forEach(function(a){this.$el.find("li[data-streams="+(a.id?a.id:a)+"]").click()}.bind(this))},addstreamtab:function(a){this.$el.find(".tabs-container > section").append('<div class="stream-tab" data-stream="'+a.id+'"><i class="fa fa-'+a.get("network").icon+'"></i> '+a.get("defaultname")+"</div>")},togglestreams:function(a){var b=this.$el.find(".tabs-container > section"),c=$(a.currentTarget),d=c.data("streams"),e=Cloudwalkers.Session.getStream(d),f=this.draft.get("streams")||[];if(c.hasClass("active")){if(this.$el.find("[data-stream="+d+"]").remove(),!b.find("div.active").size()){{var g=this.$el.find(".stream-tabs div").eq(0);g.data("stream")}g.addClass("active"),this.trigger("update:streams",f)}f.splice(f.indexOf(d),1),this.draft.removevariation(d)}else this.addstreamtab(e),f.indexOf(d)<0&&f.push(d);c.toggleClass("inactive active"),this.isscrolling()?this.$el.find(".stream-tabs").addClass("scrolling"):this.$el.find(".stream-tabs").removeClass("scrolling")},togglestream:function(a){var b=$(a.currentTarget),c=b.data("stream"),d=c?Cloudwalkers.Session.getStream(c):!1;this.$el.find(".stream-tabs div.active").removeClass("active"),b.addClass("active"),this.toggleschedentry("[data-set=now], [data-set=in]").toggleschedentry("[data-set=on]",!0),this.togglesubcontent(d)},togglesubcontent:function(a){var b,c,d,e;this.activestream=a,this.actionview?(d=this.options[this.type],c=!1):(c=a?a.get("network").token:!1,e=a?a.get("network").icon:"default",d=this.options[c],b=a?a.id:!1),this.network=c,this.$el.find("#previewbtn").attr("disabled",this.network?!1:!0),this.$el.find(".modal-body").hasClass("loading")||(this.$el.find(".modal-body").get(0).className="modal-body",this.$el.find(".modal-body").addClass(e+"-theme")),d.indexOf("subject")>=0?this.$el.find("[data-option=subject].hidden").removeClass("hidden"):this.$el.find("[data-option=subject]").addClass("hidden"),d.indexOf("editor")>=0?this.$el.find("#editor.hidden").removeClass("hidden"):this.$el.find("#editor").addClass("hidden"),d.indexOf("canned")>=0?this.$el.find("[data-type=canned]").removeClass("hidden"):this.$el.find("[data-type=canned]").addClass("hidden"),d.indexOf("fullbody")>=0?this.$el.find("[data-option=limit]").addClass("hidden"):this.$el.find("[data-option=limit].hidden").removeClass("hidden"),d.indexOf("icon")>=0?this.$el.find("[data-type=icon]").removeClass("hidden").find("i").get(0).className="icon-"+this.icons[this.type]:this.$el.find("[data-type=icon]").addClass("hidden"),this.updateschedule(),this.closealloptions(),this.toggleimages(d.indexOf("images")>=0,d.indexOf("multiple")>=0),this.togglecampaign(d.indexOf("campaign")>=0),this.toggleschedule(d.indexOf("schedule")>=0),this.togglerepeat(d.indexOf("repeat")>=0),this.updatesubject(),this.updateimages(),this.summarizeschedule(),this.updatelimitations(a?a.id:null),this.trigger("update:stream",{id:b,data:this.draft.getvariation(b,"body")})},updatesubject:function(){var a,b=this.activestream?this.activestream.id:!1,c=this.$el.find("[data-option=subject] > input").empty();b&&this.draft.getvariation(b,"subject")?a=this.draft.getvariation(b,"subject"):this.draft.get("subject")&&(a=this.draft.get("subject")||""),c.val(a)},addfile:function(){$("[data-collapsable=images] input").click()},listentofiles:function(a){{var b=(this.activestream?this.activestream.id:!1,a.target.files);this.draft}for(var c in b){var d=b[c];if(d.type.match(/^image\/(gif|jpg|jpeg|png)$/i)){if(!(d.size>this.maxfilesize)){var e=new FileReader;e.onload=this.fileparser(d,a),e.readAsDataURL(d);break}this.showerror("Upload failed: ","image size exceeds 3mb")}else this.showerror("Upload failed: ","only .jpg .jpeg .png and .gif extensions supported")}},fileparser:function(a){return function(b){this.addimage({type:"image",data:b.target.result,name:a.name}),this.updatelimitations(streamid,!0),this.editor.trigger("change:charlength")}.bind(this)},listentourlfiles:function(a){var b=this.activestream?this.activestream.id:!1,c=0;b&&this.draft.getvariation(b,"image")&&(c+=this.draft.getvariation(b,"image").length),this.draft.get("attachments")&&(imgs=this.draft.get("attachments").filter(function(a){return"image"==a.type?a:void 0}),c+=imgs.length),c||this.addimage(a)},addimage:function(a){var b=this.activestream?this.activestream.id:!1;b?this.draft.setvariation(b,"image",a):this.draft.attach(a),this.summarizeimages(a),this.listimage(a),this.disableimages()},summarizeimages:function(a){if(a){var b=a.data||a.url,c=this.$el.find("[data-collapsable=images] .summary");$("<li></li>").prependTo(c).attr("data-filename",a.name).css("background-image","url("+b+")")}},listimage:function(a){{var b=a.data||a.url,c=(this.draft,this.$el.find("ul.pictures-container"));$("<li></li>").prependTo(c).attr("data-filename",a.name).addClass("images-thumb").css("background-image","url("+b+")")}},updateimages:function(){{var a,b=this.activestream?this.activestream.id:!1,c=(this.$el.find("[data-collapsable=images] .summary").empty(),this.$el.find("ul.pictures-container").empty());this.$el.find("ul.snapshots-container").empty()}b&&this.draft.getvariation(b,"image")&&this.draft.getvariation(b,"image").length?(a=this.draft.getvariation(b,"image"),$.each(a,function(a,b){this.summarizeimages(b),this.listimage(b)}.bind(this))):this.draft.get("attachments")&&(a=this.draft.get("attachments").filter(function(a){return"image"==a.type?a:void 0}),$.each(a,function(a,c){return b&&this.draft.checkexclude(b,a)?!0:(this.summarizeimages(c),void this.listimage(c))}.bind(this))),0===c.find("li.images-thumb").length&&this.enableimages()},toggleimages:function(a){this.$el.find("[data-collapsable=images]")[a?"removeClass":"addClass"]("hidden")},addsnapshot:function(){this.$el.find(".photo-booth").removeClass("hidden"),this.media||(this.media=new MediaClass({video:!0})),this.media.start()},listentobooth:function(){if(this.media){{var a=this.media.snapshot();$("<li></li>").prependTo("ul.snapshots-container").attr("data-filename",moment().unix()).addClass("images-thumb").css("background-image","url("+a+")")}this.disableimages(),this.draft.attach({type:"image",data:a,name:moment().unix()}),this.$el.find(".photo-booth").addClass("hidden")}},removefile:function(a){var b,c=this.activestream?this.activestream.id:!1,d=$(a.currentTarget).remove(),e=this.draft.get("attachments")||[];for(var f in e)if("image"==e[f].type&&e[f].name==d.data("filename")){b=parseInt(f);break}c?(this.draft.removevarimg(c,_.isNumber(b)?b:d.data("filename")),this.updatelimitations(c,!0),this.editor.trigger("change:charlength")):(e.splice(b,1),this.draft.get("variations")&&$.each(this.draft.get("variations"),function(a,c){c.excludes&&(c.excludes.attachments=_.difference(c.excludes.attachments,[b]))})),this.$el.find('[data-collapsable=images] .summary [data-filename="'+d.data("filename")+'"]').remove(),0===this.$el.find("ul.pictures-container li.images-thumb").length&&this.enableimages()},enableimages:function(){var a='<li class="add-file">+</li>',b='<li class="add-snapshot">+</li>';this.$el.find("ul.pictures-container").append(a),this.$el.find("ul.snapshots-container").append(b)},disableimages:function(){this.$el.find("li.add-file").remove(),this.$el.find("li.add-snapshot").remove()},togglecampaign:function(a){this.$el.find("[data-collapsable=campaign]")[a?"removeClass":"addClass"]("hidden");return this},summarizecampaign:function(){var a=this.draft.get("campaign"),b=this.$el.find("[data-collapsable=campaign] .summary").empty();if(a){var c=Cloudwalkers.Session.getAccount().get("campaigns").filter(function(b){return b.id==a?b:void 0}).shift();b.html("<span>"+c.name+"</span>")}return this},listentocampaign:function(a){var b=$(a.currentTarget).val(),c=$(".chosen-single > span").get(0).textContent;0===b?this.removecampaign():(this.draft.set("campaign",Number(b)),this.trigger("update:campaign",c)),this.summarizecampaign().$el.find("[data-collapsable=campaign]").addClass("collapsed")},toggleaddcampaign:function(){return this.$el.find(".chosen-container, .campaign-name").toggleClass("hidden"),this},listentoaddcampaign:function(a){{var b=$(a.currentTarget).val();$(".chosen-single > span").get(0).textContent}Cloudwalkers.Session.getAccount().addcampaign(b,function(a){var b=a.get("campaigns");this.draft.set("campaign",b[b.length-1].id),this.trigger("update:campaign",b[b.length-1].name),this.reloadcampaigns(b),this.summarizecampaign().$el.find("[data-collapsable=campaign]").addClass("collapsed")}.bind(this))},reloadcampaigns:function(a){var b=this.$el.find(".campaign-list").empty();for(var c in a)b.append($("<option value='"+a[c].id+"'>"+a[c].name+"</option>"));b.trigger("chosen:updated")},removecampaign:function(){this.draft.get("campaign")&&(delete this.draft.attributes.campaign,this.trigger("update:campaign",null))},toggleschedule:function(a){this.$el.find("[data-collapsable=schedule]")[a?"removeClass":"addClass"]("hidden");return this},togglerepeat:function(a){this.$el.find("[data-collapsable=repeat]")[a?"removeClass":"addClass"]("hidden");return this},toggleschedentry:function(a,b){var c=b?"removeClass":"addClass",d=b?"addClass":"removeClass";return $(a)[c]("inactive").find("label")[c]("fa fa-circle-o")[d]("fa fa-check-circle-o"),this},parsemoment:function(a,b){var c=moment(a.val(),["DD-MM-YYYY","DD-MM-YY","DD/MM/YYYY","DD/MM/YY","DDMMYYYY","YYYYMMDD","MM-DD-YYYY","MM-DD-YY"]),d=b?b.val().split(":"):null,e=_.clone(c);return d&&d.length>1&&e.add("minutes",60*Number(d[0])+Number(d[1])),e.isValid()?e:void 0},parsescheduledate:function(a,b){var c=$(a),d=$(b);if(d.val()||this.restarttime(),c.val()||this.restartdate(),!c.val()||!d.val())return null;var e=this.parsemoment(c,d);return e},parserepeatdate:function(a){var b=$(a);if(!b.val())return null;var c=this.parsemoment(b);return c?void 0:void 0},updateschedule:function(){var a;if((a=this.draft.original(this.activestream,"schedule"))||(a=this.draft.original(null,"schedule")),this.toggleschedentry(".schedule-group [data-set]",!1).toggleschedentry("[data-set=now], [data-set=onlyonce]",!0),$("#delay-date, #delay-time, #repeat-interval, #repeat-amount, #repeat-until").val("").attr("disabled",!1),$("#repeat-interval, #repeat-amount").val(0),$("[data-set=in] .btn-white").addClass("inactive"),$("#delay-select").val(600),$("#every-select").val(168),$("#every-select-weekday").val(0).attr("disabled",!1),a&&a.date&&a.settings&&a.settings.delayselect)this.toggleschedentry("[data-set=now]").toggleschedentry("[data-set=in]",!0),$("#delay-select").val(a.settings.delayselect);else if(a&&a.date&&(this.toggleschedentry("[data-set=now]").toggleschedentry("[data-set=on]",!0),$(this.datepicker.get(0)).datepicker("update",moment.unix(a.date).format("DD/MM/YYYY")),this.timepicker.timepicker("setTime",moment.unix(a.date).format("HH:mm")),a.besttimetopost)){var b=this.$el.find("[data-set=on] .btn-white");b.hasClass("inactive")&&b.toggleClass("inactive"),$("#delay-time").attr("disabled",!0)}a&&a.repeat&&(a.repeat.interval&&(this.toggleschedentry("[data-set=onlyonce]").toggleschedentry("[data-set=every]",!0),[720,168,24,1].some(function(b){var c=a.repeat.interval/b/3600;return Math.round(c)==c?($("#repeat-interval").val(c),$("#every-select").val(b),!0):void 0})),a.repeat.weekdays&&a.repeat.weekdays.length&&$("#every-select-weekday").val(a.repeat.weekdays[0]),a.repeat.amount&&(this.toggleschedentry("[data-set=onlyonce]").toggleschedentry("[data-set=repeat]",!0),$("#repeat-amount").val(a.repeat.amount)),a.repeat.until&&(this.toggleschedentry("[data-set=now]").toggleschedentry("[data-set=until]",!0),$(this.datepicker.get(1)).datepicker("update",moment.unix(a.repeat.until).format("DD/MM/YYYY"))))},monitorschedule:function(a,b){var c,d=b||$(a.currentTarget),e=d.data("set")?d:d.parents("[data-set]").eq(0),f=e.data("set");return(c=this.draft.original(this.activestream,"schedule"))||(c={repeat:{}}),c.now&&delete c.now,"now"==f?(this.toggleschedentry("[data-set=in], [data-set=on]").toggleschedentry("[data-set=now]",!0),$("[data-set=on] input").val("").attr("disabled",!1),$("[data-set=in] select").val(600),$("[data-set=in] .btn-white").addClass("inactive"),c={repeat:c.repeat,now:!0}):"in"==f?(this.toggleschedentry("[data-set=now], [data-set=on]").toggleschedentry("[data-set=in]",!0),$("[data-set=on] input").val("").attr("disabled",!1),$("[data-set=in] .btn-white").addClass("inactive")):"on"==f?(this.toggleschedentry("[data-set=now], [data-set=in]").toggleschedentry("[data-set=on]",!0),$("[data-set=in] select").val(600),this.parsescheduledate("#delay-date","#delay-time"),c.settings&&c.settings.delayselect&&delete c.settings.delayselect):"onlyonce"==f?(this.toggleschedentry("[data-set=onlyonce]",!0).toggleschedentry("[data-set=repeat], [data-set=until], [data-set=every]",!1),$("#repeat-interval, #repeat-amount").val(0),$("#every-select").val(600),$("#every-select-weekday").val(0).attr("disabled",!1),$("#repeat-until").val(""),delete c.repeat):"every"==f?this.toggleschedentry("[data-set=every]",!0).toggleschedentry("[data-set=onlyonce]",!1):"repeat"==f?(this.toggleschedentry("[data-set=every], [data-set=repeat]",!0).toggleschedentry("[data-set=onlyonce], [data-set=until]",!1),Number($("#repeat-interval").val())||$("#repeat-interval").val(1),Number($("#repeat-amount").val())||$("#repeat-amount").val(1),$("#repeat-until").val("")):"until"==f&&(this.toggleschedentry("[data-set=every], [data-set=until]",!0).toggleschedentry("[data-set=onlyonce], [data-set=repeat]",!1),Number($("#repeat-interval").val())||$("#repeat-interval").val(1),$("#repeat-amount").val(0)),this.draft.original(this.activestream,"schedule",c),this.parsescheduled(),a.stopPropagation(),this},togglebesttime:function(a){var b;return(b=this.draft.original(this.activestream,"schedule"))||(b={repeat:{}}),$(a.currentTarget).toggleClass("inactive"),$(a.currentTarget).hasClass("inactive")?$("#delay-time").attr("disabled",!1):$("#delay-time").attr("disabled",!0),b.besttimetopost=!$(a.currentTarget).hasClass("inactive"),this.draft.original(this.activestream,"schedule",b),this},setbesttime:function(){},hasbesttime:function(){var a=this.activestream?this.activestream.id:!1,b=a?this.streams.models.filter(function(b){return b.id==a}):!1;return b.length?b[0].get("bestTimeToPost"):!1},parsescheduled:function(){var a;(a=this.draft.original(this.activestream,"schedule"))||(a={repeat:{}}),a.settings||(a.settings={});var b=this.$el.find("section[data-collapsable] .schedule-entry").not(".inactive").find("#delay-select, #delay-date, #delay-time, #repeat-interval, #every-select, #every-select-weekday, #repeat-amount, #repeat-until");if(b.filter("#delay-select").val())a.settings.delayselect=$("#delay-select").val(),a.date=moment().add("seconds",a.settings.delayselect).unix();else if(b.filter("#delay-date").val()){var c=this.parsescheduledate("#delay-date","#delay-time");c&&(a.date=c.unix()),b.filter("#delay-time").is("[disabled=disabled]")&&(a.besttimetopost=!0)}return b.filter("#repeat-interval").val()&&(a.repeat||(a.repeat={interval:604800}),a.repeat.interval=$("#repeat-interval").val()?$("#repeat-interval").val()*$("#every-select").val()*3600:0,$("#every-select-weekday").val()&&(a.repeat.weekdays=[$("#every-select-weekday").val()]),$("#every-select-weekday").attr("disabled",$("#every-select").val()<168),a.repeat.amount=Number(b.filter("#repeat-amount").val())?Number($("#repeat-amount").val()):!1,a.repeat.until=b.filter("#repeat-until").val()?moment($("#repeat-until").val(),["DD-MM-YYYY","DD-MM-YY","DD/MM/YYYY"]).unix():!1),a},summarizeschedule:function(){var a=this.parsescheduled(),b=this.$el.find("[data-collapsable=schedule] .summary").empty();if(a&&a.date){var c=a.besttimetopost?trans("Best time to post"):moment.unix(a.date).format("HH:mm");b.html("<span><i class='icon-time'></i> "+moment.unix(a.date).format("dddd, D MMMM YYYY")+"<em class='negative'>"+c+"</em></span>")}return this.summarizerepeat(),this},summarizerepeat:function(){var a,b,c,d=this.parsescheduled();if(d&&!d.repeat&&this.$el.find("[data-collapsable=repeat] .summary").empty(),!d||!d.repeat)return this;var e=this.$el.find("[data-collapsable=repeat] .summary").empty(),f=d.date?moment.unix(d.date):moment();if(d.repeat.until?(b=moment.unix(d.repeat.until),c=b.diff(f)/1e3,a=Math.round(c/d.repeat.interval)):d.repeat.interval&&(a=d.repeat.amount,b=f.clone().add("seconds",a*d.repeat.interval)),a)e.html("<span>"+a+" "+trans("times")+" "+(b?"<em class='negative'>"+trans("Until")+" "+b.format("dddd, D MMMM YYYY")+"</em>":"")+"</span>");else if(d.repeat.interval){var g,h;[720,168,24,1].some(function(a){return g=d.repeat.interval/a/3600,h=a,Math.round(g)==g?!0:void 0});var i={1:trans("hours"),24:trans("days"),168:trans("weeks"),720:trans("months")};e.html("<span>"+trans("Endless repeat every")+" "+g+" "+i[h])}return this},listentocanned:function(a){{var b=$(a.currentTarget).val();$(".chosen-single > span").get(0).textContent}if(0!==b){var c=Cloudwalkers.Session.getCannedResponses(),d=c.models.filter(function(a){return a.id==b?a:void 0}),e=d[0]?d[0].get("body").html:null;e&&this.trigger("replace:content",e)}},preview:function(){this.$el.addClass("switch-mode"),this.preview=new h({model:this.draft.clone(),previewtype:"default",streamid:this.activestream.id}),this.$el.find(".switch-container").append(this.preview.render().el)},endpreview:function(){this.preview.remove(),this.$el.removeClass("switch-mode")},save:function(a){var b=this.draft.validateCustom(["streams","schedule"]);return b?this.showerror("Not saved: ",b):(this.disablefooter(),a&&_.isString(a)||(a="draft"),this.draft.sanitizepost(),this.draft.id?this.draft.save({body:this.draft.get("body"),attachments:this.draft.get("attachments"),variations:this.draft.get("variations"),streams:this.draft.get("streams"),schedule:this.draft.get("schedule"),update:!0},{patch:!0,endpoint:"original",success:this.thankyou.bind(this,"save"),error:this.oops.bind(this,"save",a)}):this.draft.save({status:a},{success:this.thankyou.bind(this,"save"),error:this.oops.bind(this,"save",a)}),void this.loadingalert())},post:function(){var a=this.draft.validateCustom();return a?this.showerror(trans("Not posted")+": ",a):(this.disablefooter(),this.draft.sanitizepost(),this.draft.get("streams").length?this.draft.id?this.draft.save({body:this.draft.get("body"),attachments:this.draft.get("attachments"),variations:this.draft.get("variations"),streams:this.draft.get("streams"),status:"scheduled",schedule:this.draft.get("schedule"),update:!0},{patch:!0,endpoint:"original",success:this.thankyou.bind(this,"post"),error:this.oops.bind(this,"post")}):this.draft.save({status:"scheduled"},{success:this.thankyou.bind(this,"post"),error:this.oops.bind(this,"post")}):this.save("scheduled"),void this.loadingalert())},postaction:function(){var a,b,c=[],d="content";if(this.$el.find(".action-tabs div").each(function(){c.push($(this).data("stream"))}),this.options[this.type].indexOf("editor")>=0&&!this.draft.get("body").html&&(d=!1),a=this.draft.validateCustom([d]))return this.showerror(trans("Not posted")+": ",a);this.disablefooter(),this.$el.find("[data-type=canned] input").is(":checked")&&Cloudwalkers.Session.getCannedResponses().create({body:{plaintext:this.draft.get("body").plaintext},status:"CANNED"});var e=this.reference.actions.create({parameters:b?b:null,streams:c,message:this.draft.get("body").plaintext,actiontype:this.type},{success:this.thankyou.bind(this,null),error:this.oops.bind(this,"saveaction")});this.loadingalert(),this.loadListeners(e,["request:action","sync"]),e.trigger("request:action")},thankyou:function(a,c){var d=b.render(Templates.thankyou);if(setTimeout(function(){this.$el.addClass("switch-mode thanks"),this.$el.find(".switch-container").append(d),setTimeout(function(){this.$el.modal("hide")}.bind(this),1e3)}.bind(this),400),"edit"==this.type){var e=this.draft.get("variations");e&&e.length?e.forEach(function(b){b.id&&(a&&"post"==a&&Cloudwalkers.RootView.trigger("added:message",this.draft),Cloudwalkers.Session.getMessage(b.id).fetch({success:function(a){a.trigger("change")}}))}.bind(this)):this.model.fetch()}else"post"==this.type?Cloudwalkers.RootView.trigger("added:message",this.draft):this.trigger("action:success",c);Cloudwalkers.RootView.trigger(this.type.concat(":success"),this.type)},loadingalert:function(){setTimeout(function(){this.showerror("",trans("The network is quite busy for the moment, please wait while we're sending your message."))}.bind(this),2e4)},showerror:function(a,b){Cloudwalkers.RootView.information(a,b,this.$el.find(".modal-footer"))},oops:function(a,b){Cloudwalkers.RootView.confirm("An error ocurred while posting your message. Do you want to retry?",function(){this.loadmylisteners(),"save"==a?this.save(b):this.post()}.bind(this),function(){this.$el.modal("hide")}.bind(this))},disablefooter:function(){this.$el.find(".modal-footer .btn").attr("disabled",!0)},invalid:function(a,b){Cloudwalkers.RootView.alert(a.get("title")+" "+b)},isscrolling:function(){return this.$el.find(".stream-tabs").length?this.$el.find(".stream-tabs")[0].scrollWidth>this.$el.find(".stream-tabs").width():this.$el.find(".action-tabs").length?this.$el.find(".action-tabs")[0].scrollWidth>this.$el.find(".action-tabs").width():void 0},triggerpaste:function(a){this.editor.trigger("paste:content",a)},triggerblur:function(){this.editor.trigger("blur:content")}});return i}),define(["Views/BaseView","mustache"],function(a,b){var c=a.extend({id:"editor",oldUrl:"",urldata:{},currenturl:!1,urlprocessing:!1,limit:null,content:"",charlength:0,contentlimitation:0,pos:0,urls:{},posmap:[],restrictedstreams:{twitter:140,linkedin:700},events:{"update:content":"render","update:limit":"renderlimit","append:content":"append","click #swaplink":"swaplink",'click [data-type="title"] .addcontent':"addoecontent",'click [data-type="content"] .addcontent':"addoecontent",'click [data-type="image"] i':"addoeimg","mouseup #compose-content":"savepos"},xtrimmable:/<[^>]*>|&nbsp;|\s/g,xurlbasic:/http|[w]{3}/g,xurlpattern:/(^|\s|\r|\n|\u00a0)((https?:\/\/|[w]{3})?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?)(\s|\r|\n|\u00a0)/g,xurlendpattern:/(^|\s|\r|\n)((https?:\/\/|[w]{3})?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?)/g,initialize:function(a){a&&$.extend(this,a),this.listenTo(Cloudwalkers.Session.UrlShortener,"sync",this.shortenurl),this.listenTo(this.parent,"update:stream",function(a){this.togglecontent(a,!0)}.bind(this)),this.listenTo(this.parent,"update:campaign",this.campaignupdated),this.listenTo(this.parent,"replace:content",this.replacecontent),this.on("change:charlength",this.monitorlimit),this.on("change:editor",this.listentochange),this.on("paste:content",this.listentopaste),this.on("blur:content",this.endchange),this.loadListeners(this,["request:og","ready:og"]),this.on("update:limit",this.updatelimit),navigator.userAgent.match(/(firefox(?=\/))\/?\s*(\d+)/i)?this.isfirefox=!0:navigator.userAgent.match(/(chrome(?=\/))\/?\s*(\d+)/i)||(this.isexplorer=!0)},render:function(a){void 0!==a&&(this.content=a);var c=Math.min.apply(Math,_.values(this.restrictedstreams));return this.restrictedstreams["default"]=c,this.$el.html(b.render(Templates.editor,{limit:c})),this.limit=c,this.$contenteditable=this.$el.find("#compose-content").eq(0),this.contenteditable=this.$contenteditable.get(0),this.document=this.contenteditable.ownerDocument||this.contenteditable.document,this.win=document.defaultView||document.parentWindow,this.$contenteditable.html(this.content),this.content&&this.listentochange(),this.$loadercontainer=this.$el.find("#out-loading"),this.trigger("rendered"),this},listentopaste:function(a){if(a.preventDefault(),a.originalEvent||a.originalEvent.clipboardData){var b=a.originalEvent.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,b)}this.listentochange(a)},applystyle:function(){this.win.getSelection();this.contenteditable.designMode="on",document.execCommand("backColor",!1,this.limit?"#fcc":"#fff"),this.contenteditable.designMode="off"},applyselection:function(a){this.greyout(this.limit-this.$contenteditable.text().length,a)},listentochange:function(a,b){var c;(this.content!==this.$contenteditable.text()||b)&&(this.pos=this.cursorpos(),c=this.listentourl(a,this.$contenteditable.text()),c&&this.processurls(c)),this.content=this.$contenteditable.text(),this.isdefault&&!b&&(this.$contenteditable.removeClass("withdefault"),this.isdefault=!1),this.trigger("change:charlength"),b&&this.clearselections()},endchange:function(){if(this.$contenteditable.html().match(this.xurlendpattern)){var a=this.listentourl(null,this.$contenteditable.text(),!0);a&&this.processurls(a)}},listentourl:function(a,b,c){var d,e,f,g,h=this.win.getSelection(),i=this.document.createRange();return a&&"keyup"==a.type&&32!=a.keyCode||(a&&"paste"==a.type&&(c=!0),i.selectNodeContents(this.$contenteditable.get(0)),d=this.parsenodes(i.startContainer.childNodes,c),!d.length)?void 0:($.each(d,function(a,b){e=b.node.textContent.replace(/&nbsp;/gi,""),b.url=b.url.trim(),f=e.indexOf(b.url),g=f+b.url.length,0>f&&(f=0),i.setStart(b.node,f),i.setEnd(b.node,g),h.removeAllRanges(),h.addRange(i),this.contenteditable.designMode="on",document.execCommand("createLink",!1,b.url),this.contenteditable.designMode="off";var c=document.createTextNode("​");i.insertNode(c),this.$contenteditable.find("a").after(c),i.setStartAfter(c),h.removeAllRanges(),h.addRange(i),d[a+1]&&(d[a+1].node=b.node.nextSibling)}.bind(this)),_.pluck(d,"url"))},parsenodes:function(a,b){var c,d=[];return $.each(a,function(a,e){var f=!1,g=e.textContent;return b&&3!=e.nodeType?!0:(g&&(f=g.match(b?this.xurlendpattern:this.xurlpattern)),f&&f.length?($.each(f,function(a,b){3==e.nodeType?d.push({node:e,url:b}):(c=this.getnode(e,null,b),c&&b&&d.push({node:c,url:b}))}.bind(this)),!0):void 0)}.bind(this)),d},getnode:function(a,b,c){var d;return $.each(a.childNodes,function(a,e){if(!c){var f=e.textContent.length;return f>=b?e.childNodes.length?(this.getnode(e,b),!1):(this.currentnode={node:e,offset:b},!1):b-=f}if(3==e.nodeType)if(e.childNodes.length)d=this.getnode(e,null,type);else if(e.textContent.indexOf(c.trim())>-1)return d=e,!1}.bind(this)),d},processurls:function(a){if(this.$contenteditable.find("a").attr("contenteditable",!1),!this.campaign){var b=this.draft.get("campaign"),c=Cloudwalkers.Session.getAccount().get("campaigns"),d=c.filter(function(a){return a.id==b?a:void 0});this.campaign=d.length?d[0].name:null}a&&!this.urlprocessing&&(this.urlprocessing=!0,this.parseurls(a,this.campaign))},parseurls:function(a,b,c){var d={error:this.releaseurlprocessing};a.forEach(function(a){return!c&&this.urls[a]?void this.shortenurl(this.urls[a]):(d.q=a,d.campaign=b,void Cloudwalkers.Session.UrlShortener.fetch(d))}.bind(this))},shortenurl:function(a){this.releaseurlprocessing();var b=["description","og:description","og:image","og:video","og:title"],c=this,d=a.get("url"),e=a.get("shortUrl");this.urls[d]||(this.urls[d]=a.clone());var f=" <short contenteditable='false' data-long='"+d+"' data-short='"+e+"'>"+e+"<i class='icon-link' id='swaplink'></i></short>";this.$contenteditable.find("a[href='"+d+"']").replaceWith(f),this.trigger("change:content");var g='<div><a href="'+d+'" class="oembed"></a></div>';this.$el.find("#out").empty().html(g),this.$el.find(".oembed").oembed(null,null,this.embed).each(function(){c.$el.find("#out").removeClass("expanded"),c.trigger("request:og"),this.def.done(function(a){c.trigger("ready:og"),a&&("youtube"==a?c.$el.find("#out").addClass("expanded"):_.isObject(a)&&$.each(a,function(a){b.indexOf(a)>=0&&c.$el.find("#out").addClass("expanded")}))})}),this.trigger("change:charlength")},releaseurlprocessing:function(){this.urlprocessing=!1},swaplink:function(a){var b=$(a.currentTarget).get(0).parentElement,c=this.$contenteditable.text().length,d=$(b).data("long"),e=$(b).data("short"),f=$(b).get(0).textContent.trim(),g=e==f?d:e,h="<short contenteditable='false' data-long='"+d+"' data-short='"+e+"'>"+g+"<i class='icon-link' id='swaplink'></i></short>";$(b).replaceWith(h);var i,j=this.$contenteditable.text().length,k=j-c;i=this.$contenteditable.text().indexOf(e==f?d:e),this.cursorpos(this.pos>=i?this.pos+k:this.pos),this.pos=this.cursorpos(),this.trigger("change:content"),this.trigger("change:charlength")},campaignupdated:function(a){var b=this.urls;b.length&&this.parseurls(b,a,!0)},addoetitle:function(a){a.currentTarget.innerText},addoecontent:function(a){var b=a.currentTarget.parentElement.textContent,c=this.$contenteditable.html();c=c+"<br/>"+b,this.$contenteditable.html(c),this.trigger("change:content")},addoeimg:function(){var a=this.$el.find('[data-type="image"] img').get(0).src;this.trigger("imageadded",{type:"image",url:a,name:a})
},clearselections:function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges:document.selection&&document.selection.empty()},monitorlimit:function(){if(this.charlength=this.$contenteditable.text().length,this.limit){var a=this.limit-this.charlength;this.updatecounter(a)}},updatecounter:function(a){var b=this.$el.find(".limit-counter");a>=20&&b.removeClass().addClass("limit-counter"),20>a&&b.removeClass().addClass("limit-counter").addClass("color-notice"),0>a&&b.removeClass().addClass("limit-counter").addClass("color-warning"),b.empty().html(a)},updatelimit:function(a,b){this.contentlimitation=a,b&&(this.limit=this.restrictedstreams[this.network]?this.restrictedstreams[this.network]-this.contentlimitation:null)},greyout:function(a,b){var c,d,e=this.win.getSelection(),f=this.document.createRange(),g=this.cursorpos(),h=0,i=this.$contenteditable.find("short");if(this.content.length>=this.$contenteditable.text().length&&this.removegrey(),f.selectNodeContents(this.$contenteditable.get(0)),c=this.cursorpos(this.$contenteditable.text().length,!0),d=this.cursorpos(this.limit,!0),d.node){if(b)return;i.removeClass("red"),this.isurl(d.node)&&($(d.node.parentNode).addClass("red"),d.node=d.node.parentNode.nextSibling,d.offset=0,h++),f.setStart(d.node,d.offset),f.setEnd(c.node,c.offset),e.removeAllRanges(),e.addRange(f),$.each(i,function(a,b){e.containsNode(b)&&h++})}if(this.contenteditable.designMode="on",document.execCommand("backColor",!1,this.limit?"#fcc":"#fff"),this.contenteditable.designMode="off",h)for(;h>0;)$(i[i.length-h]).addClass("red"),h--;this.cursorpos(this.$contenteditable.text().length),this.mergechars(),this.cursorpos(g)},isurl:function(a){return result=!1,$.each(this.urls,function(b,c){return c.get("shortUrl")==a.textContent||b==a.textContent?(result=!0,!1):void 0}),result},removegrey:function(){var a=this.win.getSelection(),b=this.document.createRange();this.$contenteditable.find("span").length&&(b.selectNodeContents(this.$contenteditable.get(0)),a.removeAllRanges(),a.addRange(b),this.contenteditable.designMode="on",document.execCommand("removeFormat",!1,null),this.contenteditable.designMode="off")},mergechars:function(){$.each(this.$contenteditable.find("span"),function(a,b){$(b).html($(b).text())}.bind(this))},savepos:function(a){var b=a.target.tagName;"I"!=b&&"SHORT"!=b&&(this.pos=this.cursorpos())},cursorpos:function(a,b){var c,d,e;if(void 0===a)a=0,this.win.getSelection()&&this.win.getSelection().rangeCount&&(d=this.win.getSelection().getRangeAt(0),e=d.cloneRange(),e.selectNodeContents(this.contenteditable),e.setEnd(d.endContainer,d.endOffset),a=e.toString().length);else{this.getnode(this.$contenteditable[0],a);var f=this.currentnode;if(b)return{node:f.node,offset:f.offset};d=this.document.createRange(),c=this.win.getSelection(),d.setStart(f.node,f.offset),d.collapse(!0),c.removeAllRanges(),c.addRange(d)}return a},replacecontent:function(a){this.$contenteditable.empty().html(a),this.trigger("change:content")},togglecontent:function(a){var b,c,d;a&&(c=_.isNumber(a.id)?a.id:null,d=_.isObject(a.data)?a.data.html:null,b=c?Cloudwalkers.Session.getStream(c).get("network").token:null),this.network=b?b:"default",b&&!d?(this.$contenteditable.empty().html(this.draft.get("body").html),this.$contenteditable.addClass("withdefault"),this.isdefault=!0):c?(d||(d=""),this.$contenteditable.empty().html(d),this.$contenteditable.removeClass("withdefault")):(this.$contenteditable.empty().html(this.draft.get("body").html),this.$contenteditable.removeClass("withdefault")),this.limit=this.restrictedstreams[this.network]?this.restrictedstreams[this.network]-this.contentlimitation:null,$.each(this.$contenteditable.find("a"),function(a,b){b.innerText=b.innerText.trim()}),this.removegrey(!0),this.listentochange(null,!0)}});return c}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({id:"preview",networkclasses:{facebook:"fb",twitter:"twt","google-plus":"gp",linkedin:"li"},events:{"click #viewsummary":"togglesummary"},initialize:function(a){a&&$.extend(this,a),$.extend(this.model.attributes,this.model.getvariation(this.streamid)),this.model.attributes.profile=Cloudwalkers.Session.getStream(this.streamid).get("profile"),this.network=Cloudwalkers.Session.getStream(this.streamid).get("network").token},render:function(){var a=b.render(Templates.preview,{networkclass:this.networkclasses[this.network]});return this.$el.html(a),this.fill(),this},fill:function(){var a;this.previewdata={body:this.model.get("body")||"",profile:this.model.get("profile")},this.fakeload(1.2*Math.random()+.4),this.model.hasAttachement("link")&&this.$el.find("#network").addClass("link"),a=this.model.hasAttachement("image"),a&&(this.previewdata.image=a.data||a.url,this.$el.find("#network").addClass("img"));var c=b.render(Templates.previewtemplate,this.previewdata);this.$el.find("#pv-main").append(c)},fakeload:function(a){$dis=this.$el,$dis.find("#pv-main").addClass("pv-load"),$dis.find(".progress-bar").css("-webkit-transition","width "+a+"s ease-out"),setTimeout(function(){$dis.find("#pv-main").removeClass("pv-load").addClass("pv-loaded")},1e3*a)},mergedata:function(a,b){if(0===b.length)return a;var c={};return $.extend(c,a),$.extend(c,b),c},togglesummary:function(){this.$el.find(".pv-url-content").toggle()}});return c}),define(["Views/BaseView","mustache","Models/Contact","Collections/Notes","Collections/Messages","Views/Modals/SimpleCompose","Views/Entries/InboxMessage","Views/Panels/LoadMore","Views/Entries/BaseEntry","Views/Entries/InboxNote","Models/Message"],function(a,b,c,d,e,f,g,h,i,j,k){var l=a.extend({id:"compose",className:"modal viewcontact",entries:[],events:{"click .end-preview td i":"backtolist","click #contactfilter li":"loadmessages","click [data-action=write-note]":"togglecontactnote","click #post":"post","click aside *[data-action]":"action","keyup aside #tags":"entertag","click .load-more":"more"},initialize:function(a){a&&$.extend(this,a),this.contact=a.contact?a.contact.model:null,this.contact&&(this.model=new c(this.contact)),!this.model&&this.contactid&&(this.model=new c({id:this.contactid})),this.loadmylisteners()},loadmylisteners:function(a){"note"==this.type?(this.collection=new d,this.collection.parentmodel="contact",this.collection.parenttype="contact"):this.collection=new e,a&&this.stopListening(this.collection),this.listenTo(this.collection,"request",this.showloading),this.listenTo(this.collection,"seed",this.fill),this.listenTo(this.collection,"sync",this.paginate),this.listenTo(this.collection,"ready",this.showmore),this.loadListeners(this.collection,["request","sync",["ready","loaded"]],!0)},render:function(){Cloudwalkers.Session.censuretemplate(this.contactinfo);var a=b.render(Templates.viewcontact,this.contactinfo);return this.$el.html(a),this.$container=this.$el.find("ul.entry-container"),this.$loadercontainer=this.$el.find("ul.entry-container"),this.trigger("rendered"),this.updatecontactinfo(),Cloudwalkers.Session.isAuthorized("ACCOUNT_NOTES_MANAGE")&&this.initializenote(),(Cloudwalkers.Session.isAuthorized("ACCOUNT_TAGS_VIEW")||Cloudwalkers.Session.isAuthorized("ACCOUNT_TAGS_MANAGE"))&&this.loadtagui(),this.begintouch(),this},fill:function(a){this.refreshview&&($.each(this.entries,function(a,b){b.remove()}),this.entries=[]),a.length?this.$el.find(".messagelist").removeClass("empty-content"):this.$el.find(".messagelist").addClass("empty-content");var b,c,d="note"==this.type?"note":"smallentry";for(var e in a){b=a[e],b.attributes.arrow="arrow",b.parent=this.model;var f="note"==this.type?j:i;c=new f({model:b,template:d,checkunread:!0,parameters:{parent:this,contactview:!0}}),this.entries.push(c),this.listenTo(c,"toggle",this.loadmessage),this.$container.append(c.render().el)}this.refreshview=!1},seed:function(a,b){this.collection.models=b.contact.messages,this.collection.length=this.collection.models.length,this.collection.trigger("seed",this.collection.models)},begintouch:function(a){a||(a="messages"),this.type=a,this.loadmylisteners(!0),this.refreshview=!0,"messages"==a?this.getmessages():this.touch(a)},getmessages:function(a){this.model.urlparams=["messages"],this.model.parameters=a||!1,this.collection.url=this.model.url(),this.collection.parenttype="contact",this.collection.contactinfo=this.contactinfo,this.collection.parse=this.parse,this.collection.fetch({success:this.seed.bind(this)})},parse:function(a){if(this.parenttype&&(a=a[this.parenttype]),a[this.typestring]){for(var b in a[this.typestring])a[this.typestring][b]=new k(a[this.typestring][b]),a[this.typestring][b].generateintro(),a[this.typestring][b].set("read",1),a[this.typestring][b].set("fulldate",moment(a[this.typestring][b].get("date")).format("DD MMM YYYY HH:mm")),a[this.typestring][b].set("icon",this.contactinfo.network?this.contactinfo.network.icon:null),a[this.typestring][b].set("networkdescription",this.contactinfo.network?this.contactinfo.network.name:null),a[this.typestring][b].set("networktoken",this.contactinfo.network?this.contactinfo.network.token:null);this.setcursor(a.paging)}return this.ready(),a[this.typestring]},touch:function(a,b){this.collection.parentmodel=this.model,this.model.urlparams=[a+"ids"],this.model.parameters=b||!1,this.collection.url=this.model.url(),this.collection.fetch({success:this.touchresponse.bind(this)})},touchresponse:function(a,b){var c=b.contact[this.collection.typestring];this.model.urlparams=[this.type+"s"],this.model.parameters={ids:c.join(",")},this.collection.url=this.model.url(),this.collection.seed(c)},updatecontactinfo:function(){var a=this.model.attributes;a&&(Cloudwalkers.Session.censuretemplate(a),a.tags=!0,this.$el.find("aside").html(b.render(Templates.viewcontactaside,a)),setTimeout(function(){this.$el.find("aside").removeClass("nodata")}.bind(this),1),this.hascontactinfo=!0,this.contactinfo=a)},initializenote:function(){var a=new f({parent:this.model,persistent:!0});this.composenote=a,this.$el.find("#notecontainer").append(a.render().el),this.listenTo(a.model,"sync",this.doneposting.bind(this,200)),this.listenTo(a,"edit:cancel",this.doneposting)},doneposting:function(a){a||(a=0),setTimeout(function(){this.togglecontactnote(),this.composenote.remove(),this.initializenote(),"note"==this.type&&(this.refreshview=!0,this.touch("note"))}.bind(this),a)},loadmessages:function(a){this.backtolist();var b=$(a.currentTarget).attr("data-type");$(a.currentTarget).hasClass("inactive")&&(this.$el.find("#contactfilter .active").removeClass("active").addClass("inactive"),$(a.currentTarget).removeClass("inactive").addClass("active"),this.begintouch(b))},loadmessage:function(a){var b={model:a.model,notes:a.model.id?!0:!1,parent:this};"note"!=this.type&&($(".viewcontact").addClass("onmessage"),this.$loadercontainer=this.$el.find(".inbox-container"),this.inboxmessage&&this.inboxmessage.remove(),this.inboxmessage=new g(b),this.type&&"messages"!=this.type&&this.loadListeners(this.inboxmessage,["request","sync",["ready","loaded"]],!0),this.$el.find(".inbox-container").html(this.inboxmessage.render().el),this.type&&"conversation"==this.type?this.inboxmessage.showrelated():this.type&&"note"==this.type&&this.listenTo(this.inboxmessage.model,"destroy",this.backtolist),this.$el.find(".entry-container .active").removeClass("active"),a.$el.addClass("active"))},backtolist:function(){$(".viewcontact").removeClass("onmessage"),this.$loadercontainer=this.$el.find("ul.entry-container")},togglecontactnote:function(){$(".viewcontact").hasClass("writenote")?($(".viewcontact").removeClass("writenote"),setTimeout(function(){this.$el.find(".contactbottom").slideDown("fast")}.bind(this),100)):(this.$el.find(".contactbottom").slideUp("fast"),setTimeout(function(){$(".viewcontact").addClass("writenote")},100)),this.backtolist()},filterparams:function(){var a={records:20,contacts:this.contactid};return a},action:function(a){var b=$(a.currentTarget).data("action");if("tag-showedit"==b)this.showtagedit();else if("tag-add"==b){var c=$(a.currentTarget).siblings("input").val();c&&(this.submittag(c),$(a.currentTarget).siblings("input").val(""))}else this.model.trigger("action",b)},loadtagui:function(){this.fetchtags()},showtagedit:function(){this.$el.find("aside .message-tags").toggleClass("enabled"),this.$el.find("aside .message-tags .edit").toggleClass("inactive")},fetchtags:function(){var a=new TagsCollection;a.parentmodel=this.model,a.parenttype="contact",this.listenTo(a,"seed",this.rendertag),a.touch(this.model),this.loadedtags=!0},rendertag:function(a){a.length?this.$el.find(".tag-list").empty():this.$el.find(".tag-list").html("No tags found"),this.$el.find(".tag-list").empty();for(var b in a)this.addtag(a[b])},submittag:function(a){this.tag=new TagModel,this.model&&(this.tag.parent=this.model),this.tag.save({name:a},{success:this.addtag.bind(this)})},addtag:function(a){var b,c={model:a,parent:this.model,template:"messagetag"};b=new TagEntryWidget(c),this.$el.find("aside .tag-list").append(b.render().el)},entertag:function(a){if(13===a.which){var b=$(a.target).val();b&&(this.submittag(b),$(a.target).val(""))}},paginate:function(a,b){this.hasmore=a.cursor&&b.contact[a.endpoint||a.typestring].length?!0:!1},showloading:function(){this.$el.find(".load-more").hide()},showmore:function(){setTimeout(function(){if(this.$container.css("max-height",999999),!this.hasmore)return this.$el.find("#loadmore").empty();var a=new h({list:this.collection,parentcontainer:this.$container});this.$el.find("#loadmore").html(a.render().el),this.loadmore=a}.bind(this),200)},hideloading:function(){this.$el.find(".fa-cloud-download").hide(),this.$container.removeClass("inner-loading"),this.hasmore=this.model.messages.cursor?!0:!1},more:function(){if(this.incremental=!0,!this.collection.cursor)return!1;this.loadmore.loadmylisteners();var a={after:this.collection.cursor};"messages"==this.type?this.getmessages(a):this.touch(this.type,a),this.hasmore||this.$el.find(".load-more").hide()}});return l}),define(["Views/BaseView","mustache","Models/Note","Models/Message"],function(a,b,c,d){var e=a.extend({template:"simplecompose",events:{"click #post":"post","click #cancel":"cancel"},initialize:function(a){a&&$.extend(this,a),this.model||(this.model=new c),this.parent&&(this.model.parent=this.parent)},render:function(){var a,c={};return this.model.get("text")&&(c.text=this.model.get("text")),this.thanks&&(c.modal=!0),a=b.render(Templates[this.template],c),this.$el.html(a),this.$el.attr("tabindex","-1"),this.$el.attr("role","dialog"),this.$el.attr("aria-hidden","true"),this.model.get("text")&&this.$el.find("h3").remove(),this.$loadercontainer||(this.$loadercontainer=this.$el.find(".modal-footer")),this.loadListeners(this.model,["request","sync"]),this.trigger("rendered"),this},post:function(){var a=this.$el.find("textarea").val(),b=this.model.typestring;b&&this["post"+b](a)},postnotes:function(a){this.model.save({text:a},{patch:this.model.id?!0:!1,success:this.thanks?this.thankyou.bind(this):this.saved.bind(this)})},postmessages:function(a){var b={html:a,plaintext:a};this.model.set("body",b),this.model.save({body:this.model.get("body"),status:"draft"},{success:this.thanks?this.thankyou.bind(this):this.trigger.bind(this,"save:success")})},cancel:function(){this.trigger("edit:cancel"),this.persistent||(this.$el.find("button.close").click(),this.remove())},saved:function(){setTimeout(function(){this.trigger("save:success")}.bind(this),200)},thankyou:function(){var a=b.render(Templates.thankyou);setTimeout(function(){this.$el.addClass("thanks"),this.$el.find("section").html(a),setTimeout(function(){this.$el.modal("hide")}.bind(this),1e3),this.close&&setTimeout(function(){this.model="draft"==this.type?new d:new c,this.render()}.bind(this),2e3)}.bind(this),200),Cloudwalkers.RootView.trigger("added:note",this.model)},clean:function(){this.$el.find("textarea").val("")}});return e}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({views:[{name:"dashboard",title:"Dashboard",icon:"dashboard",authorized:0},{name:"inbox",title:"Inbox",icon:"inbox",authorized:0,children:[{name:"messages",title:"Messages",icon:"envelope",authorized:0},{name:"notifications",title:"Notifications",icon:"globe",authorized:0},{name:"post",title:"Post message",icon:"pencil",url:!1,authorized:0,attributes:{"data-header-action":"post"}},{name:"drafts",title:"Drafts",icon:"edit",url:"#drafts",authorized:0},{name:"scheduled",title:"Scheduled",icon:"time",url:"#drafts",authorized:0}]},{name:"coworkers",title:"Co-workers wall",icon:"group",authorized:0},{name:"profiles",title:"Company accounts",build:"profiles",icon:"briefcase",authorized:0,childicons:["briefcase","thumbs-up"]},{name:"news",title:"Profiles We Follow",build:"news",icon:"globe",authorized:0,childicons:["globe","thumbs-up"]},{name:"monitoring",title:"Keyword Monitoring",build:"monitoring",icon:"tags",authorized:0,childicons:["tags","plus"]},{name:"statistics",title:"Statistics",build:"statistics",icon:"bar-chart",authorized:0},{name:"settings",title:"Settings",icon:"cogs",url:"#settings/users",authorized:0,children:[{name:"users",title:"Manage users",icon:"group",authorized:0},{name:"networks",title:"Social Connections",icon:"cloud",authorized:0},{name:"post",title:"Post message",icon:"pencil",url:!1,authorized:0,attributes:{"data-header-action":"post"}},{name:"settings",title:"Account Settings",icon:"briefcase",url:"#settings/account",authorized:0},{name:"profile",title:"Profile settings",icon:"user",authorized:0}]}],events:{"click .notification-toggle":"toggleNotifications","click .btn-compose":"compose","click #writenote":"writenote"},initialize:function(){Cloudwalkers.Session.on("change:accounts",this.renderHeader,this),this.listenTo(Cloudwalkers.Session.getChannels(),"sync",this.render),this.listenTo(Cloudwalkers.Session.getChannels(),"remove",this.render)},headeraction:function(a){var b=$(a.currentTarget).data("header-action");"messages"==b&&Cloudwalkers.Router.navigate("#inbox/messages",!0),"contacts"==b&&Cloudwalkers.Router.navigate("#coworkers",!0),"post"==b&&Cloudwalkers.RootView.compose(),"writenote"==b&&this.writenote()},fit:function(){$("#header").html(this.renderHeader().header),$("#sidebar").html(this.render().el),$("#header, #sidebar").on("click","*[data-header-action]",this.headeraction.bind(this))},version:function(a){("TESTING"==a.platform.name||"DEVELOPMENT"==a.platform.name)&&(this.development=!0,$("#header").html(this.renderHeader().header))},renderHeader:function(){var a={dev:this.development};return a.user=Cloudwalkers.Session.user?Cloudwalkers.Session.user.attributes:null,a.accounts=[],(Cloudwalkers.Session.isAuthorized("USER_GRANT")||Cloudwalkers.Session.isAuthorized("GROUP_MANAGE"))&&(a.manage_user_groups=!0),Cloudwalkers.Session.user&&Cloudwalkers.Session.user.accounts.each(function(b){a.accounts.push({name:b.get("name"),id:b.id,active:b.id==Cloudwalkers.Session.get("currentAccount")})}),Cloudwalkers.Session.censuretemplate(a),this.header=b.render(Templates.header,a),this},render:function(){var a=Cloudwalkers.Session.user?Cloudwalkers.Session.user.account:null,c={reports:[]};return Cloudwalkers.Session.isAuthorized("MESSAGE_READ_THIRDPARTY")&&(c.news=this.rendernews(a)),Cloudwalkers.Session.isAuthorized("MESSAGE_READ_MONITORING")&&(c.monitoring=this.rendermonitoring(a)),Cloudwalkers.Session.isAuthorized("MESSAGE_READ_SCHEDULE")&&(c.scheduled=this.renderscheduled(a)),Cloudwalkers.Session.isAuthorized("_CW_INBOX_VIEW")&&(c.inbox=!0),Cloudwalkers.Session.isAuthorized("MESSAGE_READ_COMPANY")&&(c.profiles=this.renderprofiles(a)),Cloudwalkers.Session.isAuthorized("STATISTICS_VIEW")&&(c.statistics=!0),Cloudwalkers.Session.censuretemplate(c),this.$el.html(b.render(Templates.navigation,c)),this.handleSidebarMenu(),this},rendernews:function(a){var b=a.channels.findWhere({type:"news"});return b?b.id:void 0},rendermonitoring:function(a){var b=a.channels.findWhere({type:"monitoring"});for(var c in b.channels.models)if(b.channels.models[c].attributes.channels.length){this.first=b.channels.models[c];break}return b?{channelid:b.id,first:this.first,channels:b.channels.models,name:b.get("name")}:void 0},renderscheduled:function(a){var b={channelid:Cloudwalkers.Session.getChannel("internal").id,streams:a.streams.where({outgoing:1})};return b?b:void 0},renderprofiles:function(a){var b=a.channels.findWhere({type:"profiles"});return b?{channelid:b.id,streams:b.streams.models,name:b.get("name")}:void 0},handleSidebarMenu:function(){var b=a.history.fragment;return b?void this.setActive(b):null},compose:function(){Cloudwalkers.RootView.compose()},writenote:function(){var a=Cloudwalkers.Session.getAccount();Cloudwalkers.RootView.writeNote(a)},setActive:function(a){$("#sidebar .active").removeClass("active"),$('a[href="#'+a+'"]').parents("#sidebar .page-sidebar-menu *").addClass("active")},setNotifications:function(a){this.$el.find(".popup-frame ul").html("");for(var b=0;b<a.length;b++)this.addNotification(a[b])},addNotification:function(a){this.$el.find(".popup-frame ul").append('<li><div class="text account"><p>'+a.message+'</p><div class="row"><span class="time"></span></div></div></li>')},toggleNotifications:function(){this.$el.find(".notification-popup").toggle()},mapViews:function(){var a={};for(var b in this.views)if(a[this.views[b].name]={streams:[]},this.views[b].children)for(var c in this.views[b].children)a[this.views[b].children[c].name]={streams:[]};return a}});return c}),define(["Views/Pages/Pageview","mustache","Views/Root"],function(a,b){var c=a.extend({title:"First Time",events:{remove:"destroy","click [data-add-service]":"addServiceCall"},initialize:function(){Cloudwalkers.Session.getAccount()},render:function(){return Backbone.history.fragment="settings/services",$("#sidebar").addClass("collapsed"),$("#inner-content").addClass("expanded"),params={displayname:Cloudwalkers.Session.user.get("displayname")},this.$el.html(b.render(Templates.coworkerdashboard,params)),this},processLink:function(a){return a=a.indexOf("?")>0?a+"&return="+encodeURIComponent(window.location):a+"?return="+encodeURIComponent(window.location)},addServiceCall:function(a){a.preventDefault();var b=this,c=$(a.target).attr("data-add-service");this.addService(c,function(a){"undefined"!=typeof a.error?Cloudwalkers.RootView.alert(a.error.message):($.each(a.service.settings,function(a,c){if("link"==c.type){var d=b.processLink(c.url);window.location=d}}),b.render())})},destroy:function(){$("#sidebar, #inner-content").removeClass("collapsed expanded")}});return c}),define(["Views/Pages/Pageview","mustache","Views/Panels/Filters/BaseFilters","Views/Panels/EntryLists/BaseList"],function(a,b,c,d){var e=a.extend({title:"Co-workers wall",className:"container-fluid",id:"coworkers",initialize:function(){return this.model=Cloudwalkers.Session.getStream("coworkers"),this.model?(this.listenTo(this.model,"outdated",this.model.fetch),void this.listenTo(this.model,"sync",this.render)):Cloudwalkers.Session.home()},render:function(){this.$el.html(b.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#widgetcontainer").eq(0);var a=new c({model:this.model,template:"listfilters"});this.appendWidget(a,4);var e=new d({model:this.model,title:"Co-workers messages"});return this.appendWidget(e,8),a.list=e,this}});return e}),define(["Views/Pages/Pageview","mustache","Collections/Statistics","Views/Panels/Dashboard/MessagesCounters","Views/Panels/Dashboard/MiniMessageList","Views/Panels/Statistics/Info"],function(a,b,c,d,e,f){var g=a.extend({title:"Dashboard",statistics:[],widgets:[{widget:"messagescounters",type:"inbox",source:"streams",size:4,title:"Inbox",icon:"inbox",typelink:"#inbox",countString:"incomingUnread"},{widget:"messagescounters",type:"monitoring",source:"channels",size:4,title:"Keywords",icon:"tags",countString:"incoming"},{widget:"messagescounters",type:"outgoing",source:"streams",size:4,title:"Schedule",icon:"time",countString:"scheduled",link:"#scheduled"},{widget:"coworkers",type:"drafts",size:4,title:"Co-workers wall",color:"yellow",icon:"edit"},{widget:"trending",type:"profiles",size:4,title:"Trending Company Posts",color:"grey",icon:"thumbs-up"},{widget:"trending",type:"news",size:4,title:"Trending Accounts we follow",color:"red",icon:"thumbs-up"}],initialize:function(){this.collection=new c,this.listenTo(this.collection,"seed",this.filldynamicreports)},filldynamicreports:function(){var a=Cloudwalkers.Session.getStreams(),b=a.where({statistics:1});for(var c in b)this.fillstreamwidget(b[c].id)},fillstreamwidget:function(a){var b=Cloudwalkers.Session.getStream(a).get("network").token,c="facebook"==b?"Likes":"Followers",d=[{widget:"Info",data:{title:c,filterfunc:"followers"},span:3},{widget:"Info",data:{title:"Best time to post",filterfunc:"besttimetopost"},span:3}];for(var e in d)if("facebook"==b||"twitter"==b){d[e].data.network=a,d[e].data.parentview=this,d[e].data.footer=Cloudwalkers.Session.getStream(a).get("defaultname"),"besttimetopost"!=d[e].data.filterfunc&&(d[e].data.footer=d[e].data.footer+" "+c);var g=new f(d[e].data);this.statistics.push(g),this.appendWidget(g,d[e].span)}},render:function(){var a,c=this.widgets;this.$el.html(b.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#widgetcontainer").eq(0);for(var d in c){switch(c[d].widget){case"messagescounters":a=this.addMessagesCounters(c[d]);break;case"coworkers":a=this.addDashboardDrafts(c[d]);break;case"trending":a=this.addDashboardTrending(c[d])}a&&this.appendWidget(a,Number(c[d].size))}return this.collection.touch(this.filterparameters()),this},addMessagesCounters:function(a){var b=Cloudwalkers.Session.getChannel(a.type);if(b)return $.extend(a,{name:b.get("name"),open:1,channel:b}),new d(a)},addDashboardDrafts:function(a){return a.model=Cloudwalkers.Session.getStream("coworkers"),a.model?(a.link="#coworkers",new e(a)):void 0},addDashboardTrending:function(a){return a.trending=!0,a.model=Cloudwalkers.Session.getChannel(a.type),a.filters={sort:"engagement",since:3600*Math.round(Date.now()/36e5)-86400*a.since},a.model?new e(a):void 0},filterparameters:function(){return this.start=moment().zone(0).startOf("isoweek"),this.end=moment().zone(0).endOf("isoweek"),{since:this.start.unix(),until:this.end.unix()}}});return g}),define(["Views/Pages/Pageview","mustache","Views/Panels/Filters/BaseFilters","Views/Panels/EntryLists/BaseList"],function(a,b,c,d){var e=a.extend({title:"Drafts",className:"container-fluid",id:"drafts",initialize:function(){return this.model=Cloudwalkers.Session.getStream("draft"),this.model?void this.listenTo(this.model,"sync",this.render):Cloudwalkers.Session.home()},render:function(){this.$el.html(b.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#widgetcontainer").eq(0);var a=new c({model:this.model,template:"listfilters"});this.appendWidget(a,4);var e=new d({model:this.model,title:"Draft messages"});return this.appendWidget(e,8),a.list=e,this}});return e}),define(["backbone","mustache","Views/Pages/Pageview","Collections/Services"],function(a,b,c,d){var e=c.extend({title:"First Time",events:{remove:"destroy","click [data-add-service]":"addService","click #ready":"ready"},initialize:function(){this.services=new d,this.listenTo(this.services,"available:ready",this.appendOptions),this.services.fetchAvailable()},render:function(){return a.history.fragment="settings/services",$("#sidebar").addClass("collapsed"),$("#inner-content").addClass("expanded"),params={displayname:Cloudwalkers.Session.user.get("displayname")},this.$el.html(b.render(Templates.firsttime,params)),this},appendOptions:function(a,c){var d=this.$el.find(".networks-list");for(var e in c)d.append(b.render(Templates.service_option,c[e]))},processLink:function(a){return a=a.indexOf("?")>0?a+"&return="+encodeURIComponent(window.location.origin+"/#settings/services"):a+"?return="+encodeURIComponent(window.location.origin+"/#settings/services")},addService:function(a){var b=$(a.target).data("add-service");this.listenToOnce(this.services,"sync",function(a){var b=a.get("authenticateUrl");return b?void(window.location=this.processLink(b)):null}),this.services.create({},{wait:!0,endpoint:b})},ready:function(){Cloudwalkers.Session.getAccount().set("firstTime",0),Cloudwalkers.Router.navigate("#dashboard",!0)},destroy:function(){$("#sidebar, #inner-content").removeClass("collapsed expanded")}});return e}),define(["Views/Pages/Pageview","mustache","Views/Panels/EntryLists/BoxLists/InboxMessageList","Views/Panels/EntryLists/BoxLists/InboxNotificationList"],function(a,b,c,d){var e=a.extend({title:"Inbox",className:"container-fluid",id:"inbox",options:{},initialize:function(a){$.extend(this.options,a);var b=Cloudwalkers.Session.viewsettings(this.options.type);b.streams&&(this.options.filters={contacts:{string:"",list:[]},streams:b.streams})},render:function(){this.title="messages"==this.options.type?"Messages":"Notifications",this.$el.html(b.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#widgetcontainer").eq(0),this.options.channel.childtype=this.options.type.slice(0,-1);var a="messages"==this.options.type?new c(this.options):new d(this.options);return this.appendWidget(a,4),this.appendhtml(Templates.inboxcontainer),this.listenTo(Cloudwalkers.RootView,"resize",this.resize),this},resize:function(a){this.$el.find("#widgetcontainer").height(a-140)},finish:function(){this.resize(Cloudwalkers.RootView.height()),this.$el.find(".scroller").slimScroll({height:"inherit"})}});return e}),define(["Views/Pages/Pageview","mustache","Views/Panels/Filters/MonitorFilters","Views/Panels/EntryLists/MonitorList"],function(a,b,c,d){var e=a.extend({title:"Keyword monitoring",className:"container-fluid monitoring",options:{},initialize:function(a){return a&&$.extend(this.options,a),this.options.category?void(this.category=this.options.category):Cloudwalkers.Session.home()},render:function(){this.$el.html(b.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#widgetcontainer").eq(0);var a=new c({category:this.category});this.appendWidget(a,4);var e=new d({category:this.category,reset:!0});return this.appendWidget(e,8),a.list=e,this}});return e}),define(["Views/Pages/Pageview","mustache","Views/Root","Collections/Contacts","Views/Modals/Contact"],function(a,b,c,d,e){var f=a.extend({id:"manageaccounts",className:"container-fluid",title:"Manage Accounts",entries:[],events:{rendered:"bubblerender",remove:"destroy","search .input-large":"posturl","blur .input-large":"posturl","click *[data-network]":"filter","click .toggleall.active":"toggleall"},initialize:function(a){a&&$.extend(this,a),this.collection=new d([],{}),this.listenTo(this.collection,"seed",this.limited),this.listenTo(this.collection,"remove",this.limited),this.listenTo(this.collection,"add",this.addcontact),this.title=trans("Manage accounts")},render:function(){var a=this.channel.streams.filterNetworks(null,!0),c={networks:a};return c.title=this.title,this.$el.html(b.render(Templates.manageaccounts,c)),this.$container=this.$el.find(".contacts-list"),this.collection.touch(null,{records:200}),this},fill:function(a){this.incremental?this.incremental=!1:($.each(this.entries,function(a,b){b.remove()}),this.entries=[]);for(var b in a){var c=new e({model:a[b],parameters:{inboxview:!0}});this.entries.push(c),this.$container.append(c.render().el)}},addcontact:function(a){view=new e({model:a,parameters:{}}),this.entries.push(view),this.$container.prepend(view.render().el),this.$el.find(".fa-cloud-upload").toggleClass("fa-search fa-cloud-upload"),this.listenTo(a,"unfollow",function(a){this.collection.remove(a)})},posturl:function(a){var b=$(a.currentTarget);return b.val()?(this.collection.create({url:b.val(),following:!0},{wait:!0,error:this.postfailure.bind(this,b.val())}),this.$el.find(".url-post span").toggleClass("fa-search fa-cloud-upload"),this.listenToOnce(this.collection,"add",this.limited),void b.val("")):null},postfailure:function(a){this.$el.find(".fa-cloud-upload").toggleClass("fa-search fa-cloud-upload"),Cloudwalkers.RootView.information("Non-supported profile","This link is not recognized: "+a,this.$el.find(".info-container"))
},limited:function(){Cloudwalkers.Session.getAccount().monitorlimit("following",this.collection.models.length,$(".url-post, .url-post .input-large"))},filter:function(a,b){b||(b=this.button&&this.button.data("network")==$(a.currentTarget).data("network")),this.togglefilters(b),b||(this.button=$(a.currentTarget).addClass("active").removeClass("inactive"));var c=b?null:this.button.data("network");return b&&(this.button=!1),b||this.$el.find(".contacts-list li").not("."+c).addClass("hidden"),this.$el.find(".contacts-list li."+(c?c:"hidden")).removeClass("hidden"),this},togglefilters:function(a){this.$el.find("div[data-network]").addClass(a?"active":"inactive").removeClass(a?"inactive":"active"),this.$el.find(".toggleall").addClass(a?"inactive":"active").removeClass(a?"active":"inactive")},toggleall:function(){this.filter(!0),this.togglefilters(!0)}});return f}),define(["Views/Pages/Pageview","mustache","Views/Panels/Keywords/KeywordsEditor","Views/Panels/Keywords/KeywordsOverview"],function(a,b,c,d){var e=a.extend({title:"Manage Keywords",className:"container-fluid managekeywords",render:function(){var a,e,f=12;return setTimeout(this.limitlistener,50),this.listenTo(Cloudwalkers.Session.getChannels(),"sync remove",this.limitlistener),this.$el.html(b.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#widgetcontainer").eq(0),Cloudwalkers.Session.isAuthorized("CHANNEL_MANAGE_ADD_MONITORING")&&(a=new c,this.appendWidget(a,4),f=8),e=new d({editor:a}),this.appendWidget(e,f),this.widgets=[a,e],this},limitlistener:function(){var a=Cloudwalkers.Session.getChannel("monitoring").channels.reduce(function(a,b){return("number"==typeof a?a:a.get("channels").length)+b.get("channels").length});Cloudwalkers.Session.getAccount().monitorlimit("keywords",a,".add-keyword")}});return e}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({events:{click:"viewcontact"},initialize:function(a){$.extend(this,a)},render:function(){return this.$el.html(b.render(Templates.contactcard,this.contact)),this},viewcontact:function(){this.contact&&Cloudwalkers.RootView.viewContact({model:this.contact})}});return c}),define(["Views/Pages/Pageview","mustache","Views/Root","Views/Panels/EntryLists/BoxLists/InboxNotesList"],function(a,b,c,d){var e=a.extend({title:"Notes",className:"container-fluid",id:"notes",initialize:function(){this.model=Cloudwalkers.Session.getAccount()},render:function(){this.$el.html(b.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#widgetcontainer").eq(0);var a={check:"hasnotes",collectionstring:"notes",listtype:"notes",model:this.model},c=new d(a);return this.appendWidget(c,4),this.appendhtml(Templates.inboxcontainer),this},resize:function(a){this.$el.find("#widgetcontainer").height(a-140)},finish:function(){this.resize(Cloudwalkers.RootView.height()),this.$el.find(".scroller").slimScroll({height:"inherit"})}});return e}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({title:"Page",className:"container-fluid",span:0,widgets:[],widgetviews:[],events:{rendered:"bubblerender",remove:"destroy"},render:function(){return this.$el.html(b.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#widgetcontainer").eq(0),this.appendWidgets(),this},appendWidgets:function(){for(var a in this.widgets){var b=this.widgets[a].view(this.widgets[a].data);this.appendWidget(b,this.widgets[a].size)}},appendWidget:function(a,b,c,d){this.span&&0!==b||this.$container.append(Templates.row),this.span=b+this.span<12?b+this.span:0,a&&(this.$container.children().last().append(a.render().el),this.widgetviews.push(a),a.$el.addClass("col-md-"+b),d&&a.$el.addClass("col-md-offset-"+d),a.negotiateFunctionalities&&a.negotiateFunctionalities(),this.listenTo(a,"view:update",this.updatewidget.bind(this,a)))},appendhtml:function(a){this.$container.children().last().append(a)},cleanviews:function(){this.widgetviews.length&&(this.destroy(),this.widgetviews=[])},bubblerender:function(){this.trigger("rendered"),$.each(this.widgetviews,function(a,b){b.trigger("rendered")})},updatewidget:function(a){a.render(),a.negotiateFunctionalities&&a.negotiateFunctionalities()},destroy:function(){$.each(this.widgetviews,function(a,b){b.remove()})}});return c}),define(["Views/Pages/Pageview","mustache"],function(a,b){var c=a.extend({id:"rss",parameters:{records:20,markasread:!0},entries:[],events:{"click .message":"openMessage","click .message *":"openMessage","click [data-rss-select]":"toggleList"},initialize:function(a){a&&$.extend(this,a),this.title=trans("RSS Feed"),this.$el.addClass("loading")},hideloading:function(){this.$el.removeClass("loading"),this.$el.find(".timeline-loading").hide()},render:function(){var a={title:this.title};return this.$el.html(b.render(Templates.rssfeed,a)),this},openMessage:function(a){$(a.target).closest(".rssfeed-container").children().children().removeClass("opened"),$(a.target).closest(".rssfeed-container").children().removeClass("col-md-12"),$(a.target).closest(".rssfeed-container").children().addClass("col-md-6"),$(a.target).hasClass("message")?($(a.target).addClass("opened"),$(a.target).parent().removeClass("col-md-6"),$(a.target).parent().addClass("col-md-12")):($(a.target).closest(".message").addClass("opened"),$(a.target).closest(".message").parent().removeClass("col-md-6"),$(a.target).closest(".message").parent().addClass("col-md-12"))},toggleList:function(a){var b=$(a.target).data().rssSelect;this.$el.find(".rssfeed-container").removeClass("cards"),this.$el.find(".rssfeed-container").removeClass("list"),this.$el.find(".rssfeed-container").addClass(b),this.$el.find(".rssfeed-selector").children().removeClass("active"),$(a.target).hasClass("option")?$(a.target).addClass("active"):$(a.target).parent().addClass("active")}});return c}),define(["Views/WidgetContainer","Views/Widgets/Datepicker","Models/Report","Views/Panels/Statistics/CombinedStatistics"],function(a,b,c,d){var e=a.extend({navclass:"reports",title:"Report",id:"reports",datepicker:null,initializeWidgets:function(){if(this.title=this.title+" "+this.options.stream.get("customname"),this.datepicker=new b,"undefined"!=typeof this.options.stream&&this.options.stream)this.addStreamWidgets(this.options.stream);else for(var a=Cloudwalkers.Session.getStreams(),c=0;c<a.length;c++)a[c].get("statistics")&&this.addStreamWidgets(a[c])},addStreamWidgets:function(a){var b=this;$.ajax(Cloudwalkers.Session.api+"/streams/"+a.get("id")+"/statistics",{success:function(c){if(c.statistics.length>0){for(var d=[],e=[],f=0;f<c.statistics.length;f++)"time"==c.statistics[f].type?d.push(c.statistics[f]):e.push(c.statistics[f]);b.addCombinedWidget(a.attributes,d);for(var g=0;g<e.length;g++)b.addReportWidget(a.attributes,e[g])}},beforeSend:function(a){a.setRequestHeader("Accept","application/json"),a.setRequestHeader("Authorization","Bearer "+Cloudwalkers.Session.authenticationtoken)}})},addCombinedWidget:function(a,b){function e(d){var e;b[g].stream=a,e=new c(d),f.push(e)}for(var f=[],g=0;g<b.length;g++)e(b[g]);var h=new d({reports:f,stream:a});h.color=a.network.icon+"-color",h.network=a.network,this.add(h)},addReportWidget:function(a,b){var d=this;b.stream=a;var e=new c(b),f=e.getWidget(),g=d.datepicker.getDateRange();e.setDateRange(g[0],g[1]),f.color=a.network.icon+"-color",f.network=a.network,f.showLink=!1,f.showStreamName=!1,d.datepicker.on("date:change",function(a,b){f.getDataset().setDateRange(a,b)}),this.add(f)}});return e}),define(["Views/Pages/Pageview","mustache","Views/Panels/Filters/ScheduledFilters","Views/Panels/EntryLists/ScheduledList"],function(a,b,c,d){var e=a.extend({title:"Schedule",className:"container-fluid scheduled",options:{},initialize:function(a){if($.extend(this.options,a),this.model=Cloudwalkers.Session.getStream("scheduled"),!this.model)return Cloudwalkers.Session.home();var b=Cloudwalkers.Session.viewsettings("scheduled");b.streams&&(this.options.filters={streams:b.streams}),this.listenTo(this.model,"sync",this.render)},render:function(){this.$el.html(b.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#widgetcontainer").eq(0);var a=new c({model:this.model,filters:this.options.filters});this.appendWidget(a,4);var e=new d({model:this.model,filters:this.options.filters});return this.appendWidget(e,8),a.list=e,this}});return e}),define(["Views/Pages/Pageview","mustache","Views/Panels/EntryLists/BoxLists/SentMessageList"],function(a,b,c){var d=a.extend({title:"Sent",className:"container-fluid inbox",initialize:function(){this.model=Cloudwalkers.Session.getStream("sent");var a=Cloudwalkers.Session.viewsettings("sent");a.streams&&(this.options.filters={contacts:{string:"",list:[]},streams:a.streams})},render:function(){this.$el.html(b.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#widgetcontainer").eq(0),this.options.model=this.model;var a=new c(this.options);return this.appendWidget(a,4),this.appendhtml(Templates.inboxcontainer),this},resize:function(a){this.$el.find("#widgetcontainer").height(a-140)},finish:function(){this.resize(Cloudwalkers.RootView.height()),$message=this.$el.find(".inbox-container").wrap("<div class='scroller'>"),$message.parent().slimScroll({height:"inherit"})}});return d}),define(["Views/Pages/Pageview","mustache","Views/Settings/Services","Views/Settings/Users","Views/Settings/Account","Views/Settings/Profile"],function(a,b,c,d,e,f){var g=a.extend({title:"Settings",id:"settings",tabs:[],initialize:function(a){$.extend(this,a)},setAction:function(a){this.action=a},render:function(){var a;switch(this.tabs=[],Cloudwalkers.Session.isAuthorized("USER_INVITE")&&this.tabs.push({url:"#settings/users",name:"Manage users"}),Cloudwalkers.Session.isAuthorized("SERVICE_CONNECT")&&this.tabs.push({url:"#settings/services",name:"Social connections"}),Cloudwalkers.Session.isAuthorized("CAMPAIGN_DELETE")&&this.tabs.push({url:"#settings/account",name:"Account settings"}),this.tabs.push({url:"#settings/profile",name:"Profile settings"}),this.$el.html(b.render(Templates.tabview,{title:trans(this.title),tabs:this.tabs})),this.$container=this.$el.find("#widgetcontainer").eq(0),this.$el.find('.nav-tabs a[href="#settings/'+this.endpoint+'"]').parent().addClass("active"),this.endpoint){case"users":a=new d;break;case"services":a=new c({serviceid:this.serviceid});break;case"account":a=new e;break;default:a=new f}return this.appendWidget(a,12),this}});return g}),define(["Views/Pages/Statistics"],function(a){var b=a.extend({widgets:[{widget:"StatSummary",data:{columnviews:["contacts-network","score-trending-network","outgoing-network","besttime"]},span:12},{widget:"TitleSeparator",data:{title:"Contacts Info"}},{widget:"Chart",data:{filterfunc:"contact-evolution-network",chart:"LineChart",title:"Contacts evolution"},span:6},{widget:"Chart",data:{filterfunc:"age",chart:"PieChart",title:"By Age"},span:3,networks:["facebook"]},{widget:"Chart",data:{filterfunc:"gender",chart:"PieChart",title:"By gender"},span:3,networks:["facebook"]},{widget:"Chart",data:{filterfunc:"follow",chart:"PieChart",title:"By Type"},span:3,networks:["twitter","linkedin","youtube"]},{widget:"Info",data:{title:"New impressions",filterfunc:"page-views-network"},span:3,nonetworks:["twitter"]},{widget:"Info",data:{title:"New shares",filterfunc:"shares"},span:3,nonetworks:["twitter"]},{widget:"Info",data:{title:"New posts",filterfunc:"posts"},span:3,nonetworks:["twitter"]},{widget:"Info",data:{title:"New direct messages",filterfunc:"dms"},span:3,nonetworks:["twitter"]},{widget:"Info",data:{title:"New shares",filterfunc:"shares"},span:4,networks:["twitter"]},{widget:"Info",data:{title:"New posts",filterfunc:"posts"},span:4,networks:["twitter"]},{widget:"Info",data:{title:"New direct messages",filterfunc:"dms"},span:4,networks:["twitter"]},{widget:"TitleSeparator",data:{title:"Messages info"}},{widget:"TrendingMessage",data:{title:"Top rated comment"},span:12},{widget:"BestTimeToPost",data:{filterfunc:"besttime",chart:"LineChart",title:"Best Time to Post"},span:4},{widget:"Chart",data:{filterfunc:"message-evolution-network",chart:"LineChart",title:"Messages Evolution"},span:4},{widget:"HeatCalendar",data:{filterfunc:"activity",title:"Activity Calendar"},span:4},{widget:"TitleSeparator",data:{title:"Geo Graphics"},networks:["facebook"]},{widget:"Chart",data:{filterfunc:"geo",type:"dots",chart:"GeoChart",title:"Countries",connect:!0},networks:["facebook"],span:8},{widget:"CompoundChart",span:4,data:{template:"2row",chartdata:[{widget:"Chart",data:{filterfunc:"regional",chart:"PieChart",title:"Countries"},connect:"regional"},{widget:"Chart",data:{filterfunc:"cities",chart:"PieChart",title:"Cities"}}]},networks:["facebook"]}],streamdata:function(a){var b=Cloudwalkers.Session.getStream(Number(this.streamid)).get("network").token,c={};return a.networks&&a.networks.indexOf(b)<0?!1:a.nonetworks&&a.nonetworks.indexOf(b)>=0?!1:(c.network=this.streamid,_.extend(a.data,c))}});return b}),define(["Views/Pages/Pageview","mustache","Collections/Statistics","Views/Panels/Statistics/EmptyStatisticsData","Views/Panels/Statistics/StatSummary","Views/Panels/Statistics/TitleSeparator","Views/Panels/Statistics/Chart","Views/Panels/Statistics/CompoundChart","Views/Panels/Statistics/Info","Views/Panels/Statistics/TrendingMessage","Views/Panels/Statistics/BestTimeToPost","Views/Panels/Statistics/HeatCalendar","goog!visualization,1,packages:[corechart,geochart]","goog!search,1"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=a.extend({id:"statistics",start:0,end:0,timespan:"default",period:0,custom:!1,views:[],events:{remove:"destroy","click #add":"addperiod","click #subtract":"subtractperiod","click #subtractempty":"subtractempty","click #addempty":"addempty","click #showreports":"showreports","click #now":"now","click #show":"changecustom","change .stats-header select.networks":"changestream","change .stats-header select.time":"changespan","click .dashboard-stat":"updatenetwork"},widgets:[{widget:"StatSummary",data:{columnviews:["contacts","score-trending","outgoing","coworkers"]},span:12},{widget:"TitleSeparator",data:{title:"Contacts Info"}},{widget:"Chart",data:{filterfunc:"contacts",chart:"PieChart",title:"Contacts",display:"divided"},span:6},{widget:"CompoundChart",span:6,data:{template:"2col1row",chartdata:[{widget:"Chart",data:{filterfunc:"age",chart:"PieChart",title:"By Age"}},{widget:"Chart",data:{filterfunc:"gender",chart:"PieChart",title:"By Gender"}},{widget:"Chart",data:{filterfunc:"contact-evolution",chart:"LineChart",title:"Contacts evolution"}}]}},{widget:"TitleSeparator",data:{title:"New this"}},{widget:"Info",data:{title:"Contact Evolution",filterfunc:"contact-evolution"},span:3},{widget:"Info",data:{title:"Post Activity",filterfunc:"post-activity"},span:3},{widget:"Info",data:{title:"Activity?",filterfunc:"activity"},span:3},{widget:"Info",data:{title:"Page Views?",filterfunc:"page-views"},span:3},{widget:"TitleSeparator",data:{title:"Messages info"}},{widget:"TrendingMessage",data:{title:"Top rated comment"},span:12},{widget:"BestTimeToPost",data:{filterfunc:"besttime",chart:"LineChart",title:"Best time to post"},span:4},{widget:"Chart",data:{filterfunc:"message-evolution",chart:"LineChart",title:"Messages evolution"},span:4},{widget:"HeatCalendar",data:{filterfunc:"activity",title:"Activity calendar"},span:4},{widget:"TitleSeparator",data:{title:"Geo Graphics"}},{widget:"Chart",data:{filterfunc:"geo",type:"dots",chart:"GeoChart",title:"Countries"},span:8},{widget:"CompoundChart",span:4,data:{template:"2row",chartdata:[{widget:"Chart",data:{filterfunc:"regional",chart:"PieChart",title:"Countries"}},{widget:"Chart",data:{filterfunc:"cities",chart:"PieChart",title:"Cities"}}]}}],initialize:function(a){a&&$.extend(this,a),this.collection=new c,this.listenTo(this.collection,"request",this.showloading),this.listenTo(this.collection,"seed",this.fillcharts),this.listenTo(this.collection,"sync:data",this.hideloading),this.listenTo(this.collection,"sync:noresults",this.showempty),this.streamid=parseInt(this.streamid)},render:function(){var a=this.timemanager();return a.streams=Cloudwalkers.Session.getStreams().where({statistics:1}).map(function(a){return a.attributes.selected=a.id==this.streamid,a.attributes}.bind(this)),this.$el.html(b.render(Templates.statsview,a)),this.$container=this.$el.find("#widgetcontainer").eq(0),this.$el.find("select").chosen({width:"200px",disable_search_threshold:10,inherit_select_classes:!0}),"custom"==this.timespan&&this.$el.find("#start, #end").datepicker({format:"dd-mm-yyyy"}),0===this.period&&this.$el.find("#add").attr("disabled",!0),google.load("visualization","1",{callback:this.request.bind(this),packages:["corechart"]}),this},writeui:function(){var a=this.timemanager();this.$el.find(".stats-header-timeview").eq(0).html("<strong>"+a.fullperiod+": </strong>"+a.timeview)},request:function(a){a&&"default"==this.timespan&&(this.timespan="week"),this.writeui(),this.collection.touch(this.filterparameters()),this.currentperiod=a},fillcharts:function(a){var b={Chart:g,StatSummary:e,TitleSeparator:f,CompoundChart:h,Info:i,TrendingMessage:j,BestTimeToPost:k,HeatCalendar:l};return a&&!a.length?this.showempty():(this.cleanviews(),void this.widgets.forEach(function(a){if(this.streamid&&this.streamdata(a))a.data=this.streamdata(a);else if(this.streamid)return;a.data.parentview=this,a.data.timespan={since:this.start.unix(),to:this.end.unix()};var c=new b[a.widget](a.data);this.views.push(c),this.appendWidget(c,a.span)}.bind(this)))},timemanager:function(){var a=this.filterparameters(),b=moment.unix(a.since).zone(0),c=b.date()>24||"quarter"==a.span?11==b.month()?"DD MMM YYYY":"DD MMM":"DD";return"default"==this.timespan?(a.periodstring="Last 7 days",a.span=""):a.periodstring=this.period||"custom"==a.span?-1==this.period?"last ":"":"this ",a.timeview=b.format(c)+" - "+moment.unix(a.until).zone(0).format("DD MMM YYYY"),a[a.span+"Active"]=!0,a.startstring=moment.unix(a.since).zone(0).format("DD-MM-YYYY"),a.endstring=moment.unix(a.until).zone(0).format("DD-MM-YYYY"),a.fullperiod="pt_PT"==Cloudwalkers.Session.user.attributes.locale?trans(a.span)+" "+trans(a.periodstring):trans(a.periodstring)+" "+trans(a.span),a},showloading:function(){this.$el.addClass("loading")},hideloading:function(){this.$el.removeClass("loading"),this.$el.find(".period-buttons .btn").attr("disabled",!1),this.$el.find("select").prop("disabled",!1).trigger("chosen:updated"),this.listenToOnce(this,"change:period",this.request),this.currentperiod&&(this.period=this.currentperiod)},showempty:function(){this.cleanviews(),this.hideloading();var a=new d({timeparams:this.timeparams,stream:this.streamid});this.views.push(a),this.appendWidget(a,8,null,2)},now:function(){this.period=0,this.trigger("change:period",this.period)},addperiod:function(a){var b=$(a.target).attr("disabled");this.period>=0||"disabled"==b||(this.period+=1,this.trigger("change:period",this.period))},subtractperiod:function(a){var b=$(a.target).attr("disabled");"disabled"!=b&&(this.period-=1,this.trigger("change:period",this.period))},subtractempty:function(){this.period-=1,this.trigger("change:period",this.period)},addempty:function(){this.period+=1,this.trigger("change:period",this.period)},showreports:function(){var a=Number(this.$el.find("select.networks").val());a||(a=Cloudwalkers.Session.getStreams().where({statistics:1})[0].id),Cloudwalkers.Router.navigate(a?"#reports/"+a:"#reports",{trigger:!0})},changestream:function(){var a=Number(this.$el.find("select.networks").val());Cloudwalkers.Router.navigate(a?"#statistics/"+a:"#statistics",{trigger:!0})},changespan:function(){var a=this.$el.find("select.time").val();this.timespan=a,this.trigger("change:period")},changecustom:function(){this.start=moment(this.$el.find("#start").val(),"DD-MM-YYYY"),this.end=moment(this.$el.find("#end").val(),"DD-MM-YYYY"),this.trigger("change:period")},filterparameters:function(){if("default"==this.timespan&&(this.start=moment().subtract(7,"days").zone(0).endOf("day"),this.end=moment().zone(0).endOf("day")),"now"==this.timespan&&(this.period=0),"week"==this.timespan&&(this.start=moment().zone(0).startOf("isoweek"),this.end=moment().zone(0).endOf("isoweek")),"month"==this.timespan&&(this.start=moment().zone(0).startOf("month"),this.end=moment().zone(0).endOf("month")),"year"==this.timespan&&(this.start=moment().zone(0).startOf("year"),this.end=moment().zone(0).endOf("year")),"quarter"==this.timespan){var a=3*(this.period+moment().quarter());this.start=moment().startOf("year").add("months",a-3),this.end=moment().startOf("year").add("months",a-1).endOf("month")}else"custom"!=this.timespan&&(this.period>0&&(this.start.add(this.timespan+"s",this.period),this.end.add(this.timespan+"s",this.period)),this.period<0&&(this.start.subtract(this.timespan+"s",Math.abs(this.period)),this.end.subtract(this.timespan+"s",Math.abs(this.period))));return 0!==this.period?this.$el.find("#now").eq(0).removeClass("hidden"):this.$el.find("#now").eq(0).addClass("hidden"),this.timeparams={since:this.start.unix(),until:this.end.unix(),span:this.timespan},{since:this.start.unix(),until:this.end.unix(),span:this.timespan,period:this.period,reset:!0}},finish:function(){},updatenetwork:function(a){a.currentTarget.dataset.report}});return m}),define(["Views/Pages/Pageview","mustache","Views/Root","Collections/Contacts","Views/Entries/MessageEntry","Models/Contact"],function(a,b,c,d,e){var f=a.extend({id:"timeline",parameters:{records:20,markasread:!0},entries:[],check:"hasMessages",filters:{streams:[]},events:{"click *[data-action]":"action","click [data-toggle]":"togglefilter","click [data-streams]":"filterstreams","click .load-more .more":"more","click .load-more .timeline-icon":"more","click [data-networks]":"filternetworks","click .toggleall.networks.active":"toggleallnetworks","click .toggleall.active":"toggleall"},initialize:function(a){a&&$.extend(this,a),this.collection=this.model.messages,this.$el.addClass("loading"),this.listenTo(this.collection,"seed",this.fill);var b=Cloudwalkers.Session.viewsettings(this.model.get("type"));b.streams&&(this.filters={streams:b.streams})},hideloading:function(){this.$el.removeClass("loading"),this.$el.find(".timeline-loading.timeline-blue").hide(),this.$el.find(".load-more .timeline-icon").removeClass("entry-loading"),this.$el.find(".load-more .timeline-body span").html(trans("View more"))},toggleall:function(){this.filternetworks(null,!0),this.togglestreams(!0),this.$el.find("[id^=filter_]").slideUp("fast"),this.$el.find("[data-toggle=streams]").removeClass("selected")},render:function(){var a={streams:[],networks:[]};return"news"==this.model.get("type")?this.rendernews(a):this.rendercompany(a),this.$el.html(b.render(Templates.timeline,a)),this.filters.streams.length&&(this.$el.find("[data-streams], [data-networks], .toggleall").toggleClass("inactive active"),this.$el.find(this.filters.streams.map(function(a){return'[data-networks~="'+a+'"],[data-streams="'+a+'"]'}).join(",")).toggleClass("inactive active")),this.reload(a),this.resize(Cloudwalkers.RootView.height()),this},rendernews:function(a){this.timelinetype="news",this.contacts=new d([],{}),this.listenTo(this.contacts,"sync",this.fillcontacts.bind(this,a)),this.contacts.touch(null,{records:200})},rendercompany:function(a){this.timelinetype="company",this.model.streams.each(function(b){b.get(this.check)&&a.streams.push({id:b.id,icon:b.get("network").icon,name:b.get("defaultname"),network:b.get("network")})}.bind(this)),a.networks=this.model.streams.filterNetworks(a.streams,!0)},reload:function(a){this.reloadui(a),this.collection.touch(this.model,this.filterparameters())},reloadui:function(){this.$el.addClass("loading"),this.$el.find("ul.messages-container").empty().html(b.render(Templates.timelinemessagelist)),"news"!=this.timelinetype||this.newsloaded||this.$el.find(".filter-bg").addClass("loading"),this.$container=this.$el.find("ul.timeline").eq(0),this.$loadmore=this.$el.find(".load-more").remove(),this.$nocontent=this.$el.find(".no-content").remove()},fillcontacts:function(a,c){var d=c.models,e=[];for(var f in d)d[f].loaded()&&(e.push({id:d[f].id,icon:d[f].get("network").icon,name:d[f].get("defaultname"),network:d[f].get("network")}),this.$el.find("#filter_streams ul").append(b.render(Templates.filterstream,d[f].attributes)));a.streams=e,a.networks=this.model.streams.filterNetworks(a.streams,!0);for(var g in a.networks){var h='<div class="btn-white filter" data-networks="'+a.networks[g].ids+'"><i class="fa fa-'+a.networks[g].icon+'"></i></div>';this.$el.find(".caption").after(h)}this.$el.find(".filter-bg .loadingafter").remove(),this.newsloaded=!0,this.filters.streams.length&&(this.$el.find("[data-streams], [data-networks], .toggleall").toggleClass("inactive active"),this.$el.find(this.filters.streams.map(function(a){return'[data-networks~="'+a+'"],[data-streams="'+a+'"]'}).join(",")).toggleClass("inactive active"))},filternetworks:function(a,b){b||(b=this.button&&this.button.data("networks")==$(a.currentTarget).data("networks")),this.togglestreams(b),b||(this.button=$(a.currentTarget).addClass("active").removeClass("inactive"));var c=b?null:String(this.button.data("networks")).split(" ");return b&&(this.button=!1),c?($(c.map(function(a){return'[data-streams="'+a+'"]'}).join(",")).removeClass("inactive").addClass("active"),this.filters.streams=c):this.filters.streams=[],this.reload(),this.storeview(),this},filterstreams:function(a,b){b||(b=this.button&&this.button.data("streams")==$(a.currentTarget).data("streams")),this.togglestreams(b),b||(this.button=$(a.currentTarget).addClass("active").removeClass("inactive"));var c=b?null:Number(this.button.data("streams"));return b&&(this.button=!1),c?($('[data-networks~="'+c+'"]').removeClass("inactive").addClass("active"),this.filters.streams=[c]):this.filters.streams=[],this.reload(),this.storeview(),this},filterparameters:function(){var a={},b="news"==this.timelinetype?"contacts":"streams";return $.extend(!0,a,this.parameters),a[b]=this.filters.streams.length?this.filters.streams.join(","):[],a},togglefilter:function(a){var b=$(a.currentTarget),c=b.data("toggle"),d=b.hasClass("selected");this.$el.find("[data-toggle].selected").removeClass("selected"),this.$el.find("[id^=filter_]").slideUp("fast"),d||(b.addClass("selected"),this.$el.find("#filter_"+c).slideDown("fast"))},fill:function(a){a.models&&(a=a.models),this.incremental?this.incremental=!1:($.each(this.entries,function(a,b){b.remove()}),this.entries=[]);for(var b in a){a[b].attributes.showcontact=this.showcontact;var c=new e({model:a[b],template:"messagetimeline",parameters:{trendview:this.trending}});this.entries.push(c),this.$container.append(c.render().el)}this.collection.cursor?this.$container.append(this.$loadmore):a.length?this.$loadmore.remove():this.$container.append(this.$nocontent),this.hideloading()},toggleallnetworks:function(){this.filternetworks(null,!0)},togglefilters:function(a){a=a.join(" "),this.$el.find("[data-network-streams]").removeClass("inactive"),this.$el.find("[data-network-streams='"+a+"']").addClass("inactive"),this.$el.find(".toggleall").addClass("inactive")},togglestreams:function(a){this.$el.find("[data-networks], [data-streams]").addClass(a?"active":"inactive").removeClass(a?"inactive":"active"),this.$el.find(".toggleall").addClass(a?"inactive":"active").removeClass(a?"active":"inactive")},storeview:function(){var a=Cloudwalkers.Session.viewsettings(this.model.get("type"));a&&(a.streams||(a.streams=[]),JSON.stringify(a.streams)!=JSON.stringify(this.filters.streams)&&(a.streams=this.filters.streams,Cloudwalkers.Session.viewsettings(this.model.get("type"),a)))},more:function(){this.incremental=!0,this.$el.find(".load-more .timeline-icon").addClass("entry-loading"),this.$el.find(".load-more .timeline-body span").html(trans("Loading")+"...");var a=this.collection.more(this.model,this.filterparameters());a||this.$el.find(".load-more").hide()},resize:function(a){this.$el.css("min-height",a)}});return f}),define(["Views/Pages/Pageview","mustache"],function(a,b){var c=a.extend({initialize:function(a){a&&$.extend(this,a),this.listenTo(this.model.streams,"seed",this.fill),this.listenTo(this.model.streams,"request",this.showloading),this.listenTo(this.model.streams,"sync",this.hideloading)},render:function(){var a={streams:[],networks:this.model.streams.filterNetworks(null,!0)};return this.model.streams.each(function(b){a.streams.push({id:b.id,icon:b.get("network").icon,name:b.get("defaultname")})}),this.$el.html(b.render(Templates.trending,a)),this.collection.touch(this.model,{records:40,sort:"engagement",since:3600*Math.round(Date.now()/36e5)-86400*this.span}),this}});return c}),define(["Views/Panels/Panel","mustache","Views/Entries/CounterEntry"],function(a,b,c){var d=a.extend({entries:[],events:{"click a[href]":"updatesettings","click .panel-heading":"togglecollapse"},initialize:function(a){console.log(this.events),this.options=$.extend({},this.options,a),this.collection=this.options.channel[a.source],"outgoing"==this.options.channel.get("type")&&this.listenTo(Cloudwalkers.RootView,"added:message",this.addedmessage.bind(this))},addedmessage:function(a){a.get("schedule")&&a.get("schedule").date&&this.updatecollection()},render:function(){return this.$el.html(b.render(Templates.messagescounters,this.options)),this.$container=this.$el.find("ul.entry-container.messages-list").eq(0),this.fill(this.collection),this.updatecollection(),this},fill:function(a){this.$container.empty();for(var b in a.models){var d=new c({model:a.models[b],data:this.options});this.$container.append(d.render().el)}},updatecollection:function(){this.listenToOnce(this.collection,"sync",this.fill),"streams"==this.options.source&&(this.options.channel.endpoint="/streams",this.collection.url=this.options.channel.url(),this.collection.fetch({remove:!1}))},updatesettings:function(a){if("streams"!=this.options.source&&"outgoing"!=this.options.source)return null;var b=this.collection.get($(a.currentTarget).data("stream")),c=b.get("childtypes")[0]+"s";"outgoing"==this.options.channel.get("type")&&(c="scheduled");var d=Cloudwalkers.Session.viewsettings(c);d.streams=[b.id],Cloudwalkers.Session.viewsettings(c,d)},negotiateFunctionalities:function(){this.$el.find(".scroller").length&&this.addScroll(),this.appendCounter(),"undefined"!=typeof this.options.open&&this.appendCollapseble(this.options.open)}});return d}),define(["Views/Panels/Panel","mustache","Collections/Messages","Views/Entries/BaseEntry"],function(a,b,c,d){return DashboardMessageList=a.extend({entries:[],type:"minilist",options:{},initialize:function(a){this.options=$.extend({},this.options,a),this.model.messages=new c,this.listenTo(this.model.messages,"seed",this.fill),this.loadListeners(this.model.messages,["request","sync","ready"],!0),this.initializeWidget()},render:function(){return this.$el.html(b.render(Templates.minimessagelist,this.options)),this.$container=this.$el.find(".entry-container"),this.$loadercontainer=this.$el.find(".panel-body"),this.model.messages.touch(this.model,this.filters),this.trigger("rendered"),this},fill:function(a){this.$el.find(".inner-loading").toggleClass(a.length?"inner-loading":"inner-empty inner-loading"),$.each(this.entries,function(a,b){b.remove()}),this.entries=[];for(var b in a){this.link&&(a[b].link=this.link);var c=new d({model:a[b],template:"smallentry",parameters:{trendview:this.trending,mediaview:!this.trending}});this.entries.push(c),this.$container.append(c.render().el),this.listenTo(c,"toggle",this.toggle)}},toggle:function(){var a=this.sublink?this.sublink+this.model.id:this.link;Cloudwalkers.Router.navigate(a,!0)},fail:function(){Cloudwalkers.RootView.growl("Oops","Something went sideways, please reload the page.")}})}),define(["Views/Panels/Panel","mustache","Views/Entries/BaseEntry","Views/Panels/LoadMore"],function(a,b,c,d){var e=a.extend({title:"List messages",entries:[],type:"list",events:{remove:"destroy","click .load-more":"more"},options:{},initialize:function(a){a&&$.extend(this,a),this.model.messages||(this.model.messages=new Messages),this.listenTo(this.model.messages,"seed",this.fill),this.listenTo(this.model.messages,"request",this.showloading),this.listenTo(this.model.messages,"ready",this.showmore),this.listenTo(this.model.messages,"destroy",this.showmore),this.listenTo(this.model.messages,"loaded",this.hideloading),this.listenTo(this.model.messages,"update:content",this.loadmylisteners),this.listenTo(Cloudwalkers.RootView,"added:message",function(){this.model.messages.touch(this.model,this.parameters)
}.bind(this))},render:function(a){var c={title:this.title};this.parameters={records:20},this.loadmylisteners(),this.$el.html(b.render(Templates.baselist,c)),this.$container=this.$el.find(".entry-container"),this.$loadercontainer=this.$el.find(".panel-body"),this.loadListeners(this.model.messages,["request","sync","ready"],!0),a&&(this.parameters=a),this.model.messages.touch(this.model,this.parameters),this.addScroll();var d=this.$el.find(".slimScrollDiv").eq(0),e=d.css("height");return d.css("max-height",e),d.css("height","inherit"),this},fill:function(a){this.incremental?this.incremental=!1:($.each(this.entries,function(a,b){b.remove()}),this.entries=[]);for(var b in a){var d=new c({model:a[b],template:"fullentry"});this.entries.push(d),a[b].get("from")?this.model.seedusers(a[b]):this.listenTo(a[b],"change:from",this.model.seedusers.bind(this.model)),this.$container.append(d.render().el)}this.checkmore()},loadmylisteners:function(){this.loadListeners(this.model.messages,["request","sync",["ready","destroy"]],!0)},showloading:function(){this.$el.find(".fa-cloud-download").show()},hideloading:function(){this.$el.find(".fa-cloud-download").hide()},checkmore:function(){this.hasmore=this.model.messages.cursor?!0:!1},showmore:function(){setTimeout(function(){if(this.$container.css("max-height",999999),!this.hasmore)return this.$el.find("#loadmore").empty();var a=new d({list:this.model.messages,parentcontainer:this.$container});this.$el.find("#loadmore").html(a.render().el),this.loadmore=a}.bind(this),200)},more:function(){this.incremental=!0,this.loadmore.loadmylisteners();var a=this.model.messages.more(this.model,this.parameters);a||this.$el.find(".load-more").hide()},negotiateFunctionalities:function(){this.listenTo(Cloudwalkers.Session,"destroy:view",this.remove)},destroy:function(){$.each(this.entries,function(a,b){b.remove()})}});return e}),define(["Views/Panels/Panel","mustache","Views/Entries/BaseEntry","Views/Entries/InboxMessage","Views/Panels/LoadMore"],function(a,b,c,d,e){var f=a.extend({className:"slimlist-container",entries:[],check:"hasMessages",collectionstring:"messages",filters:{contacts:{string:"",list:[]},streams:[]},templates:{messages:"smallentry",notes:"subentrynote",notifications:"smallentry"},events:{remove:"destroy","click [data-toggle]":"togglefilter","input .input-rounded":"comparesuggestions","click [data-contact]":"filtercontacts","click [data-close-contact]":"filtercontacts","click [data-networks]":"filternetworks","click [data-streams]":"filterstreams","click .toggleall.active":"toggleall","click .load-more":"more"},options:{},initialize:function(a){a&&($.extend(this,a),$.extend(this.options,a)),a.model&&(this.model=a.model),this.model||(this.model=this.options.channel),this.collection=this.model[this.collectionstring],this.loadmylisteners(),this.updateable(this.model,"h3.page-title")},loadmylisteners:function(a){a&&this.stopListening(this.collection),this.$el.find("#loadmore").empty(),this.listenTo(this.collection,"seed",this.fill),this.listenTo(this.collection,"request",this.showloading),this.listenTo(this.collection,"sync",this.hideloading),this.listenTo(this.collection,"ready",this.showmore),this.listenTo(this.model.contacts,"add",this.comparesuggestions),this.listenTo(this.collection,"ready:empty",this.isempty),this.listenTo(this.collection,"request",this.unsetempty),this.listenTo(Cloudwalkers.RootView,"added:note",function(){this.collection.touch(this.model,this.filterparameters())}.bind(this)),this.loadListeners(this.collection,["request","sync",["ready","loaded"]],!0)},toggleall:function(){this.filternetworks(null,!0),this.togglestreams(!0)},togglestreams:function(a){this.$el.find("[data-networks], [data-streams]").addClass(a?"active":"inactive").removeClass(a?"inactive":"active"),this.$el.find(".toggleall").addClass(a?"inactive":"active").removeClass(a?"active":"inactive")},render:function(){var a={streams:[],networks:[]};return this.model.streams.each(function(b){b.get(this.check)&&a.streams.push({id:b.id,icon:b.get("network").icon,name:b.get("defaultname"),network:b.get("network")})}.bind(this)),a.networks=this.model.streams.filterNetworks(a.streams,!0),a.note=this.listtype?!0:!1,this.$el.html(b.render(Templates.slimlist,a)),this.filters.streams.length&&(this.$el.find("[data-streams], [data-networks], .toggleall").toggleClass("inactive active"),this.$el.find(this.filters.streams.map(function(a){return'[data-networks~="'+a+'"],[data-streams="'+a+'"]'}).join(",")).toggleClass("inactive active")),this.$container=this.$el.find("ul.entry-container"),this.collection.touch(this.model,this.filterparameters()),this},showloading:function(a){a.hasOwnProperty("length")&&(this.$el.find(".inbox").addClass("loading"),this.$el.find(".load-more").hide())},hideloading:function(a,b){this.hasmore=a.cursor&&b[a.parenttype][this.collectionstring].length?!0:!1,this.$el.find(".inbox").removeClass("loading"),this.$container.removeClass("inner-loading")},showmore:function(){setTimeout(function(){if(this.$container.css("max-height",999999),!this.hasmore)return this.$el.find("#loadmore").empty();var a=new e({list:this.collection,parentcontainer:this.$container});this.$el.find("#loadmore").html(a.render().el),this.loadmore=a}.bind(this),200)},hidemore:function(){this.$el.find(".load-more").hide()},fill:function(a){var b=this.templates[this.collectionstring];this.incremental?this.incremental=!1:($.each(this.entries,function(a,b){b.remove()}),this.entries=[]);for(var d in a){var e=new c({model:a[d],template:b,checkunread:!0,parameters:{inboxview:!0}});this.entries.push(e),this.listenTo(e,"toggle",this.toggle),this.$container.append(e.render().el),this.model.seedcontacts&&this.model.seedcontacts(a[d])}this.entries.length?setTimeout(this.toggle.bind(this,this.entries[0]),1):this.hidemore()},toggle:function(a){var b={model:a.model};this.inboxmessage&&this.inboxmessage.remove(),"notes"==this.collectionstring&&(b.template="note"),this.inboxmessage=new d(b),$(".message-container").html(this.inboxmessage.render().el),this.inboxmessage.showrelated(),this.$el.find(".entry-container .active").removeClass("active"),a.$el.addClass("active")},togglefilter:function(a){var b=$(a.currentTarget),c=b.data("toggle"),d=b.hasClass("selected");this.$el.find("[data-toggle].selected").removeClass("selected"),this.$el.find("[id^=filter_]").addClass("hidden"),d||(b.addClass("selected"),this.$el.find("#filter_"+c).removeClass("hidden"))},comparesuggestions:function(a){var b=this.$el.find("#filter_contacts input").val();if(!b)return this.hidesuggestions();b=b.toLowerCase();var c=this.model.contacts.filter(this.comparenamefilter.bind(this,b));return c.length<5&&!a.cid&&b.length>2&&this.requestcontacts(b),c.length?void this.showsuggestions(c.slice(0,10)):this.hidesuggestions()},comparenamefilter:function(a,b){return b.get("displayname").toLowerCase().indexOf(a)>=0||b.get("name")&&b.get("name").toLowerCase().indexOf(a)>=0},showsuggestions:function(a){this.$el.find("#filter_contacts label").removeClass("hidden"),this.$el.find("ul.contacts-suggestions").empty();for(var c in a)this.$el.find("ul.contacts-suggestions").append(b.render(Templates.contactsuggestionentry,a[c].attributes))},hidesuggestions:function(){this.$el.find("#filter_contacts label").addClass("hidden"),this.$el.find("ul.contacts-suggestions").empty()},requestcontacts:function(a){a!=this.filters.contacts.string&&(this.model.contacts.processing?this.filters.contacts.buffered=a:(this.$el.find(".loading-contacts").removeClass("hidden"),this.filters.contacts.string=a,this.model.contacts.fetch({remove:!1,parameters:{q:a,channels:this.model.id},success:this.loadedcontacts.bind(this)})))},loadedcontacts:function(){this.$el.find(".loading-contacts").addClass("hidden"),this.filters.contacts.buffered&&(this.requestcontacts(this.filters.contacts.buffered),this.filters.contacts.buffered=!1)},filtercontacts:function(a){var c=$(a.currentTarget);if(c.data("contact")){var d=Cloudwalkers.Session.getContact(c.data("contact"));this.filters.contacts.list.indexOf(d.id)<0&&(this.filters.contacts.list.push(d.id),this.$el.find("ul.contacts-placeholder").append(b.render(Templates.contactselectedentry,d.attributes)))}else{var e=c.data("close-contact");this.filters.contacts.list=this.filters.contacts.list.filter(function(a){return a!=e}),this.$el.find("[data-close-contact="+e+"]").parent().remove()}return this.collection.touch(this.model,this.filterparameters()),this},filternetworks:function(a,b){this.loadmylisteners(!0),b||(b=this.button&&this.button.data("networks")==$(a.currentTarget).data("networks")),this.togglestreams(b),b||(this.button=$(a.currentTarget).addClass("active").removeClass("inactive"));var c=b?null:String(this.button.data("networks")).split(" ");return b&&(this.button=!1),c?($(c.map(function(a){return'[data-streams="'+a+'"]'}).join(",")).removeClass("inactive").addClass("active"),this.filters.streams=c):this.filters.streams=[],this.collection.touch(this.model,this.filterparameters()),this},filterstreams:function(a,b){this.loadmylisteners(!0),b||(b=this.button&&this.button.data("streams")==$(a.currentTarget).data("streams")),this.togglestreams(b),b||(this.button=$(a.currentTarget).addClass("active").removeClass("inactive"));var c=b?null:Number(this.button.data("streams"));return b&&(this.button=!1),c?($('[data-networks~="'+c+'"]').removeClass("inactive").addClass("active"),this.filters.streams=[c]):this.filters.streams=[],this.collection.touch(this.model,this.filterparameters()),this},filterparameters:function(){var a;return a="notes"==this.listtype?{all:1}:this.model.get("token")&&"sent"==this.model.get("token")?{records:20}:{records:20,group:1},this.filters.contacts.list.length&&(a.contacts=this.filters.contacts.list.join(",")),this.filters.streams.length&&(this.model.get("token")&&"sent"==this.model.get("token")?a.target=this.filters.streams.join(","):a.streams=this.filters.streams.join(",")),this.storeview(),a},storeview:function(){var a=Cloudwalkers.Session.viewsettings(this.collectionstring);a&&(a.streams||(a.streams=[]),JSON.stringify(a.streams)!=JSON.stringify(this.filters.streams)&&(a.streams=this.filters.streams,Cloudwalkers.Session.viewsettings(this.collectionstring,a)))},more:function(){this.incremental=!0,this.loadmore.loadmylisteners();var a=this.collection.more(this.model,this.filterparameters());a||this.$el.find(".load-more").hide()},negotiateFunctionalities:function(){this.listenTo(Cloudwalkers.Session,"destroy:view",this.remove),this.addScroll()},addScroll:function(){this.$el.find(".scroller").slimScroll({height:"inherit"})},destroy:function(){$.each(this.entries,function(a,b){b.remove()})},isempty:function(){$(".message-container").empty().addClass("empty-content")},unsetempty:function(){$(".message-container").removeClass("empty-content")}});return f}),define(["Views/Panels/EntryLists/BoxLists/InboxMessageList","mustache","Views/Pages/Notes/ContactCard","Views/Entries/NoteEntry","Views/Entries/InboxNote"],function(a,b,c,d,e){var f=a.extend({entrytemplate:"smallentrynote",render:function(){this.on("contact:clicked",this.contactview);var a={streams:[],networks:[]};return this.model.streams.each(function(b){b.get(this.check)&&a.streams.push({id:b.id,icon:b.get("network").icon,name:b.get("defaultname"),network:b.get("network")})}.bind(this)),a.networks=this.model.streams.filterNetworks(a.streams,!0),a.note=this.listtype?!0:!1,this.$el.html(b.render(Templates.slimlist,a)),this.filters.streams.length&&(this.$el.find("[data-streams], [data-networks], .toggleall").toggleClass("inactive active"),this.$el.find(this.filters.streams.map(function(a){return'[data-networks~="'+a+'"],[data-streams="'+a+'"]'}).join(",")).toggleClass("inactive active")),this.$container=this.$el.find("ul.entry-container"),this.collection.touch(this.model,this.filterparameters()),this.listenTo(this.collection,"ready",this.afterrender),this.listenTo(Cloudwalkers.RootView,"ready:notecontext",this.rendercontext),this},fill:function(a){this.incremental?this.incremental=!1:($.each(this.entries,function(a,b){b.remove()}),this.entries=[]);for(var b in a){var c=new d({model:a[b],template:this.entrytemplate,parameters:{inboxview:!0}});this.entries.push(c),this.listenTo(c,"toggle",this.toggle),this.$container.append(c.render().el)}},afterrender:function(){this.entries.length?setTimeout(this.toggle.bind(this,this.entries[0]),1):this.hidemore()},toggle:function(a){var b={model:a.model},c=a.model.parent?a.model.parent.get("objectType"):null;this.inboxnote&&this.inboxnote.remove(),this.inboxnote=new e(b),$(".message-container").html(this.inboxnote.render().el),this.rendercontext(),"account"!=c&&this.inboxnote.showrelated(),this.$el.find(".entry-container .active").removeClass("active"),a.$el.addClass("active")},togglefilter:function(a){var b=$(a.currentTarget),c=b.data("toggle"),d=b.hasClass("selected");this.$el.find("[data-toggle].selected").removeClass("selected"),this.$el.find("[id^=filter_]").addClass("hidden"),d||(b.addClass("selected"),this.$el.find("#filter_"+c).removeClass("hidden"))},rendercontext:function(){if(this.inboxnote){var a,d=this.inboxnote.getcontext();if("message"==d.objectType){var e=$('<div class="message"></div>');d.display=!0,a=b.render(Templates.inboxmessage,d),a=e.append(a)}else if("contact"==d.objectType){var f=new c({contact:d});a=f.render().el}$(".message-container").find(".message").remove(),$(".message-container").find(".contact-card").remove(),$(".message-container").prepend(a)}},comparesuggestions:function(a){var b=this.$el.find("#filter_contacts input").val();if(!b)return this.hidesuggestions();b=b.toLowerCase();var c=this.model.contacts.filter(this.comparenamefilter.bind(this,b));return c.length<5&&!a.cid&&b.length>2&&this.requestcontacts(b),c.length?void this.showsuggestions(c.slice(0,10)):this.hidesuggestions()},comparenamefilter:function(a,b){return b.get("displayname").toLowerCase().indexOf(a)>=0||b.get("name")&&b.get("name").toLowerCase().indexOf(a)>=0},showsuggestions:function(a){this.$el.find("#filter_contacts label").removeClass("hidden"),this.$el.find("ul.contacts-suggestions").empty();for(var c in a)this.$el.find("ul.contacts-suggestions").append(b.render(Templates.contactsuggestionentry,a[c].attributes))},hidesuggestions:function(){this.$el.find("#filter_contacts label").addClass("hidden"),this.$el.find("ul.contacts-suggestions").empty()},requestcontacts:function(a){a!=this.filters.contacts.string&&(this.model.contacts.processing?this.filters.contacts.buffered=a:(this.$el.find(".loading-contacts").removeClass("hidden"),this.filters.contacts.string=a,this.model.contacts.fetch({remove:!1,parameters:{q:a,channels:this.model.id},success:this.loadedcontacts.bind(this)})))},loadedcontacts:function(){this.$el.find(".loading-contacts").addClass("hidden"),this.filters.contacts.buffered&&(this.requestcontacts(this.filters.contacts.buffered),this.filters.contacts.buffered=!1)},contactview:function(){var a=this.inboxnote.getcontext(),b=a.from?a.from[0]:null;b&&Cloudwalkers.RootView.viewContact({model:b})},filtercontacts:function(a){var c=$(a.currentTarget);if(c.data("contact")){var d=Cloudwalkers.Session.getContact(c.data("contact"));this.filters.contacts.list.indexOf(d.id)<0&&(this.filters.contacts.list.push(d.id),this.$el.find("ul.contacts-placeholder").append(b.render(Templates.contactselectedentry,d.attributes)))}else{var e=c.data("close-contact");this.filters.contacts.list=this.filters.contacts.list.filter(function(a){return a!=e}),this.$el.find("[data-close-contact="+e+"]").parent().remove()}return this.collection.touch(this.model,this.filterparameters()),this},filternetworks:function(a,b){this.loadmylisteners(!0),b||(b=this.button&&this.button.data("networks")==$(a.currentTarget).data("networks")),this.togglestreams(b),b||(this.button=$(a.currentTarget).addClass("active").removeClass("inactive"));var c=b?null:String(this.button.data("networks")).split(" ");return b&&(this.button=!1),c?($(c.map(function(a){return'[data-streams="'+a+'"]'}).join(",")).removeClass("inactive").addClass("active"),this.filters.streams=c):this.filters.streams=[],this.collection.touch(this.model,this.filterparameters()),this},filterstreams:function(a,b){this.loadmylisteners(!0),b||(b=this.button&&this.button.data("streams")==$(a.currentTarget).data("streams")),this.togglestreams(b),b||(this.button=$(a.currentTarget).addClass("active").removeClass("inactive"));var c=b?null:Number(this.button.data("streams"));return b&&(this.button=!1),c?($('[data-networks~="'+c+'"]').removeClass("inactive").addClass("active"),this.filters.streams=[c]):this.filters.streams=[],this.collection.touch(this.model,this.filterparameters()),this},filterparameters:function(){var a={all:1,records:20,group:1};return this.filters.contacts.list.length&&(a.contacts=this.filters.contacts.list.join(",")),this.filters.streams.length&&(a.streams=this.filters.streams.join(",")),this.storeview(),a}});return f}),define(["Views/Panels/EntryLists/BoxLists/InboxMessageList","Models/Message","Views/Entries/InboxMessage"],function(a,b,c){var d=a.extend({collectionstring:"notifications",check:"hasNotifications",toggle:function(a){this.inboxmessage&&this.inboxmessage.remove(),a.model.get("parent")?this.showmessage(a.model):this.listenToOnce(a.model,"change",this.showmessage),this.$el.find(".entry-container .active").removeClass("active"),a.$el.addClass("active").removeClass("unread")},showmessage:function(a){var d=Cloudwalkers.Session.getMessage(a.get("parent").id);d||(d=new b({id:a.get("parent").id})),this.model.messages.add(d),d.get("objectType")||d.fetch(),this.inboxmessage=new c({model:d,notification:a}),$(".message-container").html(this.inboxmessage.render().el)}});return d}),define(["Views/Panels/EntryLists/BoxLists/InboxMessageList","Views/Entries/BaseEntry","Views/Entries/InboxMessage"],function(a,b,c){var d=a.extend({initialize:function(a){a&&$.extend(this,a),this.model||(this.model=this.options.channel),this.collection=this.model[this.collectionstring],this.loadmylisteners()},render:function(){var a={streams:[],networks:[]},b=Cloudwalkers.Session.getChannel("outgoing").streams;return b.each(function(b){b.get(this.check)&&a.streams.push({id:b.id,icon:b.get("network").icon,name:b.get("defaultname"),network:b.get("network")})}.bind(this)),a.networks=b.filterNetworks(a.streams,!0),this.$el.html(Mustache.render(Templates.inboxlist,a)),this.$container=this.$el.find("ul.list"),this.filters.streams.length&&(this.$el.find("[data-streams], [data-networks], .toggleall").toggleClass("inactive active"),this.$el.find(this.filters.streams.map(function(a){return'[data-networks~="'+a+'"],[data-streams="'+a+'"]'}).join(",")).toggleClass("inactive active")),this.collection.touch(this.model,this.filterparameters(),{fields:"defaults,sendlogs"}),this},toggle:function(a){var b={model:a.model,template:"sentmessage"};this.inboxmessage&&this.inboxmessage.remove(),"notes"==this.collectionstring&&(b.template="note"),this.inboxmessage=new c(b),$(".inbox-container").html(this.inboxmessage.render().el),this.$el.find(".entry-container .active").removeClass("active"),a.$el.addClass("active")},fill:function(a){var c=this.templates[this.collectionstring];this.incremental?this.incremental=!1:($.each(this.entries,function(a,b){b.remove()}),this.entries=[]);for(var d in a){var e=new b({model:a[d],template:c,checkunread:!0,parameters:{sentview:!0}});this.entries.push(e),this.listenTo(e,"toggle",this.toggle),this.$container.append(e.render().el),this.model.seedcontacts&&this.model.seedcontacts(a[d])}this.entries.length?setTimeout(this.toggle.bind(this,this.entries[0]),1):this.hidemore()},storeview:function(){var a=Cloudwalkers.Session.viewsettings("sent");a&&(a.streams||(a.streams=[]),JSON.stringify(a.streams)!=JSON.stringify(this.filters.streams)&&(a.streams=this.filters.streams,Cloudwalkers.Session.viewsettings("sent",a)))},requestcontacts:function(a){a!=this.filters.contacts.string&&(this.model.contacts.processing?this.filters.contacts.buffered=a:(this.$el.find(".loading-contacts").removeClass("hidden"),this.filters.contacts.string=a,this.model.contacts.fetch({remove:!1,parameters:{q:a,channels:this.model.id},success:this.loadedcontacts.bind(this)})))}});return d}),define(["Views/Panels/EntryLists/BaseList","mustache","Views/Entries/BaseEntry"],function(a,b,c){var d=a.extend({id:"monitorparent",parameters:{records:40,markasread:!0},initialize:function(a){a&&$.extend(this.options,a),this.model=this.options.category,this.model.set({messages:[]}),this.listenTo(this.model.messages,"change:filter",this.loadmylisteners.bind(this,!0)),this.loadmylisteners(),this.options.reset&&(delete this.parameters.streams,delete this.parameters.channels),this.updateable(this.model,"h3.page-title")},render:function(){var a={name:this.model.get("name")};this.$el.html(b.render(Templates.monitorlist,a)),this.$container=this.$el.find(".entry-container"),this.$loadercontainer=this.$el.find(".panel-body"),this.$el.find(".load-more").hide(),this.model.messages.touch(this.model,this.parameters),this.addScroll();var c=this.$el.find(".slimScrollDiv").eq(0),d=c.css("height");return c.css("max-height",d),c.css("height","inherit"),this},loadmylisteners:function(a){a&&(this.stopListening(this.model.messages),this.listenTo(this.model.messages,"change:filter",this.loadmylisteners.bind(this,!0))),this.$el.find("#loadmore").empty(),this.listenTo(this.model.messages,"seed",this.fill),this.listenTo(this.model.messages,"request",this.showloading),this.listenTo(this.model.messages,"ready",this.showmore),this.listenTo(this.model.messages,"loaded",this.hideloading),this.loadListeners(this.model.messages,["request","sync","ready"],!0)},fill:function(a){this.incremental?this.incremental=!1:($.each(this.entries,function(a,b){b.remove()}),this.entries=[]);for(var b in a){var d=new c({model:a[b],template:"keywordentry"});this.entries.push(d),this.$container.append(d.render().el)}}});return d}),define(["Views/Panels/EntryLists/BaseList","mustache","Views/Entries/BaseEntry"],function(a,b,c){var d=a.extend({id:"scheduledlist",title:"Scheduled messages",parameters:{records:200,sort:"asc"},render:function(a){this.loadmylisteners(),this.$el.html(b.render(Templates.scheduledlist)),this.$container=this.$el.find(".entry-container"),this.$loadercontainer=this.$el.find(".panel-body"),this.$el.find(".load-more").hide(),a?(this.parameters=a,Cloudwalkers.Session.viewsettings("scheduled",{streams:a.target?[a.target]:[]})):this.filters.streams.length&&(this.parameters.target=this.filters.streams.join(",")),this.model.messages.touch(this.model,this.parameters),this.addScroll();var c=this.$el.find(".slimScrollDiv").eq(0),d=c.css("height");return c.css("max-height",d),c.css("height","inherit"),this},fill:function(a){this.incremental?this.incremental=!1:($.each(this.entries,function(a,b){b.remove()}),this.entries=[]),this.count=a.length;for(var b in a){var d=new c({tagName:"tr",model:a[b],type:"full",template:"scheduledentry"});this.entries.push(d),this.$container.append(d.render().el)}this.hideloading()}});return d}),define(["Views/Panels/Panel","mustache","Collections/Users","Views/Panels/Filters/User"],function(a,b,c,d){var e=a.extend({className:"filterpanel",filters:{users:{string:"",list:[]}},events:{remove:"destroy","input .input-rounded":"comparesuggestions","click .load-more":"more","click .toggleall.active":"toggleall"},options:{},initialize:function(a){a&&$.extend(this.options,a),a.model&&(this.model=this.options.model),this.model.childtype="message",this.model.users?this.model.users.reset():this.model.users=new c,this.model.users.parentmodel=this.model,this.listenTo(this.model.users,"add",this.comparesuggestions)},render:function(){var a;return Cloudwalkers.Session.censuretemplate(a),this.$el.html(b.render(Templates[this.options.template])),this.$container=this.$el.find("#userlist").eq(0),this},toggleall:function(){this.showsuggestions(this.model.users.models),this.model.messages.trigger("update:content"),this.model.messages.touch(this.model,{records:20})},comparesuggestions:function(a){this.$el.find(".toggleall").addClass("active").removeClass("inactive");var b=$(".userfilter input").val();if(!b)return this.hidesuggestions();b=b.toLowerCase();var c=this.model.users.filter(this.comparenamefilter.bind(this,b));return c.length<5&&!a.cid&&b.length>2&&this.requestusers(b),c.length?void this.showsuggestions(c.slice(0,10)):this.hidesuggestions()},comparenamefilter:function(a,b){return b.get("displayname").toLowerCase().indexOf(a)>=0||b.get("name")&&b.get("name").toLowerCase().indexOf(a)>=0},hidesuggestions:function(){this.fill(this.model.users.models)},showsuggestions:function(a){this.fill(a)},requestusers:function(a){a!=this.filters.users.string&&(this.model.users.processing?this.filters.users.buffered=a:(this.$el.find(".loading-contacts").removeClass("hidden"),this.filters.users.string=a,this.model.users.fetch({remove:!1,parameters:{q:a},success:this.loadedusers.bind(this)})))},loadedusers:function(){this.$el.find(".loading-contacts").addClass("hidden"),this.filters.users.buffered&&(this.requestusers(this.filters.users.buffered),this.filters.users.buffered=!1)},filter:function(a){$(a.currentTarget).toggleClass("inactive active");var b=this.$el.find(".filter.keyword-list .active"),c=[];if(!b.size())return this.list.$container.empty();b.each(function(){c.push($(this).attr("data-keyword-id"))});var d=this.$el.find(".filter.network-list .active"),e=[];return d.size()?(d.each(function(){e=e.concat($(this).attr("data-network-streams").split(" "))}),this.category.messages.touch(this.category,{records:40,channels:c.join(","),streams:e.join(",")}),this):this.list.$container.empty()},fill:function(a){$.each(this.entries,function(a,b){b.remove()}),this.entries=[];for(var b in a){var c=new d({model:a[b],template:"smalluser",type:"listitem"});this.entries.push(c),this.listenTo(c,"select",this.select),this.$container.append(c.render().el)}this.$el.find(".inner-loading").removeClass("inner-loading")},select:function(a){this.list.render({users:a.model.id,records:20})}});return e}),define(["Views/Panels/Filters/BaseFilters","mustache"],function(a,b){var c=a.extend({events:{"click [data-network-streams]":"filternetworks","click [data-keyword-id]":"filterkeywords","click .toggleall.networks.active":"toggleallnetworks","click .toggleall.keywords.active":"toggleallkeywords"},initialize:function(a){a&&$.extend(this.options,a),this.category=this.options.category,this.category.childtype="message",this.streams=[],this.category.channels.each(function(a){this.streams=this.streams.concat(a.streams.models)},this),this.initializeWidget()},toggleallnetworks:function(a){this.filternetworks(null,!0),this.togglefilters(a,".network-list")},toggleallkeywords:function(a){this.filterkeywords(null,!0),this.togglefilters(a,".keyword-list")},togglefilters:function(a,b){this.$el.find(b+" .filter").addClass(a?"active":"inactive").removeClass(a?"inactive":"active"),$(b+" .toggleall").addClass(a?"inactive":"active").removeClass(a?"active":"inactive")},render:function(){var a={keywords:this.category.channels.models,trans:trans};return a.name=this.category.get("name"),a.networks=Cloudwalkers.Session.getStreams().filterNetworks(this.streams,!0),Cloudwalkers.Session.censuretemplate(a),this.$el.html(b.render(Templates.channelfilters,a)),a.networks.length||this.$el.find(".building-notice").toggleClass("inactive"),this.listenTo(Cloudwalkers.Session,"destroy:view",this.remove),this},filternetworks:function(a,b){b||(b=this.button&&this.button.data("network-streams")==$(a.currentTarget).data("network-streams")),this.togglefilters(b,".network-list"),b||(this.button=$(a.currentTarget).addClass("active").removeClass("inactive"));var c=b?null:String(this.button.data("network-streams")).split(" ");return b&&(this.button=!1),c?this.list.parameters.streams=c.join(","):delete this.list.parameters.streams,this.category.messages.trigger("change:filter"),this.category.messages.touch(this.category,this.list.parameters),this},filterkeywords:function(a,b){b||(b=this.button&&this.button.data("keyword-id")==$(a.currentTarget).data("keyword-id")),this.togglefilters(b,".keyword-list"),b||(this.button=$(a.currentTarget).addClass("active").removeClass("inactive"));var c=b?null:Number(this.button.data("keyword-id"));return b&&(this.button=!1),c?this.list.parameters.channels=c:delete this.list.parameters.channels,this.category.messages.trigger("change:filter"),this.category.messages.touch(this.category,this.list.parameters),this}});return c}),define(["Views/Panels/Filters/BaseFilters","mustache","Views/Panels/Filters/User"],function(a,b,c){var d=a.extend({id:"scheduledfilters",events:{remove:"destroy","click *[data-streams]":"filter","click .toggleall.active":"toggleall"},initialize:function(a){a&&($.extend(this,a),$.extend(this.options,a)),this.model.childtype="message",this.streams=Cloudwalkers.Session.getChannel("internal").get("additional").outgoing},render:function(){var a={streams:[]};for(var c in this.streams)a.streams.push({id:this.streams[c].id,icon:this.streams[c].network.icon,name:this.streams[c].name,network:this.streams[c].network});return this.$el.html(b.render(Templates.scheduledfilters,a)),this.filters.streams.length&&(this.$el.find("[data-streams], [data-networks], .toggleall").toggleClass("inactive active"),this.$el.find(this.filters.streams.map(function(a){return'[data-networks~="'+a+'"],[data-streams="'+a+'"]'}).join(",")).toggleClass("inactive active")),this},toggleall:function(){this.filter(!0),this.togglefilters(!0)},togglefilters:function(a){this.$el.find("li").addClass(a?"active":"inactive").removeClass(a?"inactive":"active"),this.$el.find(".toggleall").addClass(a?"inactive":"active").removeClass(a?"active":"inactive")},filter:function(a,b){b||(b=this.button&&this.button.data("streams")==$(a.currentTarget).data("streams")),this.togglefilters(b),b||(this.button=$(a.currentTarget).addClass("active").removeClass("inactive"));var c=b?null:this.button.data("streams");return b&&(this.button=!1),this.list.render(c?{records:200,target:c,sort:"asc"}:{records:200,sort:"asc"}),this},fill:function(a){$.each(this.entries,function(a,b){b.remove()}),this.entries=[];for(var b in a){var d=new c({model:a[b],template:"smalluser",type:"listitem"});this.entries.push(d),this.listenTo(d,"select",this.select),this.$container.append(d.render().el)}this.$el.find(".inner-loading").removeClass("inner-loading")},select:function(a){this.list.render({users:a.model.id,records:20})},addScroll:function(){var a=this.$el.find(".scroller").eq(0);this.$el.find(".scroller").slimScroll({size:"6px",color:"#a1b2bd",height:$("#inner-content").height()-165+"px",alwaysVisible:!1,railVisible:!1});var b=a.css("height");a.css("max-height",b),a.css("height","inherit")}});return d}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({tagName:"li",template:"user",events:{click:"select"},initialize:function(a){a&&$.extend(this,a),this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.html(b.render(Templates[this.template],this.model.filterData(this.type))),this},select:function(){this.trigger("select",this)}});return c}),define(["Views/Panels/Panel","mustache","Utilities/keyword_filter"],function(a,b){var c=a.extend({events:{"submit form[data-add-category]":"addCategory","click button.add-keyword":"addKeyword","click button.update-keyword":"updateKeyword","click .cancel-edit-keyword":"render","click .reset-keyword":"resetFilter","click button[data-keyword-filter]":"toggleFilter"},options:{},initialize:function(a){a&&$.extend(this.options,a),this.channel=Cloudwalkers.Session.getChannel("monitoring"),this.listenTo(Cloudwalkers.Session.getChannels(),"sync",this.render),this.listenTo(Cloudwalkers.Session.getChannels(),"remove",this.render),this.listenTo(Cloudwalkers.Session.getAccount(),"sync",this.showFilter)},render:function(a){a&&a.preventDefault&&a.preventDefault();var c=Cloudwalkers.Session.getAccount(),d=c.attributes.filteroptions;d||c.fetch({endpoint:"filteroptions",success:this.render.bind(this)});
var e={filteroptions:d,categories:this.channel.channels.models};return d&&!this.scriptloaded&&(this.$el.find("#keywordseditor").keywordfilterdestroy(),this.$el.find("#keywordseditor").keywordfilterscript({update:trans("Update"),cancel:trans("Cancel"),message_contains:trans("message contains"),message_doesnt_contain:trans("message doesn't contain"),author_is:trans("author is"),author_is_not:trans("author is not"),country_is:trans("country is"),language_is:trans("language is"),country_is_not:trans("country is not"),language_is_not:trans("language is not"),group:trans("group"),end_group:trans("end group"),and:trans("and"),or:trans("or"),save:trans("Save"),there_are:trans("There are"),groups_left_open_please_close_them_and_resubmit:trans("groups left open. Please close them and resubmit"),formula_is_not_valid_add_more_parameters:trans("Formula is not valid. Add more parameters"),choose_language:trans("Choose language"),choose_country:trans("Choose country"),insert_text:trans("insert text"),insert_author:trans("insert author"),countries:d.countries,languages:d.languages,success:function(a){this.formula=a}.bind(this)})),this.$el.html(b.render(Templates.keywordseditor,e)),this.$el.find("select").chosen({width:"100%"}),d||(this.$el.find("#keyword_filter").addClass("hidden"),this.$el.find(".container-loading").removeClass("hidden")),this},showFilter:function(){this.$el.find("#keyword_filter").removeClass("hidden"),this.$el.find(".container-loading").addClass("hidden")},addCategory:function(a){a.preventDefault();var b={name:$("#category_create_name").val(),remember:$("#category_create_remember").val()};this.channel.channels.create(b,{parent:this.channel.id,wait:!0}),this.$el.find(".addcategory .fa-cloud-upload").show()},addKeyword:function(a){a.preventDefault();var b=Number($("#keyword_manage_category").val());if($("#keywordsfilter * .alert").remove(),!b)return Cloudwalkers.RootView.alert(trans("Don't forget to select a category."));var c=Cloudwalkers.Session.getChannel(b);return this.keywordFormula().name?this.keywordFormula().settings.formula?(c.channels.create(this.keywordFormula(),{parent:b,wait:!0,error:function(){Cloudwalkers.RootView.information(trans("Not saved"),trans("Something went wrong"),this.$el.find(".manage-keyword")),this.$el.find(".managekeyword .fa-cloud-upload").hide()}.bind(this),success:function(){Cloudwalkers.RootView.growl(trans("Manage Keywords"),trans("Keyword filter has been successfully added"))}.bind(this)}),void this.$el.find(".managekeyword .fa-cloud-upload").show()):Cloudwalkers.RootView.alert(trans("Please add a filter to your keyword.")):Cloudwalkers.RootView.alert(trans("Don't forget to fill the keyword name"))},updateKeyword:function(a){return a.preventDefault(),this.keywordFormula().name?(this.keywordFormula().settings.formula&&(this.editing.endpoint="",this.editing.save(this.keywordFormula(),{success:function(){Cloudwalkers.RootView.growl(trans("Manage Keywords"),trans("Keyword filter has been updated"))}.bind(this),error:function(){Cloudwalkers.RootView.growl(trans("Not saved"),trans("Something went wrong"))}.bind(this)})),void this.$el.find(".managekeyword .fa-cloud-upload").show()):Cloudwalkers.RootView.alert(trans("Don't forget to fill the keyword name"))},fillKeyword:function(a,b){b.preventDefault(),this.render(),this.$el.find(".add-keyword, .edit-keyword").toggleClass("inactive");var c=this.editing=Cloudwalkers.Session.getChannel(a),d=c.get("settings");$('#keyword_manage_category option[value="'+c.get("parent")+'"]').attr("selected","selected"),$("#keyword_manage_name").val(c.get("name"));var e=d.formula;e=e.replace(/\(/g,",(,"),e=e.replace(/\)/g,",),"),e=e.replace(/ and /gi,",and,"),e=e.replace(/ or /gi,",or,"),e=e.split(",");for(var f in e)e[f]=e[f].trim();var g=$.map(e,function(a){return""!==a?a:null});for(var h in g)this.formulaElement(g[h]),this.$el.find("select").chosen({width:"100%"});$("#keyword_filter #demo_plus").remove(),this.addPlus("small"),this.$el.find("#keyword_manage_category").trigger("chosen:updated")},addPlus:function(a){"small"==a&&$("#keyword_filter").append('<span id="demo_plus" class="demo_bubble demo_drop demo_hit_me"><span class="demo_hit_me">+</spam><span class="demo_options"><ul><li class="add_and">'+trans("and")+'</li><li class="add_or">'+trans("or")+"</li></ul></span></span>"),"large"==a&&$("#keyword_filter").append('<span id="demo_plus" class="demo_bubble demo_drop demo_hit_me"><span class="demo_hit_me">+</spam><span class="demo_options"><ul><li class="add_message_contains">'+trans("message contains")+'</li><li class="add_message_no_contains" class="demo_doesntcontain">'+trans("message doesnt containt")+'</li><li class="add_author_is hidden">'+trans("author is")+'</li><li class="add_author_is_not hidden">'+trans("author is not")+'</li><li class="add_country_is">'+trans("country is")+'</li><li class="add_country_is_not">'+trans("country is not")+'</li><li class="add_language_is">'+trans("language is")+'</li><li class="add_language_is_not">'+trans("language is not")+'</li><li class="add_group">'+trans("group")+"</li></ul></span></span>")},formulaElement:function(a){rand_id=this.getRandomInt(1,999);var b=Cloudwalkers.Session.getAccount(),c=b.attributes.filteroptions;countries=c.countries,languages=c.languages;var d="";for(var e in languages)d+='<option value="'+languages[e].token+'">'+languages[e].name+"</option>";var f="";for(var g in countries)f+='<option value="'+countries[g].token+'">'+countries[g].name+"</option>";if("or"==a&&$("#keyword_filter").append('<span  id="'+rand_id+'" class="demo_bubble demo_drop demo_or" data-value="or " ><span class="sel_value">'+trans("or")+'</span><i class="demo_hit_me icon-sort-down"></i><span class="demo_options"><ul><li class="demo_change_val" data-value="or" data-text="'+trans("or")+'">'+trans("or")+'</li><li class="demo_change_val" data-value="and" data-text="'+trans("and")+'">'+trans("and")+'</li></ul></span><i class="demo_remove_filter icon-remove"></i></span>'),"and"==a&&$("#keyword_filter").append('<span  id="'+rand_id+'" data-string="sel_value" class="demo_bubble demo_drop demo_and" data-value="and " ><span class="sel_value">'+trans("and")+'</span><i class="demo_hit_me icon-sort-down"></i><span class="demo_options"><ul><li class="demo_change_val" data-value="and" data-text="'+trans("and")+'">'+trans("and")+'</li><li class="demo_change_val" data-value="or" data-text="'+trans("or")+'">'+trans("or")+'</li></ul></span><i class="demo_remove_filter icon-remove"></i></span>'),"("==a&&$("#keyword_filter").append('<span  id="'+rand_id+'" class="demo_bubble  demo_group" data-option="("><span class="sel_value">'+trans("group")+'</span><i class="demo_remove_filter icon-remove"></i></span>'),")"==a&&$("#keyword_filter").append('<span  id="'+rand_id+'" class="demo_bubble  demo_end_group" data-option=")"><span class="sel_value">'+trans("end group")+'</span><i class="demo_remove_filter icon-remove"></i></span>'),-1!=a.indexOf("language")){splitValue=a.split(" "),splitValue[2]=splitValue[2].replace(/'/g,"");for(var h in languages)languages[h].token.toLowerCase()==splitValue[2].toLowerCase()&&(tokenValue=languages[h].token.toLowerCase());tokenValue&&($("#keyword_filter").append("!="==splitValue[1]?'<span id="'+rand_id+'" class="demo_bubble demo_contains" data-option="language != " data-value="'+splitValue[2]+'">'+trans("language is not")+'<span class="demo_drop demo_bubble_text"><select class="demo_options" id="languages">'+d+'</select></span><i class="demo_remove_filter icon-remove"></i></span>':'<span id="'+rand_id+'" class="demo_bubble demo_contains" data-option="language = " data-value="'+splitValue[2]+'">'+trans("language is")+'<span class="demo_drop demo_bubble_text"><select class="demo_options" id="languages">'+d+'</select></span><i class="demo_remove_filter icon-remove"></i></span>'),$("#"+rand_id+" select").val(tokenValue).trigger("change"))}if(-1!=a.indexOf("country")){splitValue=a.split(" "),splitValue[2]=splitValue[2].replace(/'/g,"");for(var i in countries)countries[i].token.toUpperCase()==splitValue[2].toUpperCase()&&(tokenValue=countries[i].token.toUpperCase());tokenValue&&($("#keyword_filter").append("!="==splitValue[1]?'<span id="'+rand_id+'" class="demo_bubble demo_contains" data-option="country != " data-value="'+splitValue[2]+'">'+trans("country is not")+'<span class="demo_drop demo_bubble_text"><select class="demo_options" id="countries">'+f+'</select></span><i class="demo_remove_filter icon-remove"></i></span>':'<span id="'+rand_id+'" class="demo_bubble demo_contains" data-option="country = " data-value="'+splitValue[2]+'">'+trans("country is")+'<span class="demo_drop demo_bubble_text"><select class="demo_options" id="countries">'+f+'</select></span><i class="demo_remove_filter icon-remove"></i></span>'),$("#"+rand_id+" select").val(tokenValue).trigger("change"))}-1!=a.indexOf("message")&&(splitValue=a.split("'"),textValue=splitValue[1],splitValue=a.split(" "),splitValue[2]=splitValue[2].replace(/'/g,""),$("#keyword_filter").append("!contains"==splitValue[1]?'<span id="'+rand_id+'" class="demo_bubble demo_contains" data-option="message !contains ">'+trans("message doesnt containt")+'<span class="demo_hit_me demo_input_text demo_bubble_text"><span class="text">'+textValue+'</span><span class="demo_options"><input type="text" name="lname" value=""><br><div class="modal-footer toload"><button data-option="save" class="btn" onclick="return false;">'+trans("save")+'</button><button data-option="cancel" class="btn btn-primary" onclick="return false;">'+trans("cancel")+'</button></div></span></span><i class="demo_remove_filter icon-remove"></i></span>':'<span id="'+rand_id+'" class="demo_bubble demo_contains" data-option="message contains ">'+trans("message contains")+'<span class="demo_hit_me demo_input_text demo_bubble_text"><span class="text">'+textValue+'</span><span class="demo_options"><input type="text" name="lname" value=""><br><div class="modal-footer toload"><button data-option="save" class="btn" onclick="return false;">'+trans("save")+'</button><button data-option="cancel" class="btn btn-primary" onclick="return false;">'+trans("cancel")+'</button></div></span></span><i class="demo_remove_filter icon-remove"></i></span>')),-1!=a.indexOf("author")&&(splitValue=a.split("'"),textValue=splitValue[1],splitValue=a.split(" "),splitValue[2]=splitValue[2].replace(/'/g,""),$("#keyword_filter").append("!="==splitValue[1]?'<span id="'+rand_id+'" class="demo_bubble demo_contains" data-option="author != ">'+trans("author is not")+'<span class="demo_hit_me demo_input_text demo_bubble_text"><span class="text">'+textValue+'</span><span class="demo_options"><input type="text" name="lname" value=""><br><div class="modal-footer toload"><button data-option="save" class="btn" onclick="return false;">'+trans("save")+'</button><button data-option="cancel" class="btn btn-primary" onclick="return false;">'+trans("cancel")+'</button></div></span></span><i class="demo_remove_filter icon-remove"></i></span>':'<span id="'+rand_id+'" class="demo_bubble demo_contains" data-option="author = ">'+trans("author is")+'<span class="demo_hit_me demo_input_text demo_bubble_text"><span class="text">'+textValue+'</span><span class="demo_options"><input type="text" name="lname" value=""><br><div class="modal-footer toload"><button data-option="save" class="btn" onclick="return false;">'+trans("save")+'</button><button data-option="cancel" class="btn btn-primary" onclick="return false;">'+trans("cancel")+'</button></div></span></span><i class="demo_remove_filter icon-remove"></i></span>'))},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},keywordFormula:function(){var a={name:$("#keyword_manage_name").val(),settings:{}};return a.settings.formula="",a.settings.formula=this.formula,a},keywordParameters:function(){var a={name:$("#keyword_manage_name").val(),settings:{}};if($("#filter_formula").val()&&(a.settings.formula=$("#filter_formula").val()),$("#filter_include").val()&&(a.settings.include=$("#filter_include").val().split(",")),$("#filter_exclude").val()&&(a.settings.exclude=$("#filter_exclude").val().split(",")),a.settings.include&&a.settings.include.length)for(var b in a.settings.include)a.settings.include[i]=a.settings.include[b].trim();if(a.settings.exclude&&a.settings.exclude.length)for(var c in a.settings.exclude)a.settings.exclude[j]=a.settings.exclude[c].trim();return a.settings.languages=$("#filter_languages").val(),a.settings.countries=$("#filter_countries").val(),a},resetFilter:function(){Cloudwalkers.RootView.confirm(trans("Are you sure you want to reset this filter?"),function(){$("#keyword_filter").html(""),this.addPlus("large")}.bind(this))},toggleFilter:function(a){a.preventDefault();var b=$(a.target).attr("data-keyword-filter");this.$el.find("div[data-keyword-filter="+b+"]").toggleClass("inactive")}});return c}),define(["Views/Panels/Panel","mustache"],function(a,b){return KeywordsOverview=a.extend({id:"monitorparent",entries:[],events:{"submit form":"editCategory","click .edit-toggler":"toggleEditCategory","click .delete-category":"deleteCategory","click .delete-keyword":"deleteKeyword","click [data-keyword]":"toggleEditKeyword"},options:{},initialize:function(a){a&&(this.options=a),this.channel=Cloudwalkers.Session.getChannel("monitoring"),this.editor=this.options.editor,this.listenTo(Cloudwalkers.Session.getChannels(),"sync",this.render)},render:function(){categories=this.channel.channels.map(function(a){return{id:a.id,name:a.get("name"),settings:a.get("settings"),keywords:a.channels.models}});var a={categories:categories};return Cloudwalkers.Session.censuretemplate(a),this.$el.html(b.render(Templates.keywordsoverview,a)),this},toggleEditCategory:function(a){a.stopPropagation(),$(a.target).closest("[data-category]").find(".category-name, .category-edit").toggle()},editCategory:function(a){a.stopPropagation();var b=$(a.target).closest("[data-category]"),c=b.find('[name="name"]').val(),d=b.find('[name="remember"]').val(),e={remember:d},f=Cloudwalkers.Session.getChannel(Number(b.attr("data-category")));return f.endpoint="",f.save({name:c,settings:e}),b.find(".name_val").html(c),b.find(".remember_val").html(d),!1},deleteCategory:function(a){a.stopPropagation();var b=$(a.target).closest("[data-category]");Cloudwalkers.RootView.confirm(trans("Are you sure you want to remove this category?"),function(){Cloudwalkers.Session.getChannel(Number(b.attr("data-category"))).destroy(),Cloudwalkers.RootView.navigation.render(),b.next().remove(),b.remove()})},toggleEditKeyword:function(a){a.stopPropagation();var b=Number($(a.target).closest("[data-keyword]").data("keyword"));this.editor.fillKeyword(b,a),$("html, body").animate({scrollTop:$("#keywordsfilter").offset().top-50},500)},deleteKeyword:function(a){a.stopPropagation();var b=Number($(a.target).closest("[data-keyword]").attr("data-keyword"));Cloudwalkers.RootView.confirm(trans("Are you sure you want to remove this filter?"),function(){Cloudwalkers.Session.getChannel(b).destroy(),$(a.target).parent().remove()})}})}),define(["Views/BaseView","mustache"],function(a,b){var c=a.extend({events:{click:"more"},initialize:function(a){$.extend(this,a)},loadmylisteners:function(){this.loadListeners(this.list,["request","sync","ready"],!0),this.trigger("rendered")},render:function(){return this.$el.html(b.render(Templates.loadmore)),this.$container=this.$el.find(".load-more-wrap"),this.$loadercontainer=this.$el.find(".load-more-wrap"),this},more:function(){this.$el.find(".btn.load-more").addClass("hidden"),this.$el.find(".load-more-wrap").addClass("inner-loading");var a=this.parentcontainer.outerHeight();this.parentcontainer.css("max-height",a)}});return c}),define(["Views/BaseView","slimscroll","mustache"],function(a,b,c){var d=a.extend({options:{title:"widget",icon:"inbox",color:"blue",network:null},entries:[],events:{"click .panel-heading":"togglecollapse"},initialize:function(a){this.options=$.extend({},a,this.options),this.initializeWidget()},initializeWidget:function(){this.bind("destroy",this.onDestroy)},innerRender:function(a){a.html("No inner content set.")},render:function(){return"undefined"!=typeof this.options.title&&(this.title=this.options.title),"undefined"!=typeof this.options.icon&&this.options.icon&&(this.icon=this.options.icon),this.$el.html(c.render(Templates.panel,{title:this.title,icon:this.icon})),this.$innerEl=$(this.$el.find(".panel-body")),this.innerRender(this.$innerEl),this},togglecollapse:function(){this.$el.find(".panel-body").slideToggle(),this.$el.find(".panel").hasClass("collapsed")?this.$el.find(".panel").removeClass("collapsed"):this.$el.find(".panel").addClass("collapsed")},negotiateFunctionalities:function(){this.$el.find(".scroller").length&&this.addScroll();var a=this.$el.find(".slimScrollDiv").eq(0),b=a.css("height");a.css("max-height",b),a.css("height","inherit"),this.options.counter&&this.appendCounter(),"undefined"!=typeof this.options.open&&this.appendCollapseble(this.options.open)},appendCollapseble:function(){},appendCounter:function(){var a=0;this.$el.find("li .badge, li .count").each(function(){a+=Number($(this).text())}),a>999&&(a="+999"),0>a&&(a=0),this.$el.find(".tools").append($('<span class="count">'+a+"</span>"))},addScroll:function(){var a,b=this.$el.find(".scroller").eq(0);"list"==this.type&&(a=$("#inner-content").height()-165+"px"),b.slimScroll({size:"6px",color:"#a1b2bd",position:"right",height:a,alwaysVisible:"1"==$(this).attr("data-always-visible")?!0:!1,railVisible:"1"==$(this).attr("data-rail-visible")?!0:!1,disableFadeOut:!0});var c=b.css("height");b.css("max-height",c),b.css("height","inherit"),this.$el.find(".slimScrollBar").eq(0).css("right","-9px"),this.$el.find(".slimScrollDiv").eq(0).css("overflow","visible"),this.$el.find(".slimScrollDiv").eq(0).css("height","auto"),this.$el.find(".slimScrollDiv").eq(0).css("max-height","250px")},onDestroy:function(){$.each(this.entries,function(a,b){b.trigger("destroy")}),this.$el.find(".scroller").slimScroll({destroy:1}),this.remove()},collapse:function(){this.$el.toggleClass("collapse-closed collapse-open")}});return d}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({initialize:function(a){a&&$.extend(this,a),this.settings={},this.settings.title=this.title,this.collection=this.parentview.collection,this.listenTo(this.collection,"ready",this.fill)},render:function(){return this.$el.html(b.render(Templates.besttimewrap,this.settings)),this},fill:function(){if(!this.filled){var a=this.collection.clone().parsebesttime(this.parentview.streamid);$.each(a,function(c,d){d.fill=100*d.value/a.maxvalue,d.time=d.time>=0?d.time+"h":"",this.$el.find(".chart-wrapper").append(b.render(Templates.besttime,d))}.bind(this)),this.filled=!0}}});return c}),define(["backbone","mustache","Models/Network","Models/Stream"],function(a,b,c,d){var e=a.View.extend({title:"Chart",events:{},columns:{contacts:"parsecontacts",age:"parseage",gender:"parsegender",regional:"parseregional",besttime:"parsebesttime",cities:"parsecities",networks:"parsenetworks",activity:"parsecalendar","contact-evolution":"parsecontactevolution","message-evolution":"parsemessageevolution",messages:"parsemessages",activities:"parseactivities",impressions:"parseimpressions",notifications:"parsenotifications",followers:"parsefollowers",following:"parsefollowing",follow:"parsefollow","contact-evolution-network":"parsecontactevolutionnetwork","message-evolution-network":"parsemessageevolutionnetwork",geo:"parsegeo",allreports:"parseallreports",nodata:"emptychartdata"},colors:["#E27927","#B14B22","#9E1818","#850232","#68114F","#70285B","#783E68","#815574","#896C80","#91828D"],countrycolors:["#E27927","#E5822E","#E88B35","#EC953C","#EF9E43","#F2A74A","#F5B051","#F9BA58","#FCC35F","#FFCC66"],networkcolors:{facebook:"#3B5998",twitter:"#01a9da",linkedin:"#1783BC",tumblr:"#385775","google-plus":"#DD4C39",youtube:"#CC181E",web:"#f39501",blog:"#f39501","mobile-phone":"#E2EAE9",others:"#E5E5E5"},networktokens:{Facebook:"#3B5998",Twitter:"#01a9da",LinkedIn:"#1783BC",GooglePlus:"#DD4C39",YouTube:"#CC181E",Youtube:"#CC181E",Internal:"#E2EAE9",Others:"#E5E5E5",CoworkerWall:"#CCCCCC"},initialize:function(a){a&&$.extend(this,a),view=this,this.collection=this.parentview.collection,this.listenToOnce(this.collection,"ready",this.fill)},render:function(){return this.settings={},this.settings.title=this.title,this.$el.html(b.render(Templates.chart,this.settings)),this},fill:function(){if(this.collection.latest()&&this.collection.latest().get("streams")){var a,b,c=this.columns[this.filterfunc],d=".chart-container";if(b=this[c](this.collection),"besttime"==this.filterfunc)this.renderbesttime(b);else{var e=this.$el.find(d).get(0).clientWidth,f={pieHole:.4,chartArea:{width:"95%",height:"90%"},vAxis:{minValue:0},width:e,height:.7*e,legend:{textStyle:{fontSize:"13"}},tooltip:{textStyle:{fontSize:"13"}}},g={displayMode:"markers",colorAxis:{colors:["#E27927","#91828D"]}};"geo"==this.filterfunc&&"dots"==this.type&&$.extend(f,g),$.extend(f,b.options),_.map(b.data,function(a){"Female"==a[0]&&(a[0]=trans("Feminino")),"Male"==a[0]&&(a[0]=trans("Masculino"))}.bind(this)),b.data=google.visualization.arrayToDataTable(b.data),a=new google.visualization[this.chart](this.$el.find(d).get(0)),a.draw(b.data,f),this.removeloading()}}},removeloading:function(){this.$el.find(".loading").removeClass("loading")},renderbesttime:function(a){this.$el.html(b.render(Templates.besttimewrap,this.settings)),$.each(a,function(c,d){d.fill=100*d.value/a.maxvalue,this.$el.find(".chart-wrapper").append(b.render(Templates.besttime,d))}.bind(this))},parsecontacts:function(a,b,e){var f,g={},h=0,i={data:[],colors:[],options:{}};return f=b?b:this.collection.latest().get("streams"),$.each(f,function(a,b){b=new d(b);var f=new c(Cloudwalkers.Session.getStream(b.id).get("network")),h=b.getcontacts();return e&&f.gettoken()!=e?!0:void(_.isNumber(h)&&_.has(g,f.gettoken())?g[f.gettoken()].addcontacts(h):g[f.gettoken()]=f.addcontacts(h))}),g=_.sortBy(g,function(a){return a.get("contacts")}),$.each(g,function(a,b){i.data.push([b.gettitle(),b.getcontacts()]),i.colors.push(b.getcolor()),h+=b.getcontacts()}),!a||0!==i.data.length&&0!==h?(i.options.colors=i.colors,e||b||i.data.unshift(["Network",trans("Number of contacts")]),i):this.emptychartdata()},parsemessages:function(a,b,e){var f,g={},h={data:[],colors:[]};return f=b?b:a.latest().get("streams"),$.each(f,function(a,b){b=new d(b);var f=new c(Cloudwalkers.Session.getStream(b.id).get("network")),h=b.getmessages();return e&&f.gettoken()!=e?!0:void(_.isNumber(h)&&_.has(g,f.gettoken())?g[f.gettoken()].messages+=h:(g[f.gettoken()]=f,g[f.gettoken()].messages=h))}),g=_.sortBy(g,function(a){return a.get("messages")}),$.each(g,function(a,b){h.data.push([b.gettitle(),b.messages]),h.colors.push(b.getcolor())}),e||b||h.data.unshift(["Network",trans("Number of contacts")]),h},parsecontactevolution:function(a){return this.parseevolution(a,"contacts")},parsecontactevolutionnetwork:function(a){var b=a.models,c=this.network,d=this.$el.find(".chart-container").get(0).clientWidth,e={data:[],options:{colors:["#333333"],chartArea:{width:"70%",height:"70%",left:"40"},width:d,height:.3*d,curveType:"function"}};return $.each(b,function(a,b){var d=moment(b.get("date")).format("D MMM"),f=b.pluck("contacts",c);e.data.push([d,f])}.bind(this)),e.data.unshift(["Day",trans("Number of contacts")]),e},parsemessageevolution:function(a){var b=a.models,c=this.$el.find(".chart-container").get(0).clientWidth,d={data:[],options:{colors:["#333333"],chartArea:{width:"90%",height:"70%",left:"40"},width:c,height:c>350?350:.92*c,legend:{position:"bottom",textStyle:{fontSize:"13"}},curveType:"function",hAxis:{textStyle:{fontSize:"10"}}}};return $.each(b,function(a,b){var c=moment(b.get("date")).format("D MMM"),e=b.pluck("messages");d.data.push([c,e])}.bind(this)),d.data.unshift(["Day",trans("Number of messages")]),d},parsemessageevolutionnetwork:function(a){var b=a.models,c=this.network,d=this.$el.find(".chart-container").get(0).clientWidth,e={data:[],options:{colors:["#333333"],chartArea:{width:"70%",height:"70%",left:"40"},width:d,height:.65*d,legend:{position:"bottom"},curveType:"function"}};return $.each(b,function(a,b){var d=moment(b.get("date")).format("D MMM"),f=b.pluck("messages",c);e.data.push([d,f])}.bind(this)),e.data.unshift(["Day",trans("Number of messages")]),e},parseactivities:function(a,b,e){var f,g={},h={data:[],colors:[]};return f=b?b:a.latest().get("streams"),$.each(f,function(a,b){b=new d(b);var f=new c(Cloudwalkers.Session.getStream(b.id).get("network")),h=b.getactivities();return e&&f.gettoken()!=e?!0:void(_.isNumber(h)&&_.has(g,f.gettoken())?g[f.gettoken()].activities+=h:(g[f.gettoken()]=f,g[f.gettoken()].activities=h))}),g=_.sortBy(g,function(a){return a.get("activities")}),$.each(g,function(a,b){h.data.push([b.gettitle(),b.activities]),h.colors.push(b.getcolor())}),e||b||h.data.unshift(["Network",trans("Number of contacts")]),h},parseimpressions:function(a,b,e){var f,g={},h={data:[],colors:[]};return f=b?b:a.latest().get("streams"),$.each(f,function(a,b){b=new d(b);var f=new c(Cloudwalkers.Session.getStream(b.id).get("network")),h=b.getimpressions();return e&&f.gettoken()!=e?!0:void(_.isNumber(h)&&_.has(g,f.gettoken())?g[f.gettoken()].impressions+=h:(g[f.gettoken()]=f,g[f.gettoken()].impressions=h))}),g=_.sortBy(g,function(a){return a.get("impressions")}),$.each(g,function(a,b){h.data.push([b.gettitle(),b.impressions]),h.colors.push(b.getcolor())}),e||b||h.data.unshift(["Network",trans("Number of contacts")]),h},parsenotifications:function(a,b,e){var f,g={},h={data:[],colors:[]};return f=b?b:a.latest().get("streams"),$.each(f,function(a,b){b=new d(b);var f=new c(Cloudwalkers.Session.getStream(b.id).get("network")),h=b.getnotifications();return e&&f.gettoken()!=e?!0:void(_.isNumber(h)&&_.has(g,f.gettoken())?g[f.gettoken()].notifications+=h:(g[f.gettoken()]=f,g[f.gettoken()].notifications=h))}),g=_.sortBy(g,function(a){return a.get("notifications")}),$.each(g,function(a,b){h.data.push([b.gettitle(),b.notifications]),h.colors.push(b.getcolor())}),e||b||h.data.unshift(["Network",trans("Number of contacts")]),h},parsefollowers:function(a,b,e){var f,g={},h={data:[],colors:[]};return f=b?b:a.latest().get("streams"),$.each(f,function(a,b){b=new d(b);var f=new c(Cloudwalkers.Session.getStream(b.id).get("network")),h=b.getfollowers();return e&&f.gettoken()!=e?!0:void(_.isNumber(h)&&_.has(g,f.gettoken())?g[f.gettoken()].followers+=h:(g[f.gettoken()]=f,g[f.gettoken()].followers=h))}),g=_.sortBy(g,function(a){return a.get("followers")}),$.each(g,function(a,b){h.data.push([b.gettitle(),b.followers]),h.colors.push(b.getcolor())}),e||b||h.data.unshift(["Network",trans("Number of contacts")]),h},parsefollowing:function(a,b,e){var f,g={},h={data:[],colors:[]};return f=b?b:a.latest().get("streams"),$.each(f,function(a,b){b=new d(b);var f=new c(Cloudwalkers.Session.getStream(b.id).get("network")),h=b.getfollowing();return e&&f.gettoken()!=e?!0:void(_.isNumber(h)&&_.has(g,f.gettoken())?g[f.gettoken()].following+=h:(g[f.gettoken()]=f,g[f.gettoken()].following=h))}),g=_.sortBy(g,function(a){return a.get("following")}),$.each(g,function(a,b){h.data.push([b.gettitle(),b.following]),h.colors.push(b.getcolor())}),e||b||h.data.unshift(["Network",trans("Number of contacts")]),h},parsefollow:function(a){var b=a.latest(),c=b.pluck(["contacts","types","followers"],this.network,3),d=b.pluck(["contacts","types","following"],this.network,3),e={data:[["Followers",c],["Following",d]],options:{colors:["#2bbedc","#324A4F"]}};return 0>=d+c?this.emptychartdata():(e.data.unshift(["Follow state",trans("Number of contacts")]),e)},parseage:function(a){var b=a.latest().get("streams"),c=this.groupkey(b,"contacts","age"),d=0,e=[],f={data:[],options:{colors:["#2bbedc","#2CA7C0","#2E90A4","#2F7988","#30616B","#324A4F","#333333"]}};return $.each(c,function(a,b){e.push([a,b]),d+=b}),e=_.sortBy(e,function(a){return a.title}),0===e.length||0===d?this.emptychartdata():(f.data=e,f.data.unshift(["Age interval",trans("Number of contacts")]),f)},groupkey:function(a,b,c){var d={};return $.each(a,function(a,e){if(this.network&&e.id==this.network||!this.network){var f=e[b][c];_.isObject(f)&&(_.isEmpty(d)?d=f:$.each(f,function(a,b){d[a]+=b}))}}.bind(this)),d},parsegender:function(a){var b=a.latest().get("streams"),c=this.groupkey(b,"contacts","gender"),d=0,e=[],f={data:[],options:{colors:["#2bbedc","#F14B68",a.networkcolors.others]}};return $.each(c,function(a,b){e.push([this.capitalize(a),b]),d+=b}.bind(this)),0===e.length||0===d?this.emptychartdata():(f.data=e,f.data.unshift(["Gender",trans("Number of contacts")]),f)},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},filtercountry:function(a,b){var c={},d=a.latest().get("streams");return $.each(d,function(a,d){if(b&&d.id==b||!b){var e=Cloudwalkers.Session.getStream(d.id).get("network").name,f=Cloudwalkers.Session.getStream(d.id).get("network").token;if(_.isObject(d.contacts.geo)){var g=d.contacts.geo.countries;0===_.size(c)?$.each(g,function(a,b){c[b.name]=b,c[b.name].networks=[],c[b.name].networks[e]={total:b.total,token:f}}):$.each(g,function(a,b){c[b.name]?(c[b.name].total+=b.total,c[b.name].networks[e]?c[b.name].networks[e].total+=b.total:c[b.name].networks[e]={total:b.total,token:f}):(c[b.name]=b,c[b.name].networks=[],c[b.name].networks[e]={total:b.total,token:f})})}}}),c=_(c).sortBy(function(a){return a.total})},parseregional:function(a,b){var c=b||this.network,d=8,e=0,f=this.filtercountry(a,c),g={data:[],options:{colors:this.colors}};if(this.regional=[],(!d||d>f.length)&&(d=f.length),0===d)return this.emptychartdata();for(;d>e;){var h=f.pop();g.data.push([h.name,h.total]),this.regional.push(h),e++}var i=_.reduce(f,function(a,b){return a+b.total},0);return g.data.push(["Others",i]),g.data.unshift(["Countries",trans("Number of contacts")]),g},parsecities:function(a){var b,c,d=6,e=this.filtercountry(a,this.network),f={};return 0===e.length?this.emptychartdata():(c=e[e.length-1],countrycities=c.cities,$.each(countrycities,function(a,b){f[b.name]={name:b.name,value:b.total}}),f=_(f).sortBy(function(a){return a.value}),b=this.getbiggestdata(f,d),b.data.unshift(["Cities",trans("Number of contacts")]),this.$el.find("h4").text(c.name+", "+trans("cities")),b)},parsenetworks:function(a){var b=this.connect.regional?this.connect.regional:this.parseregional(a),c={data:[],colors:[]};if(0===b.length)return this.emptychartdata();this.$el.find("h3").html(b[0].name);var d=b[0].networks;for(var e in d)c.data.push([e,d[e].total]),c.colors.push(a.networkcolors[d[e].token]);return c.data.unshift(["Network",trans("Number of contacts")]),c},getbiggestdata:function(a,b){for(var c=0,d={data:[],options:{colors:[]}};b>c;){var e=a.pop();d.data.push([e.name,e.value]),d.options.colors.push(this.countrycolors[c]),c++}if(0===a.length)return d;var f=_.reduce(a,function(a,b){return a+b.value},0);return d.data.push(["Others",f]),d.options.colors.push(this.collection.networkcolors.others),d},parsebesttime:function(a){var b,c,e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],f=[],g=0,h=0;return a.forEach(function(a){var i=a.get("streams"),j=[];i.forEach(function(a){if(a=new d(a),b=a.getbesttime())if(0===j.length)j=_.values(b);else for(var c in b)j[c]+=b[c],j[c]>g&&(g=j[c]),j[c]>h&&(h=j[c])}),c=j.indexOf(Math.max.apply(Math,_.values(j))),f.push({day:e.shift(),value:h,time:c}),h=0}),f.maxvalue=g,f},parseevolution:function(a,b){for(var c,d=b?this.columns[b]:this.columns[this.type],e=this.collection.length,f=this.network?this.network:null,g=["Day of the week"],h={},i=this.$el.find(".chart-container").get(0).clientWidth,j={data:[],options:{chartArea:{width:"70%",height:"60%",left:"40",top:"50"},width:i,height:.4*i,legend:{textStyle:{fontSize:"11"},position:"top"},curveType:"function",colors:[]}},k=0;e>k;k++)c=a.place(k).get("streams"),dailyresult=this[d](null,c,f),dailyresult=this.mapdailydata(dailyresult,h,k);for(var l=0;e>l;l++){var m=[moment(a.place(l).get("date")).format("D MMM")];
for(var n in h)m.push(h[n].shift());j.data.push(m)}for(var o in h)g.push(o),j.options.colors.push(this.networktokens[o]);return j.data.unshift(g),j},mapdailydata:function(a,b,c){return _.map(a.data,function(a){b[a[0]]||(b[a[0]]=[]),b[a[0]][c]=a[1]}),a},parseallreports:function(a){var b=this.parseevolution(a,"contacts").data,c=this.parseevolution(a,"messages").data,d=this.parseevolution(a,"notifications").data,e=this.$el.find(".chart-container").get(0).clientWidth,f={data:[],colors:["#E27927","#9E1818","#68114F","#783E68","#896C80"],options:{chartArea:{width:"90%",height:"90%"},width:e,height:.7*e,legend:{textStyle:{fontSize:"13"},position:"bottom"},tooltip:{textStyle:{fontSize:"13"}},curveType:"function"}};return b.shift(),c.shift(),d.shift(),$.each(b,function(a){b[a].push(c[a][1]),b[a].push(d[a][1])}),f.data=b,f.data.unshift(["Day of the week","Contacts","Messages","Notifications"]),f},parsegeo:function(a){var b=this.parseregional(a,this.network);return b},emptychartdata:function(){var a={data:[["No results",1]],options:{colors:["#e5e5e5"]},empty:!0};return a.data.unshift(["Results","Number"]),a},negotiateFunctionalities:function(){}});return e}),define(["Views/Panels/Panel","mustache"],function(a,b){var c=a.extend({size:"full",currentReport:null,element:null,render:function(){function a(a){f.find('[data-report-id="'+a.get("uniqueid")+'"]').click(function(){d.setReport(a)})}function c(a){f.find('[data-interval-id="'+a.token+'"]').click(function(){f.find(".interval-value").html(a.name);var b=11,c=1;"day"==a.token?c=b:"7days"==a.token?c=7*b:"28days"==a.token&&(c=28*b);for(var e=new Date,g=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1),h=new Date(g.getTime()-86400*c*1e3),i=g,j=0;j<d.options.reports.length;j++)d.options.reports[j].intervalinput=a.token,d.options.reports[j].daterange=[h,i],d.options.reports[j].refresh();d.currentReport&&d.currentReport.getDataset().refresh()})}var d=this,e={},f=this.$el;this.element=f,e.reports=[],e.stream=this.options.stream;for(var g=0;g<this.options.reports.length;g++)e.reports.push(this.options.reports[g].attributes);e.intervals=[{name:"Days",token:"day"},{name:"7 days",token:"7days"},{name:"28 days",token:"28days"}],f.html(b.render(Templates.combinedstatistics,e));for(var h=0;h<this.options.reports.length;h++)a(this.options.reports[h]);for(var i=0;i<e.intervals.length;i++)c(e.intervals[i]);return f.find('[data-interval-id="'+e.intervals[0].token+'"]').click(),this.options.reports.length>0?this.setReport(this.options.reports[0]):(this.$el.find(".statistic-container").html("<p>There is currently no information available.</p>"),this.$el.find(".statistic-title").html("Combined statistics"),this.$el.find(".statistic-description").html("")),this},setReport:function(a){this.element.find(".report-value").html(a.get("name")),this.currentReport=a;var b=$("<div></div>");this.$el.find(".statistic-container").html(b),this.$el.find(".statistic-title").html(a.get("name")),this.$el.find(".statistic-description").html(a.get("description")),a.getWidget().innerRender(b)}});return c}),define(["backbone","mustache","Views/Panels/Statistics/Chart"],function(a,b,c){var d=a.View.extend({templatemap:{"2col1row":["#col1","#col2","#row1"],"2row":["#row1","#row2"]},options:{},initialize:function(a){a&&($.extend(this,a),$.extend(this.options,a)),this.charttemplate="compoundchart"+this.options.template,this.template=this.options.template,this.charts=this.options.chartdata},render:function(){return this.settings={},this.settings.title=this.title,this.$el.html(b.render(Templates[this.charttemplate],this.settings)),this.fill(),this},fill:function(){var a={Chart:c};return this.filled?!0:($.each(this.charts,function(b,c){c.data.network=this.network,c.data.parentview=this.parentview;var d=new a[c.widget](c.data).render().el;this.parentview.views.push(d),this.$el.find(this.templatemap[this.template][b]).append(d)}.bind(this)),void(this.filled=!0))}});return d}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({title:"EmptyData",messageconfig:{now:{id:"subtractempty",text:"Show me the previous {{span}}'s statistics"},nodata:{id:"addempty",text:"Show me the next {{span}}'s statistics"},reports:{id:"showreports",text:"Show older reports"}},initialize:function(a){$.extend(this,a)},render:function(){return this.checknow(),this.$el.html(b.render(Templates.emptystatisticsdata,{message:this.message})),this},checknow:function(){var a,b=1e3*this.timeparams.since,c=1e3*this.timeparams.until,d=moment().utc().valueOf();c>=d&&d>b&&(a="now"),this.generatemessage(a)},generatemessage:function(a){var c=trans("There is no available data."),d='<br/><a id="{{id}}">{{text}}</a>',e=this.timeparams.span;if(a){var f=this.messageconfig[a].id,g=trans(b.render(this.messageconfig[a].text,{span:e}));this.message=c+b.render(d,{id:f,text:g})}else this.getcreationdate()},getcreationdate:function(){var a;if(this.stream){var b=Cloudwalkers.Session.getStream(this.stream);b.get("created")?this.parsecreationdate(b.get("created")):b.fetch({success:this.getstreamdate.bind(this)})}else a=Cloudwalkers.Session.getAccount().get("created"),this.parsecreationdate(a)},parsecreationdate:function(a){var b=moment.unix(Date.parse(a)/1e3).utc();this.generatemessage(b.valueOf()/1e3>=1410998400?"nodata":"reports")},getstreamdate:function(a){a.get("created")?this.parsecreationdate(a.get("created")):this.generatemessage("nodata")}});return c}),define(["backbone","mustache","calheatmap","d3"],function(a,b,c){var d=a.View.extend({title:"Info",filled:!1,nummonths:{quarter:3,year:12},initialize:function(a){a&&$.extend(this,a),this.collection=this.parentview.collection,this.listenTo(this.collection,"ready",this.fill)},render:function(){return this.$el.html(b.render(Templates.activitycalendar,this.options)),this},fill:function(){if(this.filled)return!1;var a,b=new c,d=this.calculatedata(),e={itemSelector:this.$el.find("#cal-heatmap").get(0),domain:"month",subDomain:"x_day",data:d.data,start:Date.parse(d.date),cellSize:36,cellPadding:8,range:1,legend:d.legend,label:{height:30},subDomainTextFormat:"%d"};("quarter"==this.span||"year"==this.span)&&(a=this.calculatesizes(this.nummonths[this.span]),12==this.nummonths[this.span]&&delete e.subDomainTextFormat,$.extend(e,a)),b.init(e),this.filled=!0},calculatesizes:function(a){var b=this.$el.find("#cal-heatmap").get(0).clientWidth,c=(b-40)/a,d={subDomain:"day",cellSize:.15*c,cellPadding:.15*c/3,range:a};return d},calculatedata:function(){var a,b=$.extend(!0,{},this.collection),c={},d=0;if(b.models.length>=2)for(;b.models.length>=2;){var e=b.models.shift(),f=b.models[0],g=f.pluck("messages",this.parentview.streamid)-e.pluck("messages",this.parentview.streamid);a=new Date(f.get("date")).getTime()/1e3,c[a]=g,0===d&&(d=f.get("date"))}return 1==b.models.length&&(d=b.models.shift().get("date")),{data:c,legend:this.generaterange(c,4),date:d}},generaterange:function(a,b){for(var c=_.max(a,function(a){return a}),d=_.min(a,function(a){return a}),e=(c-d)/b,f=[],g=1;b>=g;g++)f.push(e*g);return f},negotiateFunctionalities:function(){}});return d}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({title:"Info",columns:{"contact-evolution":"parseevolution","post-activity":"parsepostactivity",activity:"parseactivity","page-views":"parseviews",notifications:"parsenotifications","contact-evolution-network":"parseevolutionnetwork","post-activity-network":"parsepostactivitynetwork","activity-network":"parseactivitynetwork","page-views-network":"parseviewsnetwork",besttimetopost:"parsebesttimetopost",followers:"parsefollowers",following:"parsefollowing",mentions:"parsementions",retweets:"parseretweets",shares:"parseshares",posts:"parseposts",dms:"parsedms"},descriptions:{contacts:{facebook:"New fans",twitter:"New followers",youtube:"New subscriptions",linkedin:"New followers"},messages:{facebook:"New mesages",twitter:"New tweets",youtube:"New uploads",linkedin:"New messages"},notifications:{facebook:"New notifications",twitter:"New notifications",youtube:"New notifications",linkedin:"New notifications"}},streamid:null,initialize:function(a){a&&$.extend(this,a),!this.network&&this.parentview&&(this.network=this.parentview.streamid),this.settings={title:this.title,network:this.network?{icon:Cloudwalkers.Session.getStream(this.network).get("network").token}:{icon:"cloud"},streamid:this.network},this.settings.filterfunc=this.filterfunc,this.settings.footer=this.footer,this.collection=this.parentview.collection,this.listenTo(this.collection,"ready",this.fill),this.listenTo(this.collection,"change",this.render)},render:function(){return this.$el.html(b.render(Templates.dashboardstat,this.settings)),this.settings.details&&this.settings.details.length&&void 0!==this.settings.details[0].content&&this.$el.find(".dashboard-stat").removeClass("panel-loading"),this},fill:function(){var a=this.columns[this.filterfunc];this.settings.details=this[a](),this.render()},parseevolution:function(){var a=this.collection.latest().pluck("contacts"),b=this.collection.first().pluck("contacts"),c=a-b,d=trans("New contacts");return this.settings.network={icon:"group"},[{content:c,descr:d}]},parsepostactivity:function(){var a=this.collection.latest().pluck("messages"),b=this.collection.first().pluck("messages"),c=a-b,d=trans("New messages");return this.settings.network={icon:"cloud-upload"},[{content:c,descr:d}]},parseactivity:function(){var a=this.collection.latest().pluck("activities"),b=this.collection.first().pluck("activities"),c=a-b,d=trans("New activities");return this.settings.network={icon:"cloud-download"},[{content:c,descr:d}]},parseviews:function(){var a=this.collection.latest().pluck(["messages","impressions"],!1,!0),b=this.collection.first().pluck(["messages","impressions"],!1,!0),c=a-b,d=trans("New impressions");return[{content:c,descr:d}]},parsenotifications:function(){var a=this.collection.latest().pluck("notifications"),b=this.collection.first().pluck("notifications"),c=a-b,d=trans("New notifications");return[{content:c,descr:d}]},parseevolutionnetwork:function(){var a=this.collection.latest().pluck("contacts",this.network),b=this.collection.first().pluck("contacts",this.network),c=a-b,d=this.descriptions.contacts[this.icon];return[{content:c,descr:d}]},parsepostactivitynetwork:function(){var a=this.collection.latest().pluck("messages",this.network),b=this.collection.first().pluck("messages",this.network),c=a-b,d=this.descriptions.messages[this.icon];return[{content:c,descr:d}]},parseactivitynetwork:function(){var a=this.collection.latest().pluck("activities",this.network),b=this.collection.first().pluck("activities",this.network),c=a-b,d=trans("New activities");return[{content:c,descr:d}]},parseviewsnetwork:function(){var a=this.collection.latest().pluck(["messages","impressions"],this.network,!0),b=this.collection.first().pluck(["messages","impressions"],this.network,!0),c=a-b,d=trans("Post views");return[{content:c,descr:d}]},parsenotificationnetwork:function(){var a=this.collection.latest().pluck("contacts",this.network),b=this.collection.first().pluck("contacts",this.network),c=a-b,d=this.descriptions.notifications[this.icon];return[{content:c,descr:d}]},parsefollowers:function(){var a=this.collection.latest().pluck(["contacts","types","followers"],this.network,3)||this.collection.latest().pluck("contacts",this.network),b=this.collection.first().pluck(["contacts","types","followers"],this.network,3)||this.collection.first().pluck("contacts",this.network),c=a-b,d=0===c?0:Math.floor(c/b*100);d>=0&&(d="+"+d),c>=0&&(c="+"+c);var e="<strong>"+c+"</strong> ("+d+"%) in last 7 days";return[{content:a,descr:e}]},parsementions:function(){var a=this.collection.latest().pluck(["notifications","types","comments"],this.network,3),b=this.collection.first().pluck(["notifications","types","comments"],this.network,3),c=a-b,d=this.title;return[{content:c,descr:d}]},parseretweets:function(){var a=this.collection.latest().pluck(["notifications","types","shares"],this.network,3),b=this.collection.first().pluck(["notifications","types","shares"],this.network,3),c=a-b,d=this.title;return[{content:c,descr:d}]},parsefollowing:function(){var a=this.collection.latest().pluck(["contacts","types","following"],this.network,3),b=this.collection.first().pluck(["contacts","types","following"],this.network,3),c=a-b,d=this.title;return[{content:c,descr:d}]},parseplusones:function(){var a=this.collection.latest().pluck(["notifications","types","favourites"],this.network,3),b=this.collection.first().pluck(["notifications","types","favourites"],this.network,3),c=a-b,d=this.title;return[{content:c,descr:d}]},parseseniorities:function(){var a=this.collection.latest().pluck(["contacts","professional","seniority"],this.network,3),b=this.collection.first().pluck(["contacts","professional","seniority"],this.network,3),c=a-b,d=this.title;return[{content:c,descr:d}]},parseshares:function(){var a=this.collection.latest().pluck(["messages","types","shares"],this.network,3),b=this.collection.first().pluck(["messages","types","shares"],this.network,3),c=a-b,d=Cloudwalkers.Session.getStream(this.network).get("network").token,e=trans("twitter"==d?"New retweets":"New shares");return[{content:c,descr:e}]},parseposts:function(){var a=this.collection.latest().pluck(["messages","types","posts"],this.network,3),b=this.collection.first().pluck(["messages","types","posts"],this.network,3),c=a-b,d=trans("New posts");return[{content:c,descr:d}]},parsedms:function(){var a=this.collection.latest().pluck(["messages","types","dms"],this.network,3),b=this.collection.first().pluck(["messages","types","dms"],this.network,3),c=a-b,d=trans("New direct messages");return[{content:c,descr:d}]},parsebesttimetopost:function(){var a=this.collection.clone().parsebesttime(this.network);if(0===a.length)return null;for(var b={},c=a[0].time,d=1,e=0;e<a.length;e++){var f=a[e].time;0>f||(null==b[f]?b[f]=1:b[f]++,b[f]>d?(c=f,d=b[f]):b[f]==d&&(c=f,d=b[f]))}var g=this.title;return c>=0?[{content:c+"h - "+(c+1)+"h",descr:g}]:!1},negotiateFunctionalities:function(){}});return c}),define(["Views/Panels/Panel","mustache"],function(a,b){var c=a.extend({className:"stats-summary",columns:{contacts:{title:"Total Contacts",func:"parsecontacts"},"score-trending":{title:"Popularity score",func:"parsescore"},outgoing:{title:"Messages sent",func:"parsesent"},coworkers:{title:"Co-workers activity",func:"parseactivity"},"contacts-network":{title:"Total Contacts",func:"parsecontactsnetwork"},"score-trending-network":{title:"Popularity score",func:"parsescorenetwork"},"outgoing-network":{title:"Messages sent",func:"parsesentnetwork"},besttime:{title:"Best time to post",func:"parsebesttime"}},options:{},initialize:function(a){a&&($.extend(this,a),$.extend(this.options,a)),this.collection=this.parentview.collection,this.listenTo(this.collection,"sync:data",this.fill)},render:function(){var a={columns:[]};for(var c in this.columnviews)a.columns.push(this.columns[this.columnviews[c]]);for(var d in a.columns)!a.columns[d].title&&a.columns[d].title&&(a.columns[d].title=trans(a.columns[d].title));return this.$el.html(b.render(Templates.statsummary,a)),this},fill:function(){this.$el.find("[data-type]").each(function(a,b){var c=$(b).data("type");$(b).find(".stats-summary-counter").html(this[c]().counter)}.bind(this))},parsecontacts:function(){var a=this.collection.latest();return{counter:a.pluck("contacts")}},parsescore:function(){stat=this.collection.latest();var a=stat.pluck("notifications")+stat.pluck("activities");return{counter:a}},parsesent:function(){var a=this.collection.latest(),b=this.collection.first(),c=a.pluck("messages")-b.pluck("messages");return{counter:c}},parseactivity:function(){var a=Cloudwalkers.Session.getStream("coworkers").id,b=this.activitymsgs(this.collection.latest(),a)-this.activitymsgs(this.collection.first(),a);return{counter:b>=0?b:0}},activitymsgs:function(a,b){var c,d=a.get("streams"),e=$.grep(d,function(a){return a.id==b});return c=e.length?_.isNumber(e[0].messages)?e[0].messages:e[0].messages:0},parsecontactsnetwork:function(){var a=this.collection.latest();return{counter:a.pluck("contacts",this.parentview.streamid)}},parsescorenetwork:function(){stat=this.collection.latest();var a=stat.pluck("notifications",this.parentview.streamid)+stat.pluck("activities",this.parentview.streamid);return{counter:a}},parsesentnetwork:function(){var a=this.collection.latest(),b=this.collection.first(),c=a.pluck("messages",this.parentview.streamid)-b.pluck("messages",this.parentview.streamid);return{counter:c}},parsebesttime:function(){var a=this.collection.clone().parsebesttime(this.parentview.streamid);if(0===a.length)return null;for(var b={},c=a[0].time,d=1,e=0;e<a.length;e++){var f=a[e].time;0>f||(null==b[f]?b[f]=1:b[f]++,b[f]>d?(c=f,d=b[f]):b[f]==d&&(c=f,d=b[f]))}return c>=0?{counter:c+"h - "+(c+1)+"h"}:{counter:"--"}}});return c}),define(["backbone","mustache"],function(a,b){return TitleSeparator=a.View.extend({className:"titleseparator",initialize:function(a){a&&$.extend(this,a),this.settings={},this.settings.title=this.title},render:function(){return this.$el.html(b.render(Templates.titleseparator,this.settings)),this},negotiateFunctionalities:function(){}})}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({initialize:function(a){a&&$.extend(this,a),this.settings={},this.settings.title=this.title,this.model=this.parentview.streamid?Cloudwalkers.Session.getStream(this.parentview.streamid):Cloudwalkers.Session.getChannel("profiles").clone(),this.listenTo(this.model,"sync",this.fill),this.gettoptrending()},render:function(){return this.$el.html(b.render(Templates.trendingmsg,this.settings)),this.hideloading(),this},fill:function(){if(this.message=this.model.get("messages")?this.model.get("messages")[0]:!1,!this.message||0===this.message.length)return this.$el.find(".commentballoon h4").html("No data"),void this.hideloading();var a=this.message,b=a.attachments?a.attachments.filter(function(a){return"link"==a.type?a:void 0}):null,c=a.attachments?a.attachments.filter(function(a){return"image"==a.type?a:void 0}):null;if(this.settings.from=a.from[0].displayname||"",this.settings.body=a.body.plaintext||"",this.settings.icon=a.from[0].network.icon||"",this.settings.date=a.dateonly||"",this.settings.statistics=[],c.length&&(this.settings.image=c[0].url||""),a.stats)for(var d in a.stats)"notes"!=d&&this.settings.statistics.push({name:d,value:a.stats[d]});this.settings.links=b||[],this.render()},gettoptrending:function(){return this.parentview.streamid?this.toptrendingstream(this.parentview.streamid):this.toptrendingall()},toptrendingstream:function(){var a={sort:this.timespan.sort,records:1};this.model.fetch({endpoint:"messages",parameters:a})},toptrendingall:function(){var a={sort:"engagement",records:1,since:this.timespan.since};this.model.fetch({endpoint:"messages",parameters:a})},showloading:function(){this.$el.find(".fa-cloud-download").show()},hideloading:function(){$(".inner-loading").removeClass("inner-loading")},negotiateFunctionalities:function(){}});return c}),define(["backbone","gritter","mustache","Views/Navigation","Views/Modals/Compose/Compose","Views/Modals/Contact","Views/Modals/SimpleCompose"],function(a,b,c,d,e,f,g){var h=a.View.extend({view:null,header:null,footer:null,initialize:function(){this.navigation=new d(this),this.navigation.fit(),$(window).on("resize",this.resize.bind(this)),this.resize()},render:function(){return this.view?($("#inner-content").html(this.view.render().el),$("#page-container").removeClass("notloaded"),this.view.$el.trigger("rendered"),this.view.finish&&this.view.finish(),void this.navigation.handleSidebarMenu()):null},setView:function(a){this.view&&this.view.remove(),Cloudwalkers.Session.trigger("destroy:view"),this.view=a,this.render(),Cloudwalkers.Session.manage()},resize:function(){var a=this.height(!0);this.trigger("resize",a),$("#inner-content").css("min-height",a-42+"px")},height:function(a){var b=$(window).height(),c=$(c).height();return a&&c>b?c:b},popup:function(a){var b=this,c=Templates.uipopup,d=$(c).modal();d.find(".modalcontainer").html(a.render().el),a.on("popup:close",function(){d.modal({modalOverflow:!0})}),a.on("content:change",function(){b.trigger("content:change")})},compose:function(a){a?a.type="post":a={type:"post"};var b=new e(a);return b.render().$el.modal({backdrop:"static",modalOverflow:!0}),b},viewContact:function(a){a||(a=0);var b={contact:a},c=new f(b);c.render().$el.modal({modalOverflow:!0})},writeNote:function(a){var b={id:"compose",className:"modal fade simple",thanks:!0,parent:a},c=new g(b);return c.render().$el.modal({modalOverflow:!0}),c},confirm:function(a,b,d){var e={};e.message=a,e.options=[{token:"confirm",label:trans("Yes"),description:"Confirm your action"}];var f=c.render(Templates.uiconfirm,e),g=$(f),h=g.modal();g.find("[data-response=confirm]").click(function(){b(),h.modal({modalOverflow:!0})}),g.find("[data-dismiss=modal]").click(function(){d&&d()})},alert:function(a,b){var d={};d.message=a;var e=c.render(Templates.uiconfirm,d),f=$(e),g=f.modal();f.find("[data-response=confirm]").click(function(){b(),g.modal({modalOverflow:!0})})},growl:function(a,b){$.gritter.add({title:a,text:b,time:4e3})},information:function(a,b,c){c||(c="#inner-content .container-fluid"),$(c).prepend("<div class='alert alert-info'><button type='button' class='close' data-dismiss='alert'></button><strong>"+a+"</strong> "+b+"</div>")},dialog:function(a,b,d){var e={};e.message=a,e.options=b;for(var f=c.render(Templates.uidialog,e),g=$(f),h=g.modal(),i=function(a){g.find("[data-response="+a.token+"]").click(function(){d(a),h.modal({modalOverflow:!0})})},j=0;j<b.length;j++)i(b[j])},imagePopups:function(){$("a.image-popup-viewer").colorbox()}});return h}),define(["backbone","mustache","Collections/Triggers","Models/Trigger","Views/Root","Views/Pages/Settings"],function(a,b,c,d){var e=a.View.extend({events:{"click i[data-delete-campaign-id]":"deletecampaign","click #menu a":"scroll","submit form#editaccount":"editaccount","keydown [data-attribute=account-name]":"enablebtnaccount","click [data-action=resetaccount]":"disablebtnaccount"},initialize:function(){this.streams=Cloudwalkers.Session.getStreams(),this.streams=this.streams.filterNetworks(),this.account=Cloudwalkers.Session.getAccount(),this.triggers=new c,this.account=Cloudwalkers.Session.getAccount(),this.triggermodel={}},render:function(){var a=this.account.attributes;return Cloudwalkers.Session.censuretemplate(a),this.$el.html(b.render(Templates.account,a)),this.$el.find("#menu").affix(),this},enablebtnaccount:function(){this.$el.find("[data-action=resetaccount]").attr("disabled",!1)},disablebtnaccount:function(a){$(a.currentTarget).closest("form").get(0).reset(),this.$el.find("[data-action=resetaccount]").attr("disabled",!0)},filltriggers:function(a){var b=a.filter(function(a){return"CONTACT-NEW"==a.get("event")?a:void 0}),c=a.filter(function(a){return"MESSAGE-RECEIVED"==a.get("event")?a:void 0});b=new d(b[0].attributes),this.twitterview.updatetrigger(b),c=new d(c[0].attributes),this.dmview.updatetrigger(c)},action:function(a){var b=$(a.currentTarget).data("action");this[b](a)},editaccount:function(a){a.preventDefault();var b=this.$el.find("[data-attribute=account-name]").val();this.$el.find(".edit-account-name").addClass("loading"),this.$el.find(".edit-account-name .btn").attr("disabled",!0),this.account.save({name:b},{patch:!0,success:function(){Cloudwalkers.RootView.growl(trans("Account settings"),trans("Your Account Settings are updated")),this.$el.find(".edit-account-name").removeClass("loading"),this.$el.find("[data-action=editaccount]").attr("disabled",!1)}.bind(this),error:function(){Cloudwalkers.RootView.growl(trans("Account settings"),trans("There was an error updating your settings.")),this.$el.find(".edit-account-name").removeClass("loading"),this.$el.find("[data-action=editaccount]").attr("disabled",!1),this.$el.find("[data-action=editaccount]").attr("disabled",!1)}.bind(this)})},deletecampaign:function(a){var b=$(a.target).data("delete-campaign-id");Cloudwalkers.RootView.confirm(trans("Are you sure you want to remove this campaign?"),function(){Cloudwalkers.Session.getAccount().removecampaign(b,a.target)})},scroll:function(a){var b=$(a.currentTarget).data("hash"),c=this.$el.find("h3[name="+b+"]").offset().top;return c-=this.$el.find("h3[name="+b+"]").outerHeight(),$("html, body").animate({scrollTop:c},"fast"),!1}});return e}),define(["backbone"],function(a){var b=a.View.extend({events:{"click i[data-delete-canned-id]":"deletecanned"},initialize:function(){this.cannedresponses=Cloudwalkers.Session.getCannedResponses(),this.listenTo(this.cannedresponses,"sync",this.render)},render:function(){var a={canned:this.cannedresponses.models};return this.$el.html(Mustache.render(Templates.settings.cannedlist,a)),this},deletecanned:function(a){var b=$(a.target).data("delete-canned-id"),c=this.cannedresponses.removecanned(b);c.length&&(this.listenTo(c[0],"destroyed",function(){this.destroyli(a)}.bind(this)),c[0].deletecanned())},destroyli:function(a){$(a.target).closest("li").remove()}});return b}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({events:{"click .add-user":"addUser","submit #edit-user-profile":"editUserProfile","submit #edit-user-password":"editUserPassword","click #add-file":"addfile","change input[type=file]":"listentofile","click #upload-file":"uploadfile","change select":"enablereset","keydown input":"enablereset","click [type=reset]":"disablereset"},"class":"section",collections:[],render:function(){var a=Cloudwalkers.Session.getUser(),c=this,d={user:{firstname:a.get("firstname"),name:a.get("name"),mobile:a.get("mobile"),avatar:a.get("avatar"),role:a.getRole()},langs:Cloudwalkers.langs};return Cloudwalkers.Session.censuretemplate(d),this.$el.html(b.render(Templates.profile,d)),this.$el.find(".collapse-closed, .collapse-open").each(function(){c.negotiateFunctionalities(this)}),this.$el.find("option[value="+a.get("locale")+"]").attr("selected",!0),this},editUserProfile:function(a){a.preventDefault();var b=Cloudwalkers.Session.getUser(),c=this.$el.find("[name=firstname]").val(),d=this.$el.find("[name=name]").val(),e=this.$el.find("[name=mobile]").val(),f=this.$el.find("[name=locale]").val();this.$el.find("#edit-user-profile .btn").attr("disabled",!0),this.$el.find("#edit-user-profile").addClass("loading"),b.save({firstname:c,name:d,mobile:e,locale:f},{patch:!0,success:function(){Cloudwalkers.RootView.growl(trans("User Profile"),trans("Your Profile Settings are updated")),window.location.reload()}.bind(this),error:function(){Cloudwalkers.RootView.growl(trans("User Profile"),trans("There was an error updating your settings."))}.bind(this)})},enablereset:function(){this.$el.find("[type=reset]").attr("disabled",!1)},disablereset:function(a){$(a.currentTarget).closest("form").get(0).reset(),this.$el.find("[type=reset]").attr("disabled",!0)},addfile:function(){$(".settings-profile input[type=file]").click()},listentofile:function(a){var b=a.target.files;for(var c in b){var d=b[c];if(!d.type.match("image.*"))return Cloudwalkers.RootView.information(trans("Wrong file"),trans("You need a valid image"),this.$el.find(".settings-profile .panel-body"));var e=new FileReader;e.onload=this.fileparser(d,a),e.readAsDataURL(d)}},fileparser:function(){return function(a){this.addimage(a.target.result)}.bind(this)},addimage:function(a){this.base64data=a,this.$el.find("div.avatar-big").css("background-image","url("+a+")")},uploadfile:function(){this.$el.find(".edit-user-avatar").addClass("loading"),this.base64data?Cloudwalkers.Session.getUser().save({avatar:this.base64data},{patch:!0,success:function(){Cloudwalkers.RootView.growl(trans("User Profile"),trans("You have a new profile picture")),this.$el.find(".edit-user-avatar").removeClass("loading"),setTimeout(function(){window.location.reload()},1e3)}.bind(this)}):(Cloudwalkers.RootView.growl(trans("No Image"),trans("Select an image file first")),this.$el.find(".edit-user-avatar").removeClass("loading"))},editUserPassword:function(a){a.preventDefault();var b=this.$el.find("[name=pass0]").val(),c=this.$el.find("[name=pass1]").val();if(this.$el.find(".edit-user-password").addClass("loading"),c!=this.$el.find("[name=pass2]").val())return Cloudwalkers.RootView.growl("Oops",trans("Please re-type your new password")),null;var d=Cloudwalkers.Session.getUser();d.save({oldpassword:b,newpassword:c},{patch:!0,endpoint:"password",success:function(){Cloudwalkers.RootView.growl(trans("User Profile"),trans("You have a new password now")),this.$el.find(".edit-user-password").removeClass("loading"),this.$el.find("[name=pass0]").val(""),this.$el.find("[name=pass1]").val(""),this.$el.find("[name=pass2]").val(""),this.$el.find("[name=pass2]").blur()}.bind(this),error:function(a,b){var c=b.responseJSON.error.message;Cloudwalkers.RootView.growl(trans("User Profile"),c),window.location.reload()}.bind(this)})},negotiateFunctionalities:function(a){$(a).find(".panel-title").on("click",function(){$(this).parents(".collapse-closed, .collapse-open").toggleClass("collapse-closed collapse-open")})}});return c}),define(["backbone","mustache","Models/User","Views/Root","Views/Pages/Settings"],function(a,b,c){var d=a.View.extend({events:{"click li[data-id]":"toggleprofile","click .delete-detail":"delete","click .close-detail":"closedetail"},listnames:{facebook:"Pages",twitter:!1,linkedin:"Companies","google-plus":"Pages",youtube:!1},service:null,initialize:function(a){a&&$.extend(this,a),this.service=this.model},render:function(){var a=_.clone(this.service.attributes);return a.listname=this.listnames[a.network.token],a.authurl=a.authenticateUrl+"&return="+encodeURIComponent(window.location.href),this.$el.html(b.render(Templates.service,a)),this},toggleprofile:function(a){var b=$(a.currentTarget).toggleClass("active inactive"),d=new c({id:b.data("id")});d.parent=this.service,d.typestring="profiles",d.save({activated:b.hasClass("active")},{patch:!0,success:function(a){Cloudwalkers.RootView.growl(trans("Social connections"),trans("A successful update, there.")),a.parent.updateStreams(a.get("activated"),a)}.bind(this)})},"delete":function(){Cloudwalkers.RootView.confirm(trans("You are about to delete a service all your statistics information will be lost."),function(){this.parent.$el.find("[data-service="+this.service.id+"]").remove(),this.service.destroy({success:this.servicedeleted.bind(this)})}.bind(this))},servicedeleted:function(){this.trigger("service:deleted"),this.closedetail()},closedetail:function(){this.parent.closedetail()}});return d}),define(["Views/BaseView","mustache","Collections/Services","Models/Service","Views/Settings/Service"],function(a,b,c,d,e){var f=a.extend({events:{"click [data-add-service]":"addService","click [data-service]":"servicedetail"},initialize:function(a){return this.services=new c,a.serviceid?this.appendservice(a.serviceid):(this.listenTo(this.services,"available:ready",this.appendOptions),this.services.fetchAvailable(),this.listenTo(this.services,"add",this.appendService),this.listenToOnce(this.services,"add",this.endload),this.listenTo(this.services,"ready",this.limited),this.services.fetch(),void this.loadListeners(this.services,["available:ready","sync","ready"],!0))},render:function(){var a=(Cloudwalkers.Session.getAccount(),{});return this.$el.html(b.render(Templates.services,a)),this.$container=this.$el.find(".panel-body"),this},appendservice:function(a){var b=new d({id:a});b.addservice()},appendOptions:function(a,c){var d=this.$el.find(".networks-list");for(var e in c)d.append(b.render(Templates.service_option,c[e]))},appendService:function(a){this.$el.find("ul.services").append(b.render(Templates.service_connected,a.attributes))},addService:function(a){if(this.$el.find(".networks-list.limited").size())return null;var b=$(a.target).data("add-service");this.listenToOnce(this.services,"sync",function(a){var b=a.get("authenticateUrl");return b?void(window.location=this.processLink(b,a.id)):null
}),this.services.create({},{wait:!0,endpoint:b,error:this.error.bind(this)})},error:function(a,b){var c=Cloudwalkers.Session.getAccount();if(!c.monitorlimit("services",this.services.models.length,null,!0)){var d=b.responseJSON?b.responseJSON.error.message:trans("Something went wrong");Cloudwalkers.RootView.alert(d)}},limited:function(a){Cloudwalkers.Session.getAccount().monitorlimit("services",a.models.length,$(".networks-list"))},servicedetail:function(a){var b=$(a.currentTarget).data("service"),c=this.services.get(b);this.$el.find("#service-connected").addClass("open-detail"),this.detail=new e({model:c,parent:this}),this.$el.find(".service-detail").html(this.detail.render().el),this.listenTo(this.detail,"service:deleted",this.deletedservice.bind(this))},deletedservice:function(){this.limited(this.services)},closedetail:function(){this.$el.find("#service-connected").removeClass("open-detail"),this.detail.remove()},processLink:function(a,b){return a=a.indexOf("?")>0?a+"&return="+encodeURIComponent(window.location.origin+"/#settings/services/"+b):a+"?return="+encodeURIComponent(window.location.origin+"/#settings/services/"+b)},addServiceCall:function(a){a.preventDefault();var b=this,c=$(a.target).attr("data-add-service");this.addService(c,function(a){"undefined"!=typeof a.error?Cloudwalkers.RootView.alert(a.error.message):($.each(a.service.settings,function(a,c){if("link"==c.type){var d=b.processLink(c.url);window.location=d}}),b.render())})},negotiateFunctionalities:function(){}});return f}),define(["backbone","Models/Trigger","Views/Root"],function(a,b){var c=a.View.extend({events:{"click [data-action=save]":"save","keyup textarea":"enablereset","click [type=reset]":"reset"},initialize:function(a){$.extend(this,a),this.model||(this.model=new b)},render:function(){this.model.parent=Cloudwalkers.Session.getAccount();var a={message:this.model.getmessage("REPLY"),description:this.description};return this.$el.html(Mustache.render(Templates.settings.trigger,a)),this},updatetrigger:function(a){this.model=a,this.render(),this.$el.find(".inner-loading").removeClass("inner-loading"),this.$el.find(".loading").removeClass("loading"),this.$el.find("textarea").attr("disable",!1)},save:function(){this.$el.addClass("loading"),this.$el.find(".submit-btn button").attr("disabled",!0),this.model.setaction("REPLY",{message:this.$el.find("textarea").val()}),this.model.save({event:this.model.get("event"),actions:this.model.get("actions")},{patch:this.model.id?!0:!1,success:function(){Cloudwalkers.RootView.growl(trans("User Profile"),trans("Your Profile Settings are updated")),this.$el.removeClass("loading"),this.$el.find("[type=submit]").attr("disabled",!1)}.bind(this),error:function(){Cloudwalkers.RootView.growl(trans("User Profile"),trans("There was an error updating your settings.")),this.$el.removeClass("loading"),this.$el.find("[type=submit]").attr("disabled",!1),this.$el.find("[type=reset]").attr("disabled",!1)}.bind(this)})},enablereset:function(){this.$el.find("[type=reset]").attr("disabled",!1)},reset:function(a){$(a.currentTarget).closest("form").get(0).reset(),this.$el.find("[type=reset]").attr("disabled",!0)}});return c}),define(["backbone","mustache","Views/Settings/UserDetails"],function(a,b,c){var d=a.View.extend({tagName:"tr",events:{"click [data-edit-user-id]":"openDetails","click [data-delete-user-id]":"deleteUser"},initialize:function(a){a&&$.extend(this,a),this.parameters={},this.listenTo(this.model,"change:clearance",this.render)},render:function(){var a={};return a.user=this.model.attributes,a.user.role=this.model.getRole().name,Cloudwalkers.Session.censuretemplate(a),this.$el.html(b.render(Templates.user,a)),this},openDetails:function(){var a=new c({model:this.model,view:this.view});$(".manage-users-edit-widget .panel-body").html(a.render().el)},deleteUser:function(a){{var b=$(a.currentTarget).parents("tr");Cloudwalkers.Session.getUser(b.data("delete-user-id"))}Cloudwalkers.RootView.confirm(trans("You are about to remove ")+this.model.get("firstname")+trans(". Are you sure?"),function(){this.model.destroy({success:function(){b.remove(),Cloudwalkers.RootView.growl(trans("Manage users"),trans("That's an ex-user."))}})}.bind(this))}});return d}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({events:{"submit form#edit-managed-user":"submit"},initialize:function(a){a&&$.extend(this,a),this.listenTo(this.model,"request",this.disablesave),this.listenTo(this.model,"sync",this.enablesave),this.role=this.model.get("rolegroup"),this.roles=Cloudwalkers.Session.getAccount().get("roles")},render:function(){for(var a=this.roles,c={roles:[],user:this.model.attributes},d=0;d<a.length;d++){var e=a[d];e.checked=this.model.get("rolegroup")==a[d].id,c.roles.push(e)}return this.$el.html(b.render(Templates.userdetails,c)),this},submit:function(a){a.preventDefault();var b={rolegroup:$("#rolegroup").val()};this.model.parent=Cloudwalkers.Session.getAccount(),this.model.save(b,{patch:!0,success:this.success.bind(this),error:this.error})},success:function(a){Cloudwalkers.RootView.growl(trans("Manage users"),trans("The user clearance is updated.")),this.model.trigger("change:clearance"),a.id==Cloudwalkers.Session.getUser().id&&setTimeout(function(){window.location.reload()},1e3)},error:function(a,b){var c=Cloudwalkers.Session.getAccount();if(!c.monitorlimit("admins",Cloudwalkers.Session.getUsers("Conversation manager").length,null,!0)){var d=b.responseJSON?b.responseJSON.error.message:trans("Something went wrong");Cloudwalkers.RootView.alert(d)}},disablesave:function(){this.$el.find("#edit-managed-user .btn").attr("disabled",!0)},enablesave:function(){this.$el.find("#edit-managed-user .btn").attr("disabled",!1)}});return c}),define(["backbone"],function(a){var b=a.View.extend({tagName:"option",events:{"click [data-edit-user-id]":"openDetails","click [data-delete-user-id]":"deleteUser"},initialize:function(a){a&&$.extend(this,a),this.parameters={},this.listenTo(this.model,"change",this.render)},render:function(){var a=this,b={};return b.user=this.model.attributes,b.user.role=this.model.getRole(),Cloudwalkers.Session.censuretemplate(b),a.$el.attr("value",b.user.id),a.$el.html(b.user.displayname),this}});return b}),define(["Views/BaseView","mustache","Collections/Users","Models/User","Views/Settings/User"],function(a,b,c,d,e){var f=a.extend({events:{"submit .users-invite":"addUser","click .invite-link":"scrolldown"},"class":"section",collections:[],initialize:function(){this.collection=new c,this.listenToOnce(this.collection,"sync",this.fill),this.listenToOnce(this.collection,"request",this.showloading),this.listenToOnce(this.collection,"sync",this.hideloading),this.loadListeners(this.collection,["request","sync"],!0)},render:function(){var a=Cloudwalkers.Session.getAccount(),c={};return Cloudwalkers.Session.censuretemplate(c),this.$el.html(b.render(Templates.users,c)),this.collection.parameters={records:100},this.collection.parentmodel=a,this.collection.fetch(),this.$container=this.$el.find(".toload"),this},fill:function(a){var b=a.models,c=this.$el.find(".user-container").eq(-1);Cloudwalkers.Session.getAccount().monitorlimit("users",b.length,$(".invite-user"));for(var d in b){var f=new e({model:b[d],view:this});c.append(f.render().el)}},addUser:function(a){a.preventDefault();{var b={email:$("input[name=invite-email]").val()};Cloudwalkers.Session.api+"/account/"+Cloudwalkers.Session.getAccount().get("id")+"/users"}this.$el.find(".users-invite").addClass("loading"),this.$el.find(".users-invite .btn").attr("disabled",!0);var c=new d(b);c.once("sync",function(){Cloudwalkers.RootView.growl(trans("User Management"),trans("Invitation on it's way.")),this.$el.find("input[name=invite-email]").val(""),this.$el.find(".users-invite").removeClass("loading"),this.$el.find(".users-invite .btn").attr("disabled",!1)}.bind(this)).save()},scrolldown:function(){$("html, body").animate({scrollTop:$(".invite-user").offset().top},500)},fail:function(){Cloudwalkers.RootView.growl(trans("Oops"),trans("Something went sideways, please reload the page."))}});return f}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({widgets:[],title:"Widget Container",isLoaded:!1,currentLine:null,sizecounter:0,newline:!0,templatename:"widgetcontainer",events:{remove:"destroy"},initialize:function(a){this.options=a,this.widgets=[],this.initializeWidgets(),this.isLoaded=!1,this.newline=!0,this.sizecounter=0,this.title=this.options.title?this.options.title:this.title},initializeWidgets:function(){},add:function(a,b){"undefined"==typeof b&&(b=a.size),b="full"==b?12:"half"==b?6:b?parseInt(b):12,this.sizecounter+=b,this.sizecounter>12&&(this.sizecounter=b,this.newline=!0),this.addWidgetSize(a,this.newline,b),this.newline=!1},addHalfWidget:function(a,b){"undefined"==typeof b&&(b=!1);var c=this;a.on("content:change",function(){c.trigger("content:change")}),this.widgets.push({widget:a,size:"half",newline:b}),this.isLoaded&&this.addWidgetsDOM([{widget:a,size:"half",newline:b}])},addWidget:function(a,b){"undefined"==typeof b&&(b=!1);var c=this;a.on("content:change",function(){c.trigger("content:change")}),this.widgets.push({widget:a,size:"full",newline:b}),this.isLoaded&&this.addWidgetsDOM([{widget:a,size:"full",newline:b}])},addWidgetSize:function(a,b,c){"undefined"==typeof b&&(b=!1);var d=this;a.on("content:change",function(){d.trigger("content:change")}),this.widgets.push({widget:a,size:c,newline:b}),this.isLoaded&&this.addWidgetsDOM([{widget:a,size:c,newline:b}])},render:function(){this.isLoaded=!0,this.$el.addClass("container-fluid"),this.$el.html(b.render(Templates[this.templatename],{title:this.title}));return this.currentline=$(document.createElement("div")),this.currentline.addClass("row"),this.$el.find("#widgetcontainer").append(this.currentline),this.addWidgetsDOM(this.widgets),this},addWidgetsDOM:function(a){for(var b=this,c=0;c<a.length;c++)a[c].newline&&(this.currentline=$(document.createElement("div")),this.currentline.addClass("row"),this.$el.find("#widgetcontainer").append(this.currentline)),container=$(document.createElement("div")),container.addClass("half"==a[c].size?"col-md-6":"full"==a[c].size?"col-md-12":"col-md-"+a[c].size),container.append(a[c].widget.render().el),this.currentline.append(container),a[c].widget.negotiateFunctionalities();setTimeout(function(){b.trigger("content:change")},1)},destroy:function(){for(var a in this.widgets)this.widgets[a].widget.trigger("destroy")}});return c}),define(["Views/Panels/Panel","moment"],function(a,b){var c=a.extend({title:"Date range",icon:"calendar",color:"grey",events:{"submit form":"submit"},getDateRange:function(){return[b().subtract(6,"days").zone(0).endOf("day")._d,b().zone(0).endOf("day")._d]},render:function(){this.start=b().subtract(6,"days").zone(0).endOf("day")._d,this.end=b().zone(0).endOf("day")._d;var a=this.$el,c={},d=this;return a.html(Mustache.render(Templates.datepicker,c)),a.find(".dashboard-report-range").daterangepicker({ranges:{"Last 2 Days":[b().subtract(1,"days").zone(0).endOf("day")._d,"today"],"Last 5 Days":[b().subtract(5,"days").zone(0).endOf("day")._d,"today"],"Last 7 Days":[b().subtract(6,"days").zone(0).endOf("day")._d,"today"],"Last 10 Days":[b().subtract(9,"days").zone(0).endOf("day")._d,"today"]},opens:App.isRTL()?"right":"left",format:"MM/dd/yyyy",separator:" to ",startDate:this.start,endDate:this.end,locale:{applyLabel:"Submit",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom Range",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1},showWeekNumbers:!0,buttonClasses:["btn-danger"]},function(b,c){a.find(".dashboard-report-range span").html(b.toString("MMMM d, yyyy")+" - "+c.toString("MMMM d, yyyy")),d.trigger("date:change",b,new Date(c.getTime()).add({days:1}))}),a.find(".dashboard-report-range").show(),a.find(".dashboard-report-range span").html(this.start.toString("MMMM d, yyyy")+" - "+new Date(this.end).add({days:-1}).toString("MMMM d, yyyy")),this}});return c}),define({appid:"--appid--",apiurl:"https://devapi.cloudwalkers.be/",authurl:"https://devapi.cloudwalkers.be/oauth2/",setloginwindow:function(){$("iframe").get(0).src=this.authurl+"authorize?response_type=token&state=xyz&client_id="+this.appid+"&redirect_uri="+origin()+"/auth.html"},hello:function(){window.location="/"},hasToken:function(){var a=window.localStorage.getItem("token");a&&a.length>9?this.hello():(a&&window.localStorage.removeItem("token"),this.setloginwindow(),window.addEventListener("message",this.receiveToken.bind(this),!1))},receiveToken:function(a){a.origin===origin()&&(a.data&&a.data.length>9?(window.localStorage.setItem("token",a.data),this.hello()):this.setloginwindow())}});var origin=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname};define({appid:"oauth254527038d993a5.13832191",apiurl:"https://api.cloudwalkers.be/",authurl:"https://api.cloudwalkers.be/oauth2/",setloginwindow:function(){$("iframe").get(0).src=this.authurl+"authorize?response_type=token&state=xyz&client_id="+this.appid+"&redirect_uri="+origin()+"/auth.html"},hello:function(){window.location="/"},hasToken:function(){var a=window.localStorage.getItem("token");a&&a.length>9?this.hello():(a&&window.localStorage.removeItem("token"),this.setloginwindow(),window.addEventListener("message",this.receiveToken.bind(this),!1))},receiveToken:function(a){a.origin===origin()&&(a.data&&a.data.length>9?(window.localStorage.setItem("token",a.data),this.hello()):this.setloginwindow())}});var origin=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname};require.config({baseUrl:"/js/"}),require(["lib/jquery/dist/jquery.min","config"],function(a,b){b.hasToken()});var origin=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname};require.config({baseUrl:"/js/",paths:{jquery:"lib/jquery/dist/jquery.min",jqueryui:"lib/jquery-ui/jquery-ui.min",underscore:"lib/underscore/underscore",backbone:"lib/backbone/backbone",bootstrap:"lib/bootstrap/dist/js/bootstrap.min","bootstrap-modal":"lib/bootstrap-modal/js/bootstrap-modal","bootstrap-modalmanager":"lib/bootstrap-modal/js/bootstrap-modalmanager",mustache:"lib/mustache/mustache",moment:"lib/moment/moment",datepicker:"lib/bootstrap-datepicker/js/bootstrap-datepicker",timepicker:"lib/bootstrap-timepicker/js/bootstrap-timepicker.min",calheatmap:"lib/cal-heatmap/cal-heatmap.min",chosen:"lib/chosen/chosen.jquery.min",d3:"lib/d3/d3.min",crossdomain:"lib/backbone.crossdomain/Backbone.CrossDomain",polyglot:"lib/polyglot/lib/polyglot",slimscroll:"lib/slimscroll/jquery.slimscroll.min",gritter:"lib/jquery.gritter/js/jquery.gritter.min",async:"lib/requirejs-plugins/src/async",goog:"lib/requirejs-plugins/src/goog",propertyParser:"lib/requirejs-plugins/src/propertyParser",colorbox:"lib/colorbox/jquery.colorbox-min",plot:"lib/flot/jquery.flot",pie:"lib/flot/jquery.flot.pie",resize:"lib/flot/jquery.flot.resize",stack:"lib/flot/jquery.flot.stack",crosshair:"lib/flot/jquery.flot.crosshair",time:"lib/flot/jquery.flot.time"},shim:{bootstrap:{deps:["jquery"],exports:"bootstrap"},underscore:{exports:"_"},plot:{deps:["jquery"],exports:"plot"},pie:{deps:["plot"],exports:"pie"},resize:{deps:["plot"],exports:"resize"},stack:{deps:["plot"],exports:"stack"},time:{deps:["plot"],exports:"time"},crosshair:{deps:["plot"],exports:"crosshair"},jqueryui:{deps:["jquery"],exports:"jqueryui"},backbone:{deps:["underscore","jquery","mustache","jqueryui","pie","resize","stack","time","crosshair"],exports:"backbone"},crossdomain:{deps:["backbone"],exports:"crossdomain"},calheatmap:{deps:["d3"],exports:"calheatmap"},d3:{exports:"d3"}},urlArgs:"bust="+(new Date).getTime()});var Cloudwalkers,trans;require(["backbone","bootstrap","Cloudwalkers"],function(a,b,c){$(document).ready(function(){Store=new StorageClassLocal,Cloudwalkers=c,Cloudwalkers.init()})}),AuthorizationError.prototype=new Error,AuthorizationError.prototype.constructor=AuthorizationError;var origin=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname};